[1mdiff --git a/.codex/config.toml b/.codex/config.toml[m
[1mindex 7e04b8e..e0e1d81 100644[m
[1m--- a/.codex/config.toml[m
[1m+++ b/.codex/config.toml[m
[36m@@ -2,9 +2,12 @@[m
 require = true[m
 [m
 [commands][m
[31m-allow = ["bash scripts/ci/test_wsl.sh",[m
[31m-         "flutter pub get", "dart format . --fix",[m
[31m-         "flutter analyze", "flutter test -x widget_dialog"][m
[32m+[m[32mallow = [[m
[32m+[m[32m  "bash scripts/ci/test_wsl.sh",[m
[32m+[m[32m  "dart format .",[m
[32m+[m[32m  "dart analyze",[m
[32m+[m[32m  "flutter --no-version-check test -x widget_dialog"[m
[32m+[m[32m][m
 [m
 [sandbox][m
 allow_network = false[m
[1mdiff --git a/.flutter-plugins-dependencies b/.flutter-plugins-dependencies[m
[1mnew file mode 100644[m
[1mindex 0000000..8866628[m
[1m--- /dev/null[m
[1m+++ b/.flutter-plugins-dependencies[m
[36m@@ -0,0 +1 @@[m
[32m+[m[32m{"info":"This is a generated file; do not edit or check into version control.","plugins":{"ios":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"path_provider_foundation","path":"/home/axb/.pub-cache/hosted/pub.dev/path_provider_foundation-2.4.2/","shared_darwin_source":true,"native_build":true,"dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"shared_preferences_foundation","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_foundation-2.5.4/","shared_darwin_source":true,"native_build":true,"dependencies":[],"dev_dependency":false}],"android":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","native_build":true,"dependencies":["flutter_plugin_android_lifecycle"],"dev_dependency":false},{"name":"flutter_plugin_android_lifecycle","path":"/home/axb/.pub-cache/hosted/pub.dev/flutter_plugin_android_lifecycle-2.0.31/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"path_provider_android","path":"/home/axb/.pub-cache/hosted/pub.dev/path_provider_android-2.2.19/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"shared_preferences_android","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_android-2.4.15/","native_build":true,"dependencies":[],"dev_dependency":false}],"macos":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"path_provider_foundation","path":"/home/axb/.pub-cache/hosted/pub.dev/path_provider_foundation-2.4.2/","shared_darwin_source":true,"native_build":true,"dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"shared_preferences_foundation","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_foundation-2.5.4/","shared_darwin_source":true,"native_build":true,"dependencies":[],"dev_dependency":false}],"linux":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","native_build":false,"dependencies":[],"dev_dependency":false},{"name":"path_provider_linux","path":"/home/axb/.pub-cache/hosted/pub.dev/path_provider_linux-2.2.1/","native_build":false,"dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"shared_preferences_linux","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_linux-2.4.1/","native_build":false,"dependencies":["path_provider_linux"],"dev_dependency":false}],"windows":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","native_build":false,"dependencies":[],"dev_dependency":false},{"name":"path_provider_windows","path":"/home/axb/.pub-cache/hosted/pub.dev/path_provider_windows-2.3.0/","native_build":false,"dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","native_build":true,"dependencies":[],"dev_dependency":false},{"name":"shared_preferences_windows","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_windows-2.4.1/","native_build":false,"dependencies":["path_provider_windows"],"dev_dependency":false}],"web":[{"name":"file_picker","path":"/home/axb/.pub-cache/hosted/pub.dev/file_picker-8.3.7/","dependencies":[],"dev_dependency":false},{"name":"printing","path":"/home/axb/.pub-cache/hosted/pub.dev/printing-5.14.2/","dependencies":[],"dev_dependency":false},{"name":"shared_preferences_web","path":"/home/axb/.pub-cache/hosted/pub.dev/shared_preferences_web-2.4.3/","dependencies":[],"dev_dependency":false}]},"dependencyGraph":[{"name":"file_picker","dependencies":["flutter_plugin_android_lifecycle"]},{"name":"flutter_plugin_android_lifecycle","dependencies":[]},{"name":"path_provider","dependencies":["path_provider_android","path_provider_foundation","path_provider_linux","path_provider_windows"]},{"name":"path_provider_android","dependencies":[]},{"name":"path_provider_foundation","dependencies":[]},{"name":"path_provider_linux","dependencies":[]},{"name":"path_provider_windows","dependencies":[]},{"name":"printing","dependencies":[]},{"name":"shared_preferences","dependencies":["shared_preferences_android","shared_preferences_foundation","shared_preferences_linux","shared_preferences_web","shared_preferences_windows"]},{"name":"shared_preferences_android","dependencies":[]},{"name":"shared_preferences_foundation","dependencies":[]},{"name":"shared_preferences_linux","dependencies":["path_provider_linux"]},{"name":"shared_preferences_web","dependencies":[]},{"name":"shared_preferences_windows","dependencies":["path_provider_windows"]}],"date_created":"2025-10-11 17:50:53.408379","version":"3.35.6","swift_package_manager_enabled":{"ios":false,"macos":false}}[m
\ No newline at end of file[m
[1mdiff --git a/AGENTS.md b/AGENTS.md[m
[1mindex 8474051..532024a 100644[m
[1m--- a/AGENTS.md[m
[1m+++ b/AGENTS.md[m
[36m@@ -71,6 +71,7 @@[m [mEach PR opened by an agent must:[m
 - This app is **offline-first** and field-facing. Stability is prioritized over feature creep.  [m
 - Defensive coding and clear test coverage are preferred over aggressive refactoring.  [m
 - Agents should leave explanatory comments in code when applying non-trivial fixes.  [m
[32m+[m[32m- Local automation helpers: `.codex/config.toml` keeps approvals on while whitelisting the test loop, and `scripts/ci/test_wsl.sh` is the approved formatter/analyzer/test runner (see `docs/CODEX_TEST_LOOP.md`).[m[41m  [m
 [m
 ---[m
 [m
[1mdiff --git a/buildlogs/last_test.txt b/buildlogs/last_test.txt[m
[1mnew file mode 100644[m
[1mindex 0000000..344d840[m
[1m--- /dev/null[m
[1m+++ b/buildlogs/last_test.txt[m
[36m@@ -0,0 +1,229 @@[m
[32m+[m[32mAnalyzing resicheck...[m
[32m+[m
[32m+[m[32m   info - lib/models/project_models.dart:111:9 - Use an initializing formal to assign a parameter to a field. Try using an initialing formal ('this.dirA') to initialize the field. - prefer_initializing_formals[m
[32m+[m[32m   info - lib/models/project_models.dart:112:9 - Use an initializing formal to assign a parameter to a field. Try using an initialing formal ('this.dirB') to initialize the field. - prefer_initializing_formals[m
[32m+[m[32m   info - lib/models/site.dart:53:9 - Use an initializing formal to assign a parameter to a field. Try using an initialing formal ('this.orientationA') to initialize the field. - prefer_initializing_formals[m
[32m+[m[32m   info - lib/models/site.dart:54:9 - Use an initializing formal to assign a parameter to a field. Try using an initialing formal ('this.orientationB') to initialize the field. - prefer_initializing_formals[m
[32m+[m[32m   info - lib/services/export_service.dart:187:18 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - lib/services/import/adapter_csv.dart:23:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/services/inversion.dart:1295:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/services/persistence.dart:43:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/services/storage_service.dart:102:24 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - lib/state/providers.dart:149:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/ui/import/import_sheet.dart:445:11 - 'groupValue' is deprecated and shouldn't be used. Use a RadioGroup ancestor to manage group value instead. This feature was deprecated after v3.32.0-0.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/import/import_sheet.dart:446:11 - 'onChanged' is deprecated and shouldn't be used. Use RadioGroup to handle value change instead. This feature was deprecated after v3.32.0-0.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/import/import_sheet.dart:469:11 - 'groupValue' is deprecated and shouldn't be used. Use a RadioGroup ancestor to manage group value instead. This feature was deprecated after v3.32.0-0.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/import/import_sheet.dart:470:11 - 'onChanged' is deprecated and shouldn't be used. Use RadioGroup to handle value change instead. This feature was deprecated after v3.32.0-0.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/import/import_sheet.dart:479:17 - 'value' is deprecated and shouldn't be used. Use initialValue instead. This will set the initial value for the form field. This feature was deprecated after v3.33.0-1.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/import/widgets/column_map_row.dart:59:15 - 'value' is deprecated and shouldn't be used. Use initialValue instead. This will set the initial value for the form field. This feature was deprecated after v3.33.0-1.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/project_workflow/depth_cue_summary.dart:2:8 - The import of 'dart:ui' is unnecessary because all of the used elements are also provided by the import of 'package:flutter/material.dart'. Try removing the import directive. - unnecessary_import[m
[32m+[m[32m   info - lib/ui/project_workflow/home_page.dart:55:7 - Don't use 'BuildContext's across async gaps. Try rewriting the code to not use the 'BuildContext', or guard the use with a 'mounted' check. - use_build_context_synchronously[m
[32m+[m[32m   info - lib/ui/project_workflow/inversion_summary_panel.dart:1:8 - The import of 'dart:ui' is unnecessary because all of the used elements are also provided by the import of 'package:flutter/material.dart'. Try removing the import directive. - unnecessary_import[m
[32m+[m[32m   info - lib/ui/project_workflow/plots_panel.dart:158:29 - Unnecessary use of string interpolation. Try replacing the string literal with the variable name. - unnecessary_string_interpolations[m
[32m+[m[32m   info - lib/ui/project_workflow/plots_panel.dart:171:19 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - lib/ui/project_workflow/plots_panel.dart:220:26 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - lib/ui/project_workflow/plots_panel.dart:483:9 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/ui/project_workflow/plots_panel.dart:859:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/ui/project_workflow/project_shell.dart:56:16 - The private field _distanceUnit could be 'final'. Try making the field 'final'. - prefer_final_fields[m
[32m+[m[32m   info - lib/ui/project_workflow/right_detail_panel.dart:103:19 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - lib/ui/project_workflow/table_panel.dart:247:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - lib/ui/project_workflow/table_panel.dart:1076:11 - 'value' is deprecated and shouldn't be used. Use initialValue instead. This will set the initial value for the form field. This feature was deprecated after v3.33.0-1.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/project_workflow/table_panel.dart:1117:11 - 'value' is deprecated and shouldn't be used. Use initialValue instead. This will set the initial value for the form field. This feature was deprecated after v3.33.0-1.0.pre. Try replacing the use of the deprecated member with the replacement. - deprecated_member_use[m
[32m+[m[32m   info - lib/ui/screens/home_screen.dart:1127:29 - Use interpolation to compose strings and values. Try using string interpolation to build the composite string. - prefer_interpolation_to_compose_strings[m
[32m+[m[32m   info - test/csv_io_test.dart:60:5 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - test/plots_panel_sort_test.dart:50:7 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - test/plots_panel_sort_test.dart:51:7 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - test/plots_panel_sort_test.dart:52:7 - Use 'const' with the constructor to improve performance. Try adding the 'const' keyword to the constructor invocation. - prefer_const_constructors[m
[32m+[m[32m   info - test/qc_rules_test.dart:12:3 - Use 'const' for final variables initialized to a constant value. Try replacing 'final' with 'const'. - prefer_const_declarations[m
[32m+[m[32m   info - test/state/project_controller_test.dart:46:11 - The local variable '_sampleProject' starts with an underscore. Try renaming the variable to not start with an underscore. - no_leading_underscores_for_local_identifiers[m
[32m+[m
[32m+[m[32m36 issues found.[m
[32m+[m[32m00:00 +0: loading /home/axb/code/resicheck/test/inversion_test.dart                                                                                                                                    00:01 +0: loading /home/axb/code/resicheck/test/inversion_test.dart                                                                                                                                    00:02 +0: loading /home/axb/code/resicheck/test/inversion_test.dart                                                                                                                                    00:02 +0: /home/axb/code/resicheck/test/inversion_test.dart: invert1DWenner recovers synthetic three-layer model                                                                                       00:02 +0 -1: /home/axb/code/resicheck/test/inversion_test.dart: invert1DWenner recovers synthetic three-layer model [E][m[41m                                                                                [m
[32m+[m[32m  Expected: a value less than <0.4>[m
[32m+[m[32m    Actual: <1.8280478786391456>[m
[32m+[m[32m     Which: is not a value less than <0.4>[m
[32m+[m[32m  resistivity layer 1[m
[32m+[m[41m  [m
[32m+[m[32m  package:matcher                                     expect[m
[32m+[m[32m  package:flutter_test/src/widget_tester.dart 473:18  expect[m
[32m+[m[32m  test/inversion_test.dart 50:7                       main.<fn>[m
[32m+[m[41m  [m
[32m+[m
[32m+[m[32mTo run this test again: /home/axb/flutter/bin/cache/dart-sdk/bin/dart test /home/axb/code/resicheck/test/inversion_test.dart -p vm --plain-name 'invert1DWenner recovers synthetic three-layer model'[m
[32m+[m[32m00:02 +0 -1: loading /home/axb/code/resicheck/test/csv_io_test.dart                                                                                                                                    00:02 +0 -1: /home/axb/code/resicheck/test/csv_io_test.dart: CSV roundtrip preserves feet, rho, sigma, and direction                                                                                   00:02 +1 -1: /home/axb/code/resicheck/test/csv_io_test.dart: CSV roundtrip preserves feet, rho, sigma, and direction                                                                                   00:02 +1 -1: /home/axb/code/resicheck/test/csv_io_test.dart: Legacy CSV import derives missing rho and feet from spacing_m and V/I                                                                     00:02 +2 -1: /home/axb/code/resicheck/test/csv_io_test.dart: Legacy CSV import derives missing rho and feet from spacing_m and V/I                                                                     00:02 +2 -1: /home/axb/code/resicheck/test/csv_io_test.dart: Direction enum round-trips through CSV                                                                                                    00:02 +3 -1: /home/axb/code/resicheck/test/csv_io_test.dart: Direction enum round-trips through CSV                                                                                                    00:02 +3 -1: loading /home/axb/code/resicheck/test/qc/qc_controller_test.dart                                                                                                                          00:02 +3 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: QC counts all points green for perfect fit                                                                                      00:02 +4 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: QC counts all points green for perfect fit                                                                                      00:02 +4 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: Excluded points are ignored in stats                                                                                            00:02 +5 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: Excluded points are ignored in stats                                                                                            00:02 +5 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: Large deviation classified as red                                                                                               00:02 +6 -1: /home/axb/code/resicheck/test/qc/qc_controller_test.dart: Large deviation classified as red                                                                                               00:02 +6 -1: loading /home/axb/code/resicheck/test/depth_cue_test.dart                                                                                                                                 00:02 +6 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity                                                                                  00:03 +6 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity                                                                                  00:03 +7 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity                                                                                  00:03 +8 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity                                                                                  00:03 +9 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity                                                                                  00:03 +9 -1: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity[m[41m                                                                                  [m
[32m+[m[32m══╡ EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ╞════════════════════════════════════════════════════[m
[32m+[m[32mThe following TestFailure was thrown running a test:[m
[32m+[m[32mExpected: non-empty[m
[32m+[m[32m  Actual: [][m
[32m+[m
[32m+[m[32mWhen the exception was thrown, this was the stack:[m
[32m+[m[32m#4      main.<anonymous closure> (file:///home/axb/code/resicheck/test/depth_cue_test.dart:23:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#5      testWidgets.<anonymous closure>.<anonymous closure> (package:flutter_test/src/widget_tester.dart:192:15)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#6      TestWidgetsFlutterBinding._runTestBody (package:flutter_test/src/binding.dart:1059:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m(elided one frame from package:stack_trace)[m
[32m+[m
[32m+[m[32mThis was caught by the test expectation on the following line:[m
[32m+[m[32m  file:///home/axb/code/resicheck/test/depth_cue_test.dart line 23[m
[32m+[m[32mThe test description was:[m
[32m+[m[32m  depth table uses 0.5·a and averages valid resistivity[m
[32m+[m[32m════════════════════════════════════════════════════════════════════════════════════════════════════[m
[32m+[m[32m00:03 +9 -2: /home/axb/code/resicheck/test/depth_cue_test.dart: depth table uses 0.5·a and averages valid resistivity [E][m[41m                                                                              [m
[32m+[m[32m  Test failed. See exception logs above.[m
[32m+[m[32m  The test description was: depth table uses 0.5·a and averages valid resistivity[m
[32m+[m[41m  [m
[32m+[m
[32m+[m[32mTo run this test again: /home/axb/flutter/bin/cache/dart-sdk/bin/dart test /home/axb/code/resicheck/test/depth_cue_test.dart -p vm --plain-name 'depth table uses 0.5·a and averages valid resistivity'[m
[32m+[m[32m00:03 +9 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                                00:03 +10 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:03 +11 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +11 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +12 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +13 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +14 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +15 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +16 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +17 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +18 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +19 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +20 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +21 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +21 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action[m[41m                                                                                               [m
[32m+[m[32mFailed to seed sample project: MissingPluginException(No implementation found for method getApplicationDocumentsDirectory on channel plugins.flutter.io/path_provider)[m
[32m+[m[32m#0      MethodChannel._invokeMethod (package:flutter/src/services/platform_channel.dart:365:7)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#1      getApplicationDocumentsDirectory (package:path_provider/path_provider.dart:121:24)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#2      ProjectStorageService._ensureRoot (package:resicheck/services/storage_service.dart:35:18)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#3      ProjectStorageService.ensureSampleProject (package:resicheck/services/storage_service.dart:62:20)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#4      _ProjectWorkflowHomePageState._loadProjects (package:resicheck/ui/project_workflow/home_page.dart:37:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#5      _FutureBuilderState._subscribe.<anonymous closure> (package:flutter/src/widgets/async.dart:641:7)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m
[32m+[m[32m00:04 +22 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +23 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +24 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +25 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +26 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +27 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:04 +28 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:05 +28 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:05 +29 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:05 +30 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action                                                                                               00:05 +30 -2: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action[m[41m                                                                                               [m
[32m+[m[32m══╡ EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ╞════════════════════════════════════════════════════[m
[32m+[m[32mThe following assertion was thrown running a test:[m
[32m+[m[32mpumpAndSettle timed out[m
[32m+[m
[32m+[m[32mWhen the exception was thrown, this was the stack:[m
[32m+[m[32m#0      WidgetTester.pumpAndSettle.<anonymous closure> (package:flutter_test/src/widget_tester.dart:717:11)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#1      TestAsyncUtils.guard.<anonymous closure> (package:flutter_test/src/test_async_utils.dart:130:27)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#2      main.<anonymous closure> (file:///home/axb/code/resicheck/test/widget_test.dart:13:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#3      testWidgets.<anonymous closure>.<anonymous closure> (package:flutter_test/src/widget_tester.dart:192:15)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#4      TestWidgetsFlutterBinding._runTestBody (package:flutter_test/src/binding.dart:1059:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m(elided one frame from package:stack_trace)[m
[32m+[m
[32m+[m[32mThe test description was:[m
[32m+[m[32m  ResiCheck boots and shows Add Point action[m
[32m+[m[32m════════════════════════════════════════════════════════════════════════════════════════════════════[m
[32m+[m[32m00:05 +30 -3: /home/axb/code/resicheck/test/widget_test.dart: ResiCheck boots and shows Add Point action [E][m[41m                                                                                           [m
[32m+[m[32m  Test failed. See exception logs above.[m
[32m+[m[32m  The test description was: ResiCheck boots and shows Add Point action[m
[32m+[m[41m  [m
[32m+[m
[32m+[m[32mTo run this test again: /home/axb/flutter/bin/cache/dart-sdk/bin/dart test /home/axb/code/resicheck/test/widget_test.dart -p vm --plain-name 'ResiCheck boots and shows Add Point action'[m
[32m+[m[32m00:06 +30 -3: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +30 -4: /home/axb/code/resicheck/test/import_service_test.dart: ImportService parses Wenner CSV and detects meters [E][m[41m                                                                           [m
[32m+[m[32m  Expected: contains ImportColumnTarget:<ImportColumnTarget.units>[m
[32m+[m[32m    Actual: _CompactValuesIterable<ImportColumnTarget>:[[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.pinsInsideFeet,[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.pinsOutsideFeet,[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.resistanceNsOhm,[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.resistanceWeOhm,[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.sdNsPercent,[m
[32m+[m[32m              ImportColumnTarget:ImportColumnTarget.sdWePercent[m
[32m+[m[32m            ][m
[32m+[m[32m     Which: does not contain ImportColumnTarget:<ImportColumnTarget.units>[m
[32m+[m[41m  [m
[32m+[m[32m  package:matcher                                     expect[m
[32m+[m[32m  package:flutter_test/src/widget_tester.dart 473:18  expect[m
[32m+[m[32m  test/import_service_test.dart 55:7                  main.<fn>.<fn>[m
[32m+[m[41m  [m
[32m+[m
[32m+[m[32mTo run this test again: /home/axb/flutter/bin/cache/dart-sdk/bin/dart test /home/axb/code/resicheck/test/import_service_test.dart -p vm --plain-name 'ImportService parses Wenner CSV and detects meters'[m
[32m+[m[32m00:06 +31 -4: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +32 -4: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +33 -4: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +34 -4: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +35 -4: /home/axb/code/resicheck/test/plots_panel_sort_test.dart: ghost and template series render in ascending spacing order                                                                    00:06 +36 -4: /home/axb/code/resicheck/test/import_service_test.dart: ImportService parses Excel workbooks with unit directives                                                                        00:06 +37 -4: /home/axb/code/resicheck/test/import_service_test.dart: ImportService parses Excel workbooks with unit directives                                                                        00:06 +38 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Derived resistance matches Wenner geometry from rho input                                                                         00:06 +39 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Derived resistance matches Wenner geometry from rho input                                                                         00:06 +39 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Sigma rho propagates from resistance sigma                                                                                        00:06 +40 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Sigma rho propagates from resistance sigma                                                                                        00:06 +40 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Rho QA diff percent reflects V/I derived resistivity                                                                              00:06 +41 -4: /home/axb/code/resicheck/test/spacing_point_test.dart: Rho QA diff percent reflects V/I derived resistivity                                                                              00:06 +41 -4: loading /home/axb/code/resicheck/test/points_table_test.dart                                                                                                                             00:06 +41 -4: /home/axb/code/resicheck/test/points_table_test.dart: TablePanel focus traversal tab order follows N–S long→short then W–E short→long                                                    00:07 +41 -4: /home/axb/code/resicheck/test/points_table_test.dart: TablePanel focus traversal tab order follows N–S long→short then W–E short→long                                                    00:07 +42 -4: /home/axb/code/resicheck/test/points_table_layout_test.dart: TablePanel builds in narrow width without overflow                                                                          00:07 +43 -4: /home/axb/code/resicheck/test/points_table_layout_test.dart: TablePanel builds in narrow width without overflow                                                                          00:07 +43 -4: /home/axb/code/resicheck/test/points_table_layout_test.dart: TablePanel builds in narrow width without overflow[m[41m                                                                          [m
[32m+[m[32m══╡ EXCEPTION CAUGHT BY RENDERING LIBRARY ╞═════════════════════════════════════════════════════════[m
[32m+[m[32mThe following assertion was thrown during layout:[m
[32m+[m[32mA RenderFlex overflowed by 8.0 pixels on the bottom.[m
[32m+[m
[32m+[m[32mThe relevant error-causing widget was:[m
[32m+[m[32m  Column Column:file:///home/axb/code/resicheck/lib/ui/project_workflow/table_panel.dart:704:14[m
[32m+[m
[32m+[m[32mThe overflowing RenderFlex has an orientation of Axis.vertical.[m
[32m+[m[32mThe edge of the RenderFlex that is overflowing has been marked in the rendering with a yellow and[m
[32m+[m[32mblack striped pattern. This is usually caused by the contents being too big for the RenderFlex.[m
[32m+[m[32mConsider applying a flex factor (e.g. using an Expanded widget) to force the children of the[m
[32m+[m[32mRenderFlex to fit within the available space instead of being sized to their natural size.[m
[32m+[m[32mThis is considered an error condition because it indicates that there is content that cannot be[m
[32m+[m[32mseen. If the content is legitimately bigger than the available space, consider clipping it with a[m
[32m+[m[32mClipRect widget before putting it in the flex, or using a scrollable container rather than a Flex,[m
[32m+[m[32mlike a ListView.[m
[32m+[m[32mThe specific RenderFlex in question is: RenderFlex#c93f9 relayoutBoundary=up44 OVERFLOWING:[m
[32m+[m[32m  creator: Column ← Center ← SizedBox ← ConstrainedBox ← DropdownButtonHideUnderline ←[m
[32m+[m[32m    DefaultTextStyle ← Align ← Padding ← ConstrainedBox ← Container ← Semantics ← _TableCell ← ⋯[m
[32m+[m[32m  parentData: offset=Offset(0.0, 0.0) (can use size)[m
[32m+[m[32m  constraints: BoxConstraints(0.0<=w<=120.0, 0.0<=h<=68.0)[m
[32m+[m[32m  size: Size(120.0, 68.0)[m
[32m+[m[32m  direction: vertical[m
[32m+[m[32m  mainAxisAlignment: start[m
[32m+[m[32m  mainAxisSize: min[m
[32m+[m[32m  crossAxisAlignment: center[m
[32m+[m[32m  verticalDirection: down[m
[32m+[m[32m  spacing: 0.0[m
[32m+[m[32m◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤[m
[32m+[m[32m════════════════════════════════════════════════════════════════════════════════════════════════════[m
[32m+[m[32m══╡ EXCEPTION CAUGHT BY RENDERING LIBRARY ╞═════════════════════════════════════════════════════════[m
[32m+[m[32mThe following assertion was thrown during layout:[m
[32m+[m[32mA RenderFlex overflowed by 8.0 pixels on the bottom.[m
[32m+[m
[32m+[m[32mThe relevant error-causing widget was:[m
[32m+[m[32m  Column Column:file:///home/axb/code/resicheck/lib/ui/project_workflow/table_panel.dart:704:14[m
[32m+[m
[32m+[m[32mThe overflowing RenderFlex has an orientation of Axis.vertical.[m
[32m+[m[32mThe edge of the RenderFlex that is overflowing has been marked in the rendering with a yellow and[m
[32m+[m[32mblack striped pattern. This is usually caused by the contents being too big for the RenderFlex.[m
[32m+[m[32mConsider applying a flex factor (e.g. using an Expanded widget) to force the children of the[m
[32m+[m[32mRenderFlex to fit within the available space instead of being sized to their natural size.[m
[32m+[m[32mThis is considered an error condition because it indicates that there is content that cannot be[m
[32m+[m[32mseen. If the content is legitimately bigger than the available space, consider clipping it with a[m
[32m+[m[32mClipRect widget before putting it in the flex, or using a scrollable container rather than a Flex,[m
[32m+[m[32mlike a ListView.[m
[32m+[m[32mThe specific RenderFlex in question is: RenderFlex#881d4 relayoutBoundary=up44 OVERFLOWING:[m
[32m+[m[32m  creator: Column ← Center ← SizedBox ← ConstrainedBox ← DropdownButtonHideUnderline ←[m
[32m+[m[32m    DefaultTextStyle ← Align ← Padding ← ConstrainedBox ← Container ← Semantics ← _TableCell ← ⋯[m
[32m+[m[32m  parentData: offset=Offset(0.0, 0.0) (can use size)[m
[32m+[m[32m  constraints: BoxConstraints(0.0<=w<=120.0, 0.0<=h<=68.0)[m
[32m+[m[32m  size: Size(120.0, 68.0)[m
[32m+[m[32m  direction: vertical[m
[32m+[m[32m  mainAxisAlignment: start[m
[32m+[m[32m  mainAxisSize: min[m
[32m+[m[32m  crossAxisAlignment: center[m
[32m+[m[32m  verticalDirection: down[m
[32m+[m[32m  spacing: 0.0[m
[32m+[m[32m◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤◢◤[m
[32m+[m[32m════════════════════════════════════════════════════════════════════════════════════════════════════[m
[32m+[m[32m══╡ EXCEPTION CAUGHT BY FLUTTER TEST FRAMEWORK ╞════════════════════════════════════════════════════[m
[32m+[m[32mThe following TestFailure was thrown running a test:[m
[32m+[m[32mExpected: null[m
[32m+[m[32m  Actual: 'Multiple exceptions (2) were detected during the running of the current test, and at[m
[32m+[m[32mleast one was unexpected.'[m
[32m+[m
[32m+[m[32mWhen the exception was thrown, this was the stack:[m
[32m+[m[32m#4      main.<anonymous closure> (file:///home/axb/code/resicheck/test/points_table_layout_test.dart:20:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#5      testWidgets.<anonymous closure>.<anonymous closure> (package:flutter_test/src/widget_tester.dart:192:15)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m#6      TestWidgetsFlutterBinding._runTestBody (package:flutter_test/src/binding.dart:1059:5)[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m<asynchronous suspension>[m
[32m+[m[32m(elided one frame from package:stack_trace)[m
[32m+[m
[32m+[m[32mThis was caught by the test expectation on the following line:[m
[32m+[m[32m  file:///home/axb/code/resicheck/test/points_table_layout_test.dart line 20[m
[32m+[m[32mThe test description was:[m
[32m+[m[32m  TablePanel builds in narrow width without overflow[m
[32m+[m[32m════════════════════════════════════════════════════════════════════════════════════════════════════[m
[32m+[m[32m00:08 +43 -5: /home/axb/code/resicheck/test/points_table_layout_test.dart: TablePanel builds in narrow width without overflow [E][m[41m                                                                      [m
[32m+[m[32m  Test failed. See exception logs above.[m
[32m+[m[32m  The test description was: TablePanel builds in narrow width without overflow[m
[32m+[m[41m  [m
[32m+[m
[32m+[m[32mTo run this test again: /home/axb/flutter/bin/cache/dart-sdk/bin/dart test /home/axb/code/resicheck/test/points_table_layout_test.dart -p vm --plain-name 'TablePanel builds in narrow width without overflow'[m
[32m+[m[32m00:08 +43 -5: Some tests failed.[m[41m                                                                                                                                                                       [m
[1mdiff --git a/docs/CODEX_TEST_LOOP.md b/docs/CODEX_TEST_LOOP.md[m
[1mnew file mode 100644[m
[1mindex 0000000..8e83387[m
[1m--- /dev/null[m
[1m+++ b/docs/CODEX_TEST_LOOP.md[m
[36m@@ -0,0 +1,27 @@[m
[32m+[m[32m# Codex ⇄ Test Loop (WSL)[m
[32m+[m
[32m+[m[32mThis workflow keeps analyzer and test feedback close to the Codex CLI so fixes can be proposed without leaving the terminal.[m
[32m+[m
[32m+[m[32m## Prerequisites[m
[32m+[m[32m- Flutter and Dart SDKs are already installed and warmed on the host (run once outside Codex: `flutter --no-version-check --version && flutter precache --linux`).[m
[32m+[m[32m- The repository is checked out in WSL at `~/code/resicheck`.[m
[32m+[m
[32m+[m[32m## Standard Loop[m
[32m+[m[32m1. Apply the current PR prompt or patch instructions in Codex.[m
[32m+[m[32m2. Execute the scripted test pass:[m
[32m+[m[32m   ```bash[m
[32m+[m[32m   run bash scripts/ci/test_wsl.sh[m
[32m+[m[32m   ```[m
[32m+[m[32m   The script formats sources, runs `dart analyze`, then runs `flutter --no-version-check test -x widget_dialog`. Outputs stream to the terminal and append to `buildlogs/last_test.txt`.[m
[32m+[m[32m3. Review failures and summarize them for follow-up:[m
[32m+[m[32m   ```bash[m
[32m+[m[32m   Open buildlogs/last_test.txt, list the top failure causes, propose minimal diffs, and apply them.[m
[32m+[m[32m   ```[m
[32m+[m[32m4. Re-run the test script after each patch. Repeat until the script exits cleanly.[m
[32m+[m[32m5. Once green, prepare the PR branch, craft a Conventional Commit message, and hand off for review.[m
[32m+[m
[32m+[m[32m## Notes[m
[32m+[m[32m- The script never touches Flutter caches; it uses `dart` for formatting and analysis and suppresses analytics.[m
[32m+[m[32m- `buildlogs/last_test.txt` is overwritten on each run, providing a single source of truth for the latest analyzer/test output.[m
[32m+[m[32m- Command approvals stay enabled through `.codex/config.toml`; expect the first invocation per session to request confirmation.[m
[32m+[m[32m- Keep prompts concise so Codex maintains enough context (restart the session if context approaches its limit).[m
[1mdiff --git a/lib/models/calc.dart b/lib/models/calc.dart[m
[1mindex 42dfef2..85bf5ed 100644[m
[1m--- a/lib/models/calc.dart[m
[1m+++ b/lib/models/calc.dart[m
[36m@@ -83,16 +83,20 @@[m [mQcFlags evaluateQc({[m
   final ratio = anisotropyRatio(rhoA, rhoB);[m
   final latestRho = _averageNullable([rhoA, rhoB]);[m
 [m
[31m-  final outlier = (resistanceA != null && resistanceA.abs() > config.outlierCapOhm) ||[m
[31m-      (resistanceB != null && resistanceB.abs() > config.outlierCapOhm);[m
[32m+[m[32m  final outlier =[m
[32m+[m[32m      (resistanceA != null && resistanceA.abs() > config.outlierCapOhm) ||[m
[32m+[m[32m          (resistanceB != null && resistanceB.abs() > config.outlierCapOhm);[m
   final highVariance = ((sdA ?? 0) >= config.sdThresholdPercent) ||[m
       ((sdB ?? 0) >= config.sdThresholdPercent);[m
   final anisotropy = ratio != null && ratio > config.anisotropyRatioThreshold;[m
 [m
   bool jump = false;[m
[31m-  if (previousRho != null && latestRho != null && previousRho > 0 && latestRho > 0) {[m
[31m-    final jumpMagnitude = (math.log(previousRho) / math.ln10) -[m
[31m-        (math.log(latestRho) / math.ln10);[m
[32m+[m[32m  if (previousRho != null &&[m
[32m+[m[32m      latestRho != null &&[m
[32m+[m[32m      previousRho > 0 &&[m
[32m+[m[32m      latestRho > 0) {[m
[32m+[m[32m    final jumpMagnitude =[m
[32m+[m[32m        (math.log(previousRho) / math.ln10) - (math.log(latestRho) / math.ln10);[m
     jump = jumpMagnitude.abs() > config.jumpThresholdLog10;[m
   }[m
 [m
[1mdiff --git a/lib/models/direction_reading.dart b/lib/models/direction_reading.dart[m
[1mindex 1ed41a1..34c21bb 100644[m
[1m--- a/lib/models/direction_reading.dart[m
[1m+++ b/lib/models/direction_reading.dart[m
[36m@@ -109,8 +109,7 @@[m [mclass DirectionReadingHistory {[m
 [m
   factory DirectionReadingHistory.fromJson(Map<String, dynamic> json) {[m
     return DirectionReadingHistory([m
[31m-      orientation:[m
[31m-          OrientationKind.values.byName(json['orientation'] as String),[m
[32m+[m[32m      orientation: OrientationKind.values.byName(json['orientation'] as String),[m
       label: json['label'] as String? ??[m
           OrientationKind.values[m
               .byName(json['orientation'] as String)[m
[36m@@ -126,12 +125,14 @@[m [mclass DirectionReadingHistory {[m
   final String label;[m
   final List<DirectionReadingSample> samples;[m
 [m
[31m-  DirectionReadingSample? get latest => samples.lastWhereOrNull((sample) {[m
[32m+[m[32m  DirectionReadingSample? get latest =>[m
[32m+[m[32m      samples.lastWhereOrNull((sample) {[m
         if (sample.isBad) {[m
           return false;[m
         }[m
         return sample.resistanceOhm != null;[m
[31m-      }) ?? samples.lastOrNull;[m
[32m+[m[32m      }) ??[m
[32m+[m[32m      samples.lastOrNull;[m
 [m
   bool get hasValidSample => samples.any((sample) => !sample.isBad);[m
 [m
[36m@@ -144,13 +145,14 @@[m [mclass DirectionReadingHistory {[m
     );[m
   }[m
 [m
[31m-  DirectionReadingHistory updateLatest(DirectionReadingSample Function(DirectionReadingSample current) updater) {[m
[32m+[m[32m  DirectionReadingHistory updateLatest([m
[32m+[m[32m      DirectionReadingSample Function(DirectionReadingSample current) updater) {[m
     if (samples.isEmpty) {[m
[31m-      return addSample(updater(DirectionReadingSample(timestamp: DateTime.now())));[m
[32m+[m[32m      return addSample([m
[32m+[m[32m          updater(DirectionReadingSample(timestamp: DateTime.now())));[m
     }[m
     final updatedSamples = [...samples];[m
[31m-    updatedSamples[updatedSamples.length - 1] =[m
[31m-        updater(updatedSamples.last);[m
[32m+[m[32m    updatedSamples[updatedSamples.length - 1] = updater(updatedSamples.last);[m
     return DirectionReadingHistory([m
       orientation: orientation,[m
       label: label,[m
[1mdiff --git a/lib/models/inversion_model.dart b/lib/models/inversion_model.dart[m
[1mindex b1e818a..a825393 100644[m
[1m--- a/lib/models/inversion_model.dart[m
[1m+++ b/lib/models/inversion_model.dart[m
[36m@@ -50,14 +50,17 @@[m [mclass InversionModel {[m
       };[m
 [m
   factory InversionModel.fromJson(Map<String, dynamic> json) => InversionModel([m
[31m-        layers:[m
[31m-            (json['layers'] as List).map((e) => Layer.fromJson(e as Map<String, dynamic>)).toList(),[m
[32m+[m[32m        layers: (json['layers'] as List)[m
[32m+[m[32m            .map((e) => Layer.fromJson(e as Map<String, dynamic>))[m
[32m+[m[32m            .toList(),[m
         rmsPct: (json['rmsPct'] as num).toDouble(),[m
         chiSq: (json['chiSq'] as num).toDouble(),[m
[31m-        predictedRho:[m
[31m-            (json['predictedRho'] as List).map((e) => (e as num).toDouble()).toList(),[m
[31m-        oneSigmaBand:[m
[31m-            (json['oneSigmaBand'] as List).map((e) => (e as num).toDouble()).toList(),[m
[32m+[m[32m        predictedRho: (json['predictedRho'] as List)[m
[32m+[m[32m            .map((e) => (e as num).toDouble())[m
[32m+[m[32m            .toList(),[m
[32m+[m[32m        oneSigmaBand: (json['oneSigmaBand'] as List)[m
[32m+[m[32m            .map((e) => (e as num).toDouble())[m
[32m+[m[32m            .toList(),[m
       );[m
 [m
   static const empty = InversionModel([m
[1mdiff --git a/lib/models/project.dart b/lib/models/project.dart[m
[1mindex 2753f82..f637513 100644[m
[1m--- a/lib/models/project.dart[m
[1m+++ b/lib/models/project.dart[m
[36m@@ -35,8 +35,8 @@[m [mclass ProjectRecord {[m
       projectId: projectId,[m
       projectName: projectName,[m
       arrayType: arrayType,[m
[31m-      canonicalSpacingsFeet: canonicalSpacingsFeet ??[m
[31m-          const [2.5, 5, 10, 20, 40, 60],[m
[32m+[m[32m      canonicalSpacingsFeet:[m
[32m+[m[32m          canonicalSpacingsFeet ?? const [2.5, 5, 10, 20, 40, 60],[m
       defaultPowerMilliAmps: 0.5,[m
       defaultStacks: 4,[m
     );[m
[36m@@ -47,11 +47,12 @@[m [mclass ProjectRecord {[m
     return ProjectRecord([m
       projectId: migrated['project_id'] as String,[m
       projectName: migrated['project_name'] as String,[m
[31m-      arrayType:[m
[31m-          ArrayType.values.byName(migrated['array_type'] as String? ?? 'wenner'),[m
[31m-      canonicalSpacingsFeet: (migrated['canonical_spacings_ft'] as List<dynamic>)[m
[31m-          .map((dynamic e) => (e as num).toDouble())[m
[31m-          .toList(),[m
[32m+[m[32m      arrayType: ArrayType.values[m
[32m+[m[32m          .byName(migrated['array_type'] as String? ?? 'wenner'),[m
[32m+[m[32m      canonicalSpacingsFeet:[m
[32m+[m[32m          (migrated['canonical_spacings_ft'] as List<dynamic>)[m
[32m+[m[32m              .map((dynamic e) => (e as num).toDouble())[m
[32m+[m[32m              .toList(),[m
       defaultPowerMilliAmps:[m
           (migrated['default_power_ma'] as num?)?.toDouble() ?? 0.5,[m
       defaultStacks: migrated['default_stacks'] as int? ?? 4,[m
[36m@@ -93,7 +94,8 @@[m [mclass ProjectRecord {[m
       arrayType: arrayType ?? this.arrayType,[m
       canonicalSpacingsFeet:[m
           canonicalSpacingsFeet ?? this.canonicalSpacingsFeet,[m
[31m-      defaultPowerMilliAmps: defaultPowerMilliAmps ?? this.defaultPowerMilliAmps,[m
[32m+[m[32m      defaultPowerMilliAmps:[m
[32m+[m[32m          defaultPowerMilliAmps ?? this.defaultPowerMilliAmps,[m
       defaultStacks: defaultStacks ?? this.defaultStacks,[m
       sites: sites ?? this.sites,[m
       schemaVersion: schemaVersion ?? this.schemaVersion,[m
[36m@@ -122,7 +124,8 @@[m [mclass ProjectRecord {[m
 [m
   ProjectRecord upsertSite(SiteRecord site) {[m
     final updated = [...sites];[m
[31m-    final index = updated.indexWhere((element) => element.siteId == site.siteId);[m
[32m+[m[32m    final index =[m
[32m+[m[32m        updated.indexWhere((element) => element.siteId == site.siteId);[m
     if (index >= 0) {[m
       updated[index] = site;[m
     } else {[m
[1mdiff --git a/lib/models/project_models.dart b/lib/models/project_models.dart[m
[1mindex 4f2fa77..ccd603e 100644[m
[1m--- a/lib/models/project_models.dart[m
[1m+++ b/lib/models/project_models.dart[m
[36m@@ -55,8 +55,7 @@[m [mclass SpacingPoint {[m
   }[m
 [m
   @override[m
[31m-  int get hashCode =>[m
[31m-      Object.hash(spacingMeters, rho, excluded, note);[m
[32m+[m[32m  int get hashCode => Object.hash(spacingMeters, rho, excluded, note);[m
 }[m
 [m
 @JsonSerializable(explicitToJson: true)[m
[36m@@ -74,8 +73,7 @@[m [mclass DirectionReadings {[m
   final Direction dir;[m
   final List<SpacingPoint> points;[m
 [m
[31m-  int get nIncluded =>[m
[31m-      points.where((p) => p.rho != null && !p.excluded).length;[m
[32m+[m[32m  int get nIncluded => points.where((p) => p.rho != null && !p.excluded).length;[m
 [m
   Iterable<SpacingPoint> get included =>[m
       points.where((p) => p.rho != null && !p.excluded);[m
[36m@@ -140,10 +138,12 @@[m [mclass Site {[m
       final resolved = meta as Map<String, dynamic>?;[m
       return resolved == null ? null : Map.unmodifiable(resolved);[m
     }[m
[32m+[m
     return Site([m
       siteId: siteId ?? this.siteId,[m
[31m-      displayName:[m
[31m-          identical(displayName, _unset) ? this.displayName : displayName as String?,[m
[32m+[m[32m      displayName: identical(displayName, _unset)[m
[32m+[m[32m          ? this.displayName[m
[32m+[m[32m          : displayName as String?,[m
       dirA: dirA ?? this.dirA,[m
       dirB: dirB ?? this.dirB,[m
       meta: resolveMeta(),[m
[36m@@ -238,7 +238,8 @@[m [mclass Project {[m
     return other is Project &&[m
         projectName == other.projectName &&[m
         arrayType == other.arrayType &&[m
[31m-        const ListEquality<double>().equals(spacingsMeters, other.spacingsMeters) &&[m
[32m+[m[32m        const ListEquality<double>()[m
[32m+[m[32m            .equals(spacingsMeters, other.spacingsMeters) &&[m
         const ListEquality<Site>().equals(sites, other.sites);[m
   }[m
 [m
[36m@@ -282,8 +283,9 @@[m [mclass QcStats {[m
     int? red,[m
   }) {[m
     return QcStats([m
[31m-      rmsPercent:[m
[31m-          identical(rmsPercent, _unset) ? this.rmsPercent : rmsPercent as double?,[m
[32m+[m[32m      rmsPercent: identical(rmsPercent, _unset)[m
[32m+[m[32m          ? this.rmsPercent[m
[32m+[m[32m          : rmsPercent as double?,[m
       chi2: identical(chi2, _unset) ? this.chi2 : chi2 as double?,[m
       green: green ?? this.green,[m
       yellow: yellow ?? this.yellow,[m
[1mdiff --git a/lib/models/site.dart b/lib/models/site.dart[m
[1mindex f7b472a..74a1d41 100644[m
[1m--- a/lib/models/site.dart[m
[1m+++ b/lib/models/site.dart[m
[36m@@ -94,8 +94,7 @@[m [mclass SpacingRecord {[m
 [m
   double get tapeOutsideFeet => spacingFeet * 1.5;[m
 [m
[31m-  double get tapeInsideMeters =>[m
[31m-      units.feetToMeters(tapeInsideFeet.toDouble());[m
[32m+[m[32m  double get tapeInsideMeters => units.feetToMeters(tapeInsideFeet.toDouble());[m
 [m
   double get tapeOutsideMeters =>[m
       units.feetToMeters(tapeOutsideFeet.toDouble());[m
[36m@@ -197,8 +196,8 @@[m [mclass SpacingRecord {[m
     if (sdValues.isEmpty) {[m
       return null;[m
     }[m
[31m-    final worst = sdValues.reduce((value, element) =>[m
[31m-        value >= element ? value : element);[m
[32m+[m[32m    final worst =[m
[32m+[m[32m        sdValues.reduce((value, element) => value >= element ? value : element);[m
     if (worst <= 5) {[m
       return interpretationGood;[m
     }[m
[36m@@ -246,8 +245,7 @@[m [mclass SiteRecord {[m
       moisture: MoistureLevel.values[m
           .byName(json['moisture'] as String? ?? MoistureLevel.normal.name),[m
       spacings: (json['spacings'] as List<dynamic>? ?? const [])[m
[31m-          .map((dynamic e) =>[m
[31m-              SpacingRecord.fromJson(e as Map<String, dynamic>))[m
[32m+[m[32m          .map((dynamic e) => SpacingRecord.fromJson(e as Map<String, dynamic>))[m
           .toList(),[m
     );[m
   }[m
[1mdiff --git a/lib/models/spacing_point.dart b/lib/models/spacing_point.dart[m
[1mindex 1b138ac..08b3b9d 100644[m
[1m--- a/lib/models/spacing_point.dart[m
[1m+++ b/lib/models/spacing_point.dart[m
[36m@@ -111,7 +111,10 @@[m [mclass _ResolvedInputs {[m
     final double normalizedFeet = aFeet;[m
 [m
     double? resolvedResistance = resistanceOhm;[m
[31m-    if (resolvedResistance == null && voltageV != null && currentA != null && currentA != 0) {[m
[32m+[m[32m    if (resolvedResistance == null &&[m
[32m+[m[32m        voltageV != null &&[m
[32m+[m[32m        currentA != null &&[m
[32m+[m[32m        currentA != 0) {[m
       resolvedResistance = voltageV / currentA;[m
     }[m
 [m
[36m@@ -195,15 +198,23 @@[m [mclass SpacingPoint {[m
     }[m
 [m
     double? resolvedResistance = resistanceOhm;[m
[31m-    if (resolvedResistance == null && combinedVoltage != null && combinedCurrent != null && combinedCurrent != 0) {[m
[32m+[m[32m    if (resolvedResistance == null &&[m
[32m+[m[32m        combinedVoltage != null &&[m
[32m+[m[32m        combinedCurrent != null &&[m
[32m+[m[32m        combinedCurrent != 0) {[m
       resolvedResistance = combinedVoltage / combinedCurrent;[m
     }[m
 [m
     double? resolvedRho = rhoAppOhmM;[m
[31m-    double? spacingForRho = resolvedMeters ?? (resolvedFeet != null ? feetToMeters(resolvedFeet) : null);[m
[31m-    double? geometryFactor =[m
[31m-        spacingForRho != null && spacingForRho > 0 ? _geometryFactorFor(arrayType, spacingForRho) : null;[m
[31m-    if (resolvedRho == null && resolvedResistance != null && geometryFactor != null && geometryFactor > 0) {[m
[32m+[m[32m    double? spacingForRho = resolvedMeters ??[m
[32m+[m[32m        (resolvedFeet != null ? feetToMeters(resolvedFeet) : null);[m
[32m+[m[32m    double? geometryFactor = spacingForRho != null && spacingForRho > 0[m
[32m+[m[32m        ? _geometryFactorFor(arrayType, spacingForRho)[m
[32m+[m[32m        : null;[m
[32m+[m[32m    if (resolvedRho == null &&[m
[32m+[m[32m        resolvedResistance != null &&[m
[32m+[m[32m        geometryFactor != null &&[m
[32m+[m[32m        geometryFactor > 0) {[m
       resolvedRho = resolvedResistance * geometryFactor;[m
       resolvedMeters ??= spacingForRho;[m
       if (resolvedFeet == null && spacingForRho != null) {[m
[36m@@ -232,11 +243,17 @@[m [mclass SpacingPoint {[m
       resolvedMeters = feetToMeters(resolvedFeet);[m
     }[m
 [m
[31m-    spacingForRho = resolvedMeters ?? (resolvedFeet != null ? feetToMeters(resolvedFeet) : null);[m
[31m-    geometryFactor =[m
[31m-        spacingForRho != null && spacingForRho > 0 ? _geometryFactorFor(arrayType, spacingForRho) : geometryFactor;[m
[31m-[m
[31m-    if (resolvedFeet == null && resolvedMeters == null && resolvedRho != null && resolvedResistance != null && resolvedResistance != 0) {[m
[32m+[m[32m    spacingForRho = resolvedMeters ??[m
[32m+[m[32m        (resolvedFeet != null ? feetToMeters(resolvedFeet) : null);[m
[32m+[m[32m    geometryFactor = spacingForRho != null && spacingForRho > 0[m
[32m+[m[32m        ? _geometryFactorFor(arrayType, spacingForRho)[m
[32m+[m[32m        : geometryFactor;[m
[32m+[m
[32m+[m[32m    if (resolvedFeet == null &&[m
[32m+[m[32m        resolvedMeters == null &&[m
[32m+[m[32m        resolvedRho != null &&[m
[32m+[m[32m        resolvedResistance != null &&[m
[32m+[m[32m        resolvedResistance != 0) {[m
       final derivedMeters = resolvedRho / (2 * math.pi * resolvedResistance);[m
       resolvedMeters = derivedMeters;[m
       resolvedFeet = metersToFeet(derivedMeters);[m
[36m@@ -247,20 +264,27 @@[m [mclass SpacingPoint {[m
     final resolvedFeetValue = resolvedFeet;[m
     final resolvedMetersValue = resolvedMeters;[m
     if (resolvedFeetValue == null || resolvedMetersValue == null) {[m
[31m-      throw ArgumentError('A-spacing could not be resolved from the provided inputs.');[m
[32m+[m[32m      throw ArgumentError([m
[32m+[m[32m          'A-spacing could not be resolved from the provided inputs.');[m
     }[m
 [m
[31m-    final geometryValue = geometryFactor ?? _geometryFactorFor(arrayType, resolvedMetersValue);[m
[32m+[m[32m    final geometryValue =[m
[32m+[m[32m        geometryFactor ?? _geometryFactorFor(arrayType, resolvedMetersValue);[m
 [m
     final resolvedRhoValue = resolvedRho ??[m
[31m-        (resolvedResistance != null && geometryValue > 0 ? resolvedResistance * geometryValue : null);[m
[32m+[m[32m        (resolvedResistance != null && geometryValue > 0[m
[32m+[m[32m            ? resolvedResistance * geometryValue[m
[32m+[m[32m            : null);[m
 [m
     if (resolvedRhoValue == null) {[m
[31m-      throw ArgumentError('Apparent resistivity could not be resolved from the provided inputs.');[m
[32m+[m[32m      throw ArgumentError([m
[32m+[m[32m          'Apparent resistivity could not be resolved from the provided inputs.');[m
     }[m
 [m
     double? resolvedSigmaRho = sigmaRhoOhmM;[m
[31m-    if (resolvedSigmaRho == null && resistanceStdOhm != null && geometryValue > 0) {[m
[32m+[m[32m    if (resolvedSigmaRho == null &&[m
[32m+[m[32m        resistanceStdOhm != null &&[m
[32m+[m[32m        geometryValue > 0) {[m
       resolvedSigmaRho = geometryValue * resistanceStdOhm;[m
     }[m
 [m
[36m@@ -360,11 +384,13 @@[m [mclass SpacingPoint {[m
   double? get sigmaRhoOhmM => _sigmaRhoOhmM;[m
   double? get sigmaRhoApp => sigmaRhoOhmM;[m
   double get geometryFactor => _geometryFactorFor(arrayType, spacingMeters);[m
[31m-  double get resistanceOhm => geometryFactor == 0 ? 0 : rhoAppOhmM / geometryFactor;[m
[32m+[m[32m  double get resistanceOhm =>[m
[32m+[m[32m      geometryFactor == 0 ? 0 : rhoAppOhmM / geometryFactor;[m
   double? get resistanceStdOhm {[m
     final sigma = sigmaRhoOhmM;[m
     return sigma != null && geometryFactor != 0 ? sigma / geometryFactor : null;[m
   }[m
[32m+[m
   double? get voltageV => _voltageV;[m
   double? get currentA => _currentA;[m
   double get vp {[m
[36m@@ -425,8 +451,9 @@[m [mclass SpacingPoint {[m
 [m
   bool get hasResistanceQaWarning => hasRhoQaWarning;[m
 [m
[31m-  double? get contactRMax =>[m
[31m-      contactR.values.isEmpty ? null : contactR.values.reduce((a, b) => a > b ? a : b);[m
[32m+[m[32m  double? get contactRMax => contactR.values.isEmpty[m
[32m+[m[32m      ? null[m
[32m+[m[32m      : contactR.values.reduce((a, b) => a > b ? a : b);[m
 [m
   SpacingPoint copyWith({[m
     ArrayType? arrayType,[m
[36m@@ -446,7 +473,8 @@[m [mclass SpacingPoint {[m
     String? notes,[m
   }) {[m
     final updatedFeet = aFeet ?? this.aFeet;[m
[31m-    final updatedSpacing = spacingMeters ?? (aFeet != null ? feetToMeters(aFeet) : this.spacingMeters);[m
[32m+[m[32m    final updatedSpacing = spacingMeters ??[m
[32m+[m[32m        (aFeet != null ? feetToMeters(aFeet) : this.spacingMeters);[m
     return SpacingPoint._([m
       id: id,[m
       arrayType: arrayType ?? this.arrayType,[m
[36m@@ -499,9 +527,12 @@[m [mclass SpacingPoint {[m
         orElse: () => ArrayType.custom,[m
       ),[m
       aFeet: (json['aFeet'] as num?)?.toDouble(),[m
[31m-      spacingMetric: (json['spacingMetric'] as num?)?.toDouble() ?? (json['aMeters'] as num?)?.toDouble(),[m
[31m-      rhoAppOhmM: (json['rhoAppOhmM'] as num?)?.toDouble() ?? (json['rhoApp'] as num?)?.toDouble(),[m
[31m-      sigmaRhoOhmM: (json['sigmaRhoOhmM'] as num?)?.toDouble() ?? (json['sigmaRhoApp'] as num?)?.toDouble(),[m
[32m+[m[32m      spacingMetric: (json['spacingMetric'] as num?)?.toDouble() ??[m
[32m+[m[32m          (json['aMeters'] as num?)?.toDouble(),[m
[32m+[m[32m      rhoAppOhmM: (json['rhoAppOhmM'] as num?)?.toDouble() ??[m
[32m+[m[32m          (json['rhoApp'] as num?)?.toDouble(),[m
[32m+[m[32m      sigmaRhoOhmM: (json['sigmaRhoOhmM'] as num?)?.toDouble() ??[m
[32m+[m[32m          (json['sigmaRhoApp'] as num?)?.toDouble(),[m
       resistanceOhm: (json['resistanceOhm'] as num?)?.toDouble(),[m
       resistanceStdOhm: (json['resistanceStdOhm'] as num?)?.toDouble(),[m
       direction: parseSoundingDirection(json['direction'] as String?),[m
[36m@@ -512,7 +543,9 @@[m [mclass SpacingPoint {[m
       ),[m
       spDriftMv: (json['spDriftMv'] as num?)?.toDouble(),[m
       stacks: json['stacks'] as int? ?? 1,[m
[31m-      repeats: (json['repeats'] as List?)?.map((e) => (e as num).toDouble()).toList(),[m
[32m+[m[32m      repeats: (json['repeats'] as List?)[m
[32m+[m[32m          ?.map((e) => (e as num).toDouble())[m
[32m+[m[32m          .toList(),[m
       timestamp: DateTime.parse(json['timestamp'] as String),[m
       excluded: json['excluded'] as bool? ?? false,[m
       notes: json['notes'] as String?,[m
[1mdiff --git a/lib/qc/qc.dart b/lib/qc/qc.dart[m
[1mindex 4251338..00cfd8a 100644[m
[1m--- a/lib/qc/qc.dart[m
[1m+++ b/lib/qc/qc.dart[m
[36m@@ -128,7 +128,8 @@[m [mclass QcController extends StateNotifier<QcState> {[m
     }[m
     final n = included.length.toDouble();[m
     final denominator = (n * sumXX) - (sumX * sumX);[m
[31m-    final slope = denominator == 0 ? 0 : ((n * sumXY) - (sumX * sumY)) / denominator;[m
[32m+[m[32m    final slope =[m
[32m+[m[32m        denominator == 0 ? 0 : ((n * sumXY) - (sumX * sumY)) / denominator;[m
     final intercept = (sumY - slope * sumX) / n;[m
 [m
     return [[m
[1mdiff --git a/lib/services/csv_io.dart b/lib/services/csv_io.dart[m
[1mindex 989f52e..4806090 100644[m
[1m--- a/lib/services/csv_io.dart[m
[1m+++ b/lib/services/csv_io.dart[m
[36m@@ -28,7 +28,8 @@[m [mclass CsvColumns {[m
 class CsvIoService {[m
   Future<List<SpacingPoint>> readFile(File file) async {[m
     final raw = await file.readAsString();[m
[31m-    final rows = const CsvToListConverter(eol: '\n').convert(raw, shouldParseNumbers: false);[m
[32m+[m[32m    final rows = const CsvToListConverter(eol: '\n')[m
[32m+[m[32m        .convert(raw, shouldParseNumbers: false);[m
     if (rows.isEmpty) return [];[m
 [m
     final header = rows.first.map((e) => e.toString()).toList();[m
[36m@@ -43,11 +44,15 @@[m [mclass CsvIoService {[m
       if (row.isEmpty) continue;[m
 [m
       double? aFeet = _readDouble(row, indexMap, [CsvColumns.aSpacingFt]);[m
[31m-      double? aMeters = _readDouble(row, indexMap, [CsvColumns.aSpacingM, CsvColumns.spacingLegacy]);[m
[32m+[m[32m      double? aMeters = _readDouble([m
[32m+[m[32m          row, indexMap, [CsvColumns.aSpacingM, CsvColumns.spacingLegacy]);[m
       double? resistance = _readDouble(row, indexMap, [CsvColumns.resistance]);[m
[31m-      double? resistanceStd = _readDouble(row, indexMap, [CsvColumns.resistanceStd]);[m
[31m-      double? rho = _readDouble(row, indexMap, [CsvColumns.rho, CsvColumns.rhoLegacy]);[m
[31m-      double? sigmaRho = _readDouble(row, indexMap, [CsvColumns.sigmaRho, CsvColumns.sigmaRhoLegacy]);[m
[32m+[m[32m      double? resistanceStd =[m
[32m+[m[32m          _readDouble(row, indexMap, [CsvColumns.resistanceStd]);[m
[32m+[m[32m      double? rho =[m
[32m+[m[32m          _readDouble(row, indexMap, [CsvColumns.rho, CsvColumns.rhoLegacy]);[m
[32m+[m[32m      double? sigmaRho = _readDouble([m
[32m+[m[32m          row, indexMap, [CsvColumns.sigmaRho, CsvColumns.sigmaRhoLegacy]);[m
       final voltage = _readDouble(row, indexMap, [CsvColumns.voltage]);[m
       final current = _readDouble(row, indexMap, [CsvColumns.current]);[m
       final directionText = _readString(row, indexMap, [CsvColumns.direction]);[m
[36m@@ -68,7 +73,11 @@[m [mclass CsvIoService {[m
         }[m
       }[m
 [m
[31m-      if (rho == null && voltage != null && current != null && current != 0 && aMeters != null) {[m
[32m+[m[32m      if (rho == null &&[m
[32m+[m[32m          voltage != null &&[m
[32m+[m[32m          current != null &&[m
[32m+[m[32m          current != 0 &&[m
[32m+[m[32m          aMeters != null) {[m
         final derivedResistance = voltage / current;[m
         final k = _geometryFactorForArray(array, aMeters);[m
         if (k > 0) {[m
[36m@@ -155,7 +164,8 @@[m [mclass CsvIoService {[m
     return file;[m
   }[m
 [m
[31m-  double? _readDouble(List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
[32m+[m[32m  double? _readDouble([m
[32m+[m[32m      List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
     for (final key in keys) {[m
       final index = indexMap[_normalizeHeader(key)];[m
       final value = _parseDouble(row, index);[m
[36m@@ -164,7 +174,8 @@[m [mclass CsvIoService {[m
     return null;[m
   }[m
 [m
[31m-  String? _readString(List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
[32m+[m[32m  String? _readString([m
[32m+[m[32m      List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
     for (final key in keys) {[m
       final index = indexMap[_normalizeHeader(key)];[m
       final value = _parseString(row, index);[m
[36m@@ -173,7 +184,8 @@[m [mclass CsvIoService {[m
     return null;[m
   }[m
 [m
[31m-  ArrayType? _readArray(List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
[32m+[m[32m  ArrayType? _readArray([m
[32m+[m[32m      List<dynamic> row, Map<String, int> indexMap, List<String> keys) {[m
     final text = _readString(row, indexMap, keys);[m
     if (text == null) return null;[m
     return ArrayType.values.firstWhere([m
[36m@@ -198,7 +210,8 @@[m [mclass CsvIoService {[m
   }[m
 }[m
 [m
[31m-String _normalizeHeader(String header) => header.trim().toLowerCase().replaceAll(RegExp(r'[^a-z0-9]+'), '_');[m
[32m+[m[32mString _normalizeHeader(String header) =>[m
[32m+[m[32m    header.trim().toLowerCase().replaceAll(RegExp(r'[^a-z0-9]+'), '_');[m
 [m
 double _geometryFactorForArray(ArrayType arrayType, double spacingMeters) {[m
   if (spacingMeters <= 0) {[m
[1mdiff --git a/lib/services/export_service.dart b/lib/services/export_service.dart[m
[1mindex 0beee8b..ef92ffb 100644[m
[1m--- a/lib/services/export_service.dart[m
[1m+++ b/lib/services/export_service.dart[m
[36m@@ -215,7 +215,8 @@[m [mclass ExportService {[m
           '${_formatSpacing(entry.distanceUnit, result.thicknessM!.toDouble())} ${_unitLabel(entry.distanceUnit)}',[m
           PdfColors.blueGrey600,[m
         ),[m
[31m-      _summaryChip('RMS', '${(result.rms * 100).toStringAsFixed(1)} %', PdfColors.indigo),[m
[32m+[m[32m      _summaryChip('RMS', '${(result.rms * 100).toStringAsFixed(1)} %',[m
[32m+[m[32m          PdfColors.indigo),[m
     ];[m
     return pw.Wrap([m
       spacing: 12,[m
[36m@@ -352,7 +353,8 @@[m [mclass ExportService {[m
     return value.toStringAsFixed(2);[m
   }[m
 [m
[31m-  String _unitLabel(DistanceUnit unit) => unit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m  String _unitLabel(DistanceUnit unit) =>[m
[32m+[m[32m      unit == DistanceUnit.feet ? 'ft' : 'm';[m
 [m
   PdfColor _mixColors(PdfColor a, PdfColor b, double t) {[m
     final clamped = t.clamp(0, 1);[m
[36m@@ -363,7 +365,8 @@[m [mclass ExportService {[m
     );[m
   }[m
 [m
[31m-  Future<void> _writeExportLog(ProjectRecord project, List<String> lines) async {[m
[32m+[m[32m  Future<void> _writeExportLog([m
[32m+[m[32m      ProjectRecord project, List<String> lines) async {[m
     final directory = Directory('logs');[m
     if (!await directory.exists()) {[m
       await directory.create(recursive: true);[m
[1mdiff --git a/lib/services/import/adapter_csv.dart b/lib/services/import/adapter_csv.dart[m
[1mindex 4acbaad..65498c6 100644[m
[1m--- a/lib/services/import/adapter_csv.dart[m
[1m+++ b/lib/services/import/adapter_csv.dart[m
[36m@@ -35,13 +35,15 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
         continue;[m
       }[m
       final lower = trimmed.toLowerCase();[m
[31m-      final isComment =[m
[31m-          trimmed.startsWith('#') || trimmed.startsWith('//') || trimmed.startsWith(';');[m
[32m+[m[32m      final isComment = trimmed.startsWith('#') ||[m
[32m+[m[32m          trimmed.startsWith('//') ||[m
[32m+[m[32m          trimmed.startsWith(';');[m
       if (!headerFound) {[m
         if (lower.startsWith('unit=')) {[m
           final equalsIndex = trimmed.indexOf('=');[m
[31m-          unitDirective =[m
[31m-              equalsIndex >= 0 ? trimmed.substring(equalsIndex + 1).trim() : null;[m
[32m+[m[32m          unitDirective = equalsIndex >= 0[m
[32m+[m[32m              ? trimmed.substring(equalsIndex + 1).trim()[m
[32m+[m[32m              : null;[m
           continue;[m
         }[m
         if (isComment) {[m
[36m@@ -57,8 +59,9 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
       if (isComment || lower.startsWith('unit=')) {[m
         if (lower.startsWith('unit=') && unitDirective == null) {[m
           final equalsIndex = trimmed.indexOf('=');[m
[31m-          unitDirective =[m
[31m-              equalsIndex >= 0 ? trimmed.substring(equalsIndex + 1).trim() : null;[m
[32m+[m[32m          unitDirective = equalsIndex >= 0[m
[32m+[m[32m              ? trimmed.substring(equalsIndex + 1).trim()[m
[32m+[m[32m              : null;[m
         }[m
         continue;[m
       }[m
[36m@@ -66,7 +69,8 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
     }[m
 [m
     if (filteredLines.isEmpty) {[m
[31m-      return ImportTable(headers: const [], rows: const [], unitDirective: unitDirective);[m
[32m+[m[32m      return ImportTable([m
[32m+[m[32m          headers: const [], rows: const [], unitDirective: unitDirective);[m
     }[m
 [m
     final delimiter = _detectDelimiter(filteredLines);[m
[36m@@ -77,7 +81,8 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
     );[m
     final rawRows = converter.convert(filteredLines.join('\n'));[m
     if (rawRows.isEmpty) {[m
[31m-      return ImportTable(headers: const [], rows: const [], unitDirective: unitDirective);[m
[32m+[m[32m      return ImportTable([m
[32m+[m[32m          headers: const [], rows: const [], unitDirective: unitDirective);[m
     }[m
 [m
     final normalized = rawRows[m
[36m@@ -90,7 +95,8 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
         .toList(growable: false);[m
 [m
     if (normalized.isEmpty) {[m
[31m-      return ImportTable(headers: const [], rows: const [], unitDirective: unitDirective);[m
[32m+[m[32m      return ImportTable([m
[32m+[m[32m          headers: const [], rows: const [], unitDirective: unitDirective);[m
     }[m
 [m
     final headerResult = _normalizeHeaderRow(normalized.first);[m
[36m@@ -100,9 +106,11 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
         (index) => 'column_${index + 1}',[m
       );[m
       final rows = normalized[m
[31m-          .map((row) => row.take(inferredHeaders.length).toList(growable: false))[m
[32m+[m[32m          .map([m
[32m+[m[32m              (row) => row.take(inferredHeaders.length).toList(growable: false))[m
           .toList(growable: false);[m
[31m-      return ImportTable(headers: inferredHeaders, rows: rows, unitDirective: unitDirective);[m
[32m+[m[32m      return ImportTable([m
[32m+[m[32m          headers: inferredHeaders, rows: rows, unitDirective: unitDirective);[m
     }[m
 [m
     final dataRows = <List<String>>[];[m
[36m@@ -152,7 +160,8 @@[m [mclass CsvImportAdapter implements ImportAdapter {[m
     if (lines.isEmpty) {[m
       return ',';[m
     }[m
[31m-    final sample = lines.where((line) => line.trim().isNotEmpty).take(10).toList();[m
[32m+[m[32m    final sample =[m
[32m+[m[32m        lines.where((line) => line.trim().isNotEmpty).take(10).toList();[m
     if (sample.isEmpty) {[m
       return ',';[m
     }[m
[1mdiff --git a/lib/services/import/adapter_excel.dart b/lib/services/import/adapter_excel.dart[m
[1mindex 9a109bc..7ef1552 100644[m
[1m--- a/lib/services/import/adapter_excel.dart[m
[1m+++ b/lib/services/import/adapter_excel.dart[m
[36m@@ -26,7 +26,8 @@[m [mclass ExcelImportAdapter implements ImportAdapter {[m
     for (var i = 0; i < sheet.maxRows; i++) {[m
       final row = sheet.row(i);[m
       final values = row[m
[31m-          .map((cell) => cell?.value == null ? '' : cell!.value.toString().trim())[m
[32m+[m[32m          .map((cell) =>[m
[32m+[m[32m              cell?.value == null ? '' : cell!.value.toString().trim())[m
           .toList();[m
       final hasData = values.any((value) => value.isNotEmpty);[m
       if (!hasData) {[m
[36m@@ -35,7 +36,9 @@[m [mclass ExcelImportAdapter implements ImportAdapter {[m
       final firstLower = values.first.toLowerCase();[m
       if (firstLower.startsWith('unit=')) {[m
         final equalsIndex = values.first.indexOf('=');[m
[31m-        unitDirective = equalsIndex >= 0 ? values.first.substring(equalsIndex + 1).trim() : null;[m
[32m+[m[32m        unitDirective = equalsIndex >= 0[m
[32m+[m[32m            ? values.first.substring(equalsIndex + 1).trim()[m
[32m+[m[32m            : null;[m
         continue;[m
       }[m
       if (header == null) {[m
[36m@@ -48,13 +51,18 @@[m [mclass ExcelImportAdapter implements ImportAdapter {[m
       if (values.length < header.length) {[m
         values.addAll(List.filled(header.length - values.length, ''));[m
       } else if (values.length > header.length) {[m
[31m-        issues.add(ImportRowIssue(index: i + 1, message: 'Row has more columns than header.')); [m
[32m+[m[32m        issues.add(ImportRowIssue([m
[32m+[m[32m            index: i + 1, message: 'Row has more columns than header.'));[m
         values.removeRange(header.length, values.length);[m
       }[m
       rows.add(values);[m
     }[m
 [m
     header ??= const [];[m
[31m-    return ImportTable(headers: header, rows: rows, issues: issues, unitDirective: unitDirective);[m
[32m+[m[32m    return ImportTable([m
[32m+[m[32m        headers: header,[m
[32m+[m[32m        rows: rows,[m
[32m+[m[32m        issues: issues,[m
[32m+[m[32m        unitDirective: unitDirective);[m
   }[m
 }[m
[1mdiff --git a/lib/services/import/adapter_surfer_dat.dart b/lib/services/import/adapter_surfer_dat.dart[m
[1mindex 9cc3e0b..424a50c 100644[m
[1m--- a/lib/services/import/adapter_surfer_dat.dart[m
[1m+++ b/lib/services/import/adapter_surfer_dat.dart[m
[36m@@ -27,16 +27,20 @@[m [mclass SurferDatImportAdapter implements ImportAdapter {[m
       if (line.isEmpty) {[m
         continue;[m
       }[m
[31m-      if (line.startsWith('#') || line.startsWith('//') || line.startsWith(';')) {[m
[32m+[m[32m      if (line.startsWith('#') ||[m
[32m+[m[32m          line.startsWith('//') ||[m
[32m+[m[32m          line.startsWith(';')) {[m
         continue;[m
       }[m
       final lower = line.toLowerCase();[m
       if (lower.startsWith('unit=')) {[m
         final equalsIndex = line.indexOf('=');[m
[31m-        unitDirective = equalsIndex >= 0 ? line.substring(equalsIndex + 1).trim() : null;[m
[32m+[m[32m        unitDirective =[m
[32m+[m[32m            equalsIndex >= 0 ? line.substring(equalsIndex + 1).trim() : null;[m
         continue;[m
       }[m
[31m-      final parts = line.split(_whitespace).where((part) => part.isNotEmpty).toList();[m
[32m+[m[32m      final parts =[m
[32m+[m[32m          line.split(_whitespace).where((part) => part.isNotEmpty).toList();[m
       if (parts.isEmpty) {[m
         continue;[m
       }[m
[36m@@ -45,26 +49,34 @@[m [mclass SurferDatImportAdapter implements ImportAdapter {[m
         continue;[m
       }[m
       if (parts.length < 3) {[m
[31m-        issues.add(ImportRowIssue(index: i + 1, message: 'Expected 3 numeric values.'));[m
[32m+[m[32m        issues.add(ImportRowIssue([m
[32m+[m[32m            index: i + 1, message: 'Expected 3 numeric values.'));[m
         continue;[m
       }[m
[31m-      final values = parts.take(3).map((value) => value.trim()).toList(growable: false);[m
[31m-      if (!_isNumeric(values[0]) || !_isNumeric(values[1]) || !_isNumeric(values[2])) {[m
[31m-        issues.add(ImportRowIssue(index: i + 1, message: 'Non-numeric value encountered.'));[m
[32m+[m[32m      final values =[m
[32m+[m[32m          parts.take(3).map((value) => value.trim()).toList(growable: false);[m
[32m+[m[32m      if (!_isNumeric(values[0]) ||[m
[32m+[m[32m          !_isNumeric(values[1]) ||[m
[32m+[m[32m          !_isNumeric(values[2])) {[m
[32m+[m[32m        issues.add(ImportRowIssue([m
[32m+[m[32m            index: i + 1, message: 'Non-numeric value encountered.'));[m
         continue;[m
       }[m
       rows.add(values);[m
     }[m
 [m
[31m-    header ??= const ['X', 'Y', 'Z'];[m
[31m-    if (header.length > 3) {[m
[31m-      header = header.take(3).toList(growable: false);[m
[31m-    } else if (header.length < 3) {[m
[31m-      header = [...header, for (var i = header.length; i < 3; i++) 'Value ${i + 1}'];[m
[32m+[m[32m    var headers = header ?? const ['X', 'Y', 'Z'];[m
[32m+[m[32m    if (headers.length > 3) {[m
[32m+[m[32m      headers = headers.take(3).toList(growable: false);[m
[32m+[m[32m    } else if (headers.length < 3) {[m
[32m+[m[32m      headers = [[m
[32m+[m[32m        ...headers,[m
[32m+[m[32m        for (var i = headers.length; i < 3; i++) 'Value ${i + 1}'[m
[32m+[m[32m      ];[m
     }[m
 [m
     return ImportTable([m
[31m-      headers: header!,[m
[32m+[m[32m      headers: headers,[m
       rows: rows,[m
       issues: issues,[m
       unitDirective: unitDirective,[m
[1mdiff --git a/lib/services/import/import_models.dart b/lib/services/import/import_models.dart[m
[1mindex b0c86d3..47083cb 100644[m
[1m--- a/lib/services/import/import_models.dart[m
[1m+++ b/lib/services/import/import_models.dart[m
[36m@@ -286,6 +286,7 @@[m [mextension ImportColumnTargetLabel on ImportColumnTarget {[m
 [m
 extension ImportColumnDescriptorLookup on Iterable<ImportColumnDescriptor> {[m
   ImportColumnDescriptor? byTarget(ImportColumnTarget target) {[m
[31m-    return firstWhereOrNull((descriptor) => descriptor.suggestedTarget == target);[m
[32m+[m[32m    return firstWhereOrNull([m
[32m+[m[32m        (descriptor) => descriptor.suggestedTarget == target);[m
   }[m
 }[m
[1mdiff --git a/lib/services/import/import_service.dart b/lib/services/import/import_service.dart[m
[1mindex 1d3738d..1e2f954 100644[m
[1m--- a/lib/services/import/import_service.dart[m
[1m+++ b/lib/services/import/import_service.dart[m
[36m@@ -28,7 +28,8 @@[m [mclass ImportService {[m
     return ImportSession(source: source, table: table, preview: preview);[m
   }[m
 [m
[31m-  ImportValidationResult validate(ImportSession session, ImportMapping mapping) {[m
[32m+[m[32m  ImportValidationResult validate([m
[32m+[m[32m      ImportSession session, ImportMapping mapping) {[m
     final table = session.table;[m
     if (table.headers.isEmpty) {[m
       return ImportValidationResult([m
[36m@@ -39,24 +40,31 @@[m [mclass ImportService {[m
         spacings: const [],[m
       );[m
     }[m
[31m-    final assignments = mapping.assignments.map((key, value) => MapEntry(key, value));[m
[31m-    final spacingColumn = _columnFor(assignments, ImportColumnTarget.aSpacingFeet);[m
[32m+[m[32m    final assignments =[m
[32m+[m[32m        mapping.assignments.map((key, value) => MapEntry(key, value));[m
[32m+[m[32m    final spacingColumn =[m
[32m+[m[32m        _columnFor(assignments, ImportColumnTarget.aSpacingFeet);[m
     if (spacingColumn == null) {[m
       return ImportValidationResult([m
         totalRows: table.rows.length,[m
         importedRows: 0,[m
         skippedRows: table.rows.length,[m
         issues: [[m
[31m-          ImportValidationIssue(rowIndex: 0, message: 'Map an a-spacing column to import.'),[m
[32m+[m[32m          ImportValidationIssue([m
[32m+[m[32m              rowIndex: 0, message: 'Map an a-spacing column to import.'),[m
         ],[m
         spacings: const [],[m
       );[m
     }[m
     final unitColumn = _columnFor(assignments, ImportColumnTarget.units);[m
[31m-    final pinsInsideColumn = _columnFor(assignments, ImportColumnTarget.pinsInsideFeet);[m
[31m-    final pinsOutsideColumn = _columnFor(assignments, ImportColumnTarget.pinsOutsideFeet);[m
[31m-    final resNsColumn = _columnFor(assignments, ImportColumnTarget.resistanceNsOhm);[m
[31m-    final resWeColumn = _columnFor(assignments, ImportColumnTarget.resistanceWeOhm);[m
[32m+[m[32m    final pinsInsideColumn =[m
[32m+[m[32m        _columnFor(assignments, ImportColumnTarget.pinsInsideFeet);[m
[32m+[m[32m    final pinsOutsideColumn =[m
[32m+[m[32m        _columnFor(assignments, ImportColumnTarget.pinsOutsideFeet);[m
[32m+[m[32m    final resNsColumn =[m
[32m+[m[32m        _columnFor(assignments, ImportColumnTarget.resistanceNsOhm);[m
[32m+[m[32m    final resWeColumn =[m
[32m+[m[32m        _columnFor(assignments, ImportColumnTarget.resistanceWeOhm);[m
     final sdNsColumn = _columnFor(assignments, ImportColumnTarget.sdNsPercent);[m
     final sdWeColumn = _columnFor(assignments, ImportColumnTarget.sdWePercent);[m
 [m
[36m@@ -73,22 +81,29 @@[m [mclass ImportService {[m
       final spacingValue = _parseDouble(row, spacingColumn);[m
       if (spacingValue == null) {[m
         skipped++;[m
[31m-        issues.add(ImportValidationIssue(rowIndex: rowIndex, message: 'Missing a-spacing value.'));[m
[32m+[m[32m        issues.add(ImportValidationIssue([m
[32m+[m[32m            rowIndex: rowIndex, message: 'Missing a-spacing value.'));[m
         continue;[m
       }[m
       if (spacingValue <= 0) {[m
         skipped++;[m
[31m-        issues.add(ImportValidationIssue(rowIndex: rowIndex, message: 'Negative or zero a-spacing.'));[m
[32m+[m[32m        issues.add(ImportValidationIssue([m
[32m+[m[32m            rowIndex: rowIndex, message: 'Negative or zero a-spacing.'));[m
         continue;[m
       }[m
[31m-      final spacingFeet = double.parse(unit.toFeet(spacingValue).toStringAsFixed(5));[m
[31m-      if (!_checkPinsConsistency(row, pinsInsideColumn, pinsOutsideColumn, spacingFeet, unit)) {[m
[31m-        issues.add(ImportValidationIssue(rowIndex: rowIndex, message: 'Pins in/out do not match a-spacing.'));[m
[32m+[m[32m      final spacingFeet =[m
[32m+[m[32m          double.parse(unit.toFeet(spacingValue).toStringAsFixed(5));[m
[32m+[m[32m      if (!_checkPinsConsistency([m
[32m+[m[32m          row, pinsInsideColumn, pinsOutsideColumn, spacingFeet, unit)) {[m
[32m+[m[32m        issues.add(ImportValidationIssue([m
[32m+[m[32m            rowIndex: rowIndex,[m
[32m+[m[32m            message: 'Pins in/out do not match a-spacing.'));[m
       }[m
       final spacingKey = _roundSpacing(spacingFeet);[m
       if (seenSpacings.contains(spacingKey)) {[m
         skipped++;[m
[31m-        issues.add(ImportValidationIssue(rowIndex: rowIndex, message: 'Duplicate a-spacing encountered.'));[m
[32m+[m[32m        issues.add(ImportValidationIssue([m
[32m+[m[32m            rowIndex: rowIndex, message: 'Duplicate a-spacing encountered.'));[m
         continue;[m
       }[m
       final resistanceNs = _parseDouble(row, resNsColumn);[m
[36m@@ -98,7 +113,9 @@[m [mclass ImportService {[m
 [m
       if (resistanceNs == null && resistanceWe == null) {[m
         skipped++;[m
[31m-        issues.add(ImportValidationIssue(rowIndex: rowIndex, message: 'No resistivity columns mapped for this row.'));[m
[32m+[m[32m        issues.add(ImportValidationIssue([m
[32m+[m[32m            rowIndex: rowIndex,[m
[32m+[m[32m            message: 'No resistivity columns mapped for this row.'));[m
         continue;[m
       }[m
 [m
[36m@@ -125,7 +142,9 @@[m [mclass ImportService {[m
     );[m
   }[m
 [m
[31m-  ImportMergePreview previewMerge(SiteRecord? existing, ImportValidationResult validation, {bool overwrite = false}) {[m
[32m+[m[32m  ImportMergePreview previewMerge([m
[32m+[m[32m      SiteRecord? existing, ImportValidationResult validation,[m
[32m+[m[32m      {bool overwrite = false}) {[m
     if (existing == null) {[m
       return ImportMergePreview([m
         newRows: validation.importedRows,[m
[36m@@ -139,7 +158,8 @@[m [mclass ImportService {[m
     var updatedRows = 0;[m
     var skipped = 0;[m
 [m
[31m-    final existingSpacings = existing.spacings.map((spacing) => spacing.spacingFeet).toSet();[m
[32m+[m[32m    final existingSpacings =[m
[32m+[m[32m        existing.spacings.map((spacing) => spacing.spacingFeet).toSet();[m
     for (final spacing in validation.spacings) {[m
       if (!existingSpacings.contains(spacing.spacingFeet)) {[m
         newRows++;[m
[36m@@ -209,8 +229,7 @@[m [mclass ImportService {[m
     }[m
     return ImportMapping([m
       assignments: assignments,[m
[31m-      distanceUnit:[m
[31m-          preview.unitDetection.unit ?? ImportDistanceUnit.meters,[m
[32m+[m[32m      distanceUnit: preview.unitDetection.unit ?? ImportDistanceUnit.meters,[m
     );[m
   }[m
 [m
[36m@@ -248,7 +267,10 @@[m [mclass ImportService {[m
       );[m
     }[m
 [m
[31m-    final previewRows = table.rows.take(20).map((row) => row.take(table.headers.length).toList()).toList();[m
[32m+[m[32m    final previewRows = table.rows[m
[32m+[m[32m        .take(20)[m
[32m+[m[32m        .map((row) => row.take(table.headers.length).toList())[m
[32m+[m[32m        .toList();[m
     final detection = _detectUnits(fileName, table, columns);[m
     return ImportPreview([m
       typeLabel: typeLabel,[m
[36m@@ -278,10 +300,12 @@[m [mclass ImportService {[m
     return 'Delimited text';[m
   }[m
 [m
[31m-  ImportColumnTarget? _suggestTarget(String header, List<String> samples, bool isNumeric) {[m
[32m+[m[32m  ImportColumnTarget? _suggestTarget([m
[32m+[m[32m      String header, List<String> samples, bool isNumeric) {[m
     final normalized = header.toLowerCase();[m
     final sanitized = normalized.replaceAll(RegExp(r'[^a-z0-9]+'), ' ');[m
[31m-    bool containsAny(List<String> tokens) => tokens.any((token) => sanitized.contains(token));[m
[32m+[m[32m    bool containsAny(List<String> tokens) =>[m
[32m+[m[32m        tokens.any((token) => sanitized.contains(token));[m
 [m
     if (containsAny(['unit', 'units'])) {[m
       return ImportColumnTarget.units;[m
[36m@@ -330,7 +354,8 @@[m [mclass ImportService {[m
     return null;[m
   }[m
 [m
[31m-  int? _columnFor(Map<int, ImportColumnTarget> assignments, ImportColumnTarget target) {[m
[32m+[m[32m  int? _columnFor([m
[32m+[m[32m      Map<int, ImportColumnTarget> assignments, ImportColumnTarget target) {[m
     for (final entry in assignments.entries) {[m
       if (entry.value == target) {[m
         return entry.key;[m
[36m@@ -339,7 +364,8 @@[m [mclass ImportService {[m
     return null;[m
   }[m
 [m
[31m-  ImportDistanceUnit _resolveUnit(List<String> row, int? unitColumn, ImportDistanceUnit fallback) {[m
[32m+[m[32m  ImportDistanceUnit _resolveUnit([m
[32m+[m[32m      List<String> row, int? unitColumn, ImportDistanceUnit fallback) {[m
     if (unitColumn == null || unitColumn >= row.length) {[m
       return fallback;[m
     }[m
[36m@@ -370,11 +396,12 @@[m [mclass ImportService {[m
     }[m
     var numeric = 0;[m
     for (final sample in samples) {[m
[31m-      if (double.tryParse(sample.replaceAll(RegExp(r'[^0-9eE+\-.]'), '')) != null) {[m
[32m+[m[32m      if (double.tryParse(sample.replaceAll(RegExp(r'[^0-9eE+\-.]'), '')) !=[m
[32m+[m[32m          null) {[m
         numeric++;[m
       }[m
     }[m
[31m-      return numeric >= math.max(1, samples.length ~/ 2);[m
[32m+[m[32m    return numeric >= math.max(1, samples.length ~/ 2);[m
   }[m
 [m
   String _normalizeNumeric(String text) {[m
[36m@@ -518,7 +545,8 @@[m [mclass ImportService {[m
       final values = <double>[];[m
       for (final row in table.rows.take(80)) {[m
         if (spacingColumn.index < row.length) {[m
[31m-          final value = double.tryParse(_normalizeNumeric(row[spacingColumn.index]));[m
[32m+[m[32m          final value =[m
[32m+[m[32m              double.tryParse(_normalizeNumeric(row[spacingColumn.index]));[m
           if (value != null && value.isFinite) {[m
             values.add(value.abs());[m
           }[m
[36m@@ -539,15 +567,16 @@[m [mclass ImportService {[m
           final remainder = value % step;[m
           return remainder <= tolerance || (step - remainder) <= tolerance;[m
         }[m
[31m-        final multiplesOfFive = values[m
[31m-            .where((value) {[m
[31m-              if (value < 5) {[m
[31m-                return false;[m
[31m-              }[m
[31m-              return nearMultiple(value, 5, 0.01);[m
[31m-            })[m
[31m-            .length;[m
[31m-        if (values.length >= 3 && multiplesOfFive >= (values.length * 0.6) && max >= 20) {[m
[32m+[m
[32m+[m[32m        final multiplesOfFive = values.where((value) {[m
[32m+[m[32m          if (value < 5) {[m
[32m+[m[32m            return false;[m
[32m+[m[32m          }[m
[32m+[m[32m          return nearMultiple(value, 5, 0.01);[m
[32m+[m[32m        }).length;[m
[32m+[m[32m        if (values.length >= 3 &&[m
[32m+[m[32m            multiplesOfFive >= (values.length * 0.6) &&[m
[32m+[m[32m            max >= 20) {[m
           addSignal([m
             ImportDistanceUnit.feet,[m
             0.5,[m
[36m@@ -581,7 +610,8 @@[m [mclass ImportService {[m
       }[m
     }[m
     final ambiguous = top.confidence < 0.6 ||[m
[31m-        (competitor != null && (top.confidence - competitor.confidence).abs() <= 0.15);[m
[32m+[m[32m        (competitor != null &&[m
[32m+[m[32m            (top.confidence - competitor.confidence).abs() <= 0.15);[m
     return ImportUnitDetection([m
       unit: top.unit,[m
       reason: top.reason,[m
[36m@@ -605,11 +635,13 @@[m [mclass ImportService {[m
 [m
   ImportDistanceUnit? _unitFromHeaderSuffix(String header) {[m
     final normalized = header.toLowerCase();[m
[31m-    if (normalized.endsWith('_m') || normalized.endsWith('_meter') ||[m
[32m+[m[32m    if (normalized.endsWith('_m') ||[m
[32m+[m[32m        normalized.endsWith('_meter') ||[m
         normalized.endsWith('_meters')) {[m
       return ImportDistanceUnit.meters;[m
     }[m
[31m-    if (normalized.endsWith('_ft') || normalized.endsWith('_foot') ||[m
[32m+[m[32m    if (normalized.endsWith('_ft') ||[m
[32m+[m[32m        normalized.endsWith('_foot') ||[m
         normalized.endsWith('_feet')) {[m
       return ImportDistanceUnit.feet;[m
     }[m
[36m@@ -624,7 +656,9 @@[m [mclass ImportService {[m
     if (normalized.contains('meter') || normalized == 'm') {[m
       return ImportDistanceUnit.meters;[m
     }[m
[31m-    if (normalized.contains('foot') || normalized.contains('feet') || normalized.contains('ft')) {[m
[32m+[m[32m    if (normalized.contains('foot') ||[m
[32m+[m[32m        normalized.contains('feet') ||[m
[32m+[m[32m        normalized.contains('ft')) {[m
       return ImportDistanceUnit.feet;[m
     }[m
     return null;[m
[1mdiff --git a/lib/services/inversion.dart b/lib/services/inversion.dart[m
[1mindex b6aa31e..657b9ae 100644[m
[1m--- a/lib/services/inversion.dart[m
[1m+++ b/lib/services/inversion.dart[m
[36m@@ -97,9 +97,11 @@[m [mclass TwoLayerInversionResult {[m
     }[m
   }[m
 [m
[31m-  double get minRho => _allRhoSamples.isEmpty ? 1 : _allRhoSamples.reduce(math.min);[m
[32m+[m[32m  double get minRho =>[m
[32m+[m[32m      _allRhoSamples.isEmpty ? 1 : _allRhoSamples.reduce(math.min);[m
 [m
[31m-  double get maxRho => _allRhoSamples.isEmpty ? 1 : _allRhoSamples.reduce(math.max);[m
[32m+[m[32m  double get maxRho =>[m
[32m+[m[32m      _allRhoSamples.isEmpty ? 1 : _allRhoSamples.reduce(math.max);[m
 }[m
 [m
 class _InversionAttempt {[m
[36m@@ -205,8 +207,9 @@[m [mFuture<TwoLayerInversionResult?> invertTwoLayerSite(SiteRecord site) async {[m
       ? result.fitCurve[m
       : List<double>.generate([m
           input.spacingFeet.length,[m
[31m-          (index) =>[m
[31m-              result.fitCurve[index < result.fitCurve.length ? index : result.fitCurve.length - 1],[m
[32m+[m[32m          (index) => result.fitCurve[index < result.fitCurve.length[m
[32m+[m[32m              ? index[m
[32m+[m[32m              : result.fitCurve.length - 1],[m
         );[m
   final summary = TwoLayerInversionResult([m
     spacingFeet: input.spacingFeet,[m
[36m@@ -216,7 +219,8 @@[m [mFuture<TwoLayerInversionResult?> invertTwoLayerSite(SiteRecord site) async {[m
     layerDepths: result.depthsM,[m
     rho1: result.resistivities.first,[m
     rho2: result.resistivities[1],[m
[31m-    halfSpaceRho: result.resistivities.length > 2 ? result.resistivities.last : null,[m
[32m+[m[32m    halfSpaceRho:[m
[32m+[m[32m        result.resistivities.length > 2 ? result.resistivities.last : null,[m
     rms: result.misfit,[m
     thicknessM: thicknessM,[m
   );[m
[36m@@ -411,8 +415,8 @@[m [mvoid _clampFirstLayerSeed([m
   if (band == null) {[m
     return;[m
   }[m
[31m-  final clamped = math.log(seed.first.clamp(minRho, maxRho))[m
[31m-      .clamp(band.lower, band.upper);[m
[32m+[m[32m  final clamped =[m
[32m+[m[32m      math.log(seed.first.clamp(minRho, maxRho)).clamp(band.lower, band.upper);[m
   seed[0] = math.exp(clamped).clamp(minRho, maxRho).toDouble();[m
 }[m
 [m
[36m@@ -654,7 +658,8 @@[m [m_InversionAttempt _segmentalApproximation({[m
   }[m
 [m
   final guard = math.max(minThick, 0.25);[m
[31m-  final maxDepthAvailable = units.feetToMeters(aggregated.last.spacingFt * 0.5).toDouble();[m
[32m+[m[32m  final maxDepthAvailable =[m
[32m+[m[32m      units.feetToMeters(aggregated.last.spacingFt * 0.5).toDouble();[m
   var previousDepth = 0.0;[m
   for (var i = 0; i < depths.length; i++) {[m
     var depth = depths[i];[m
[36m@@ -663,9 +668,7 @@[m [m_InversionAttempt _segmentalApproximation({[m
       depth = minDepth;[m
     }[m
     final maxDepth = math.min(previousDepth + maxThick, maxDepthAvailable);[m
[31m-    depth = depth[m
[31m-        .clamp(minDepth, math.max(minDepth, maxDepth))[m
[31m-        .toDouble();[m
[32m+[m[32m    depth = depth.clamp(minDepth, math.max(minDepth, maxDepth)).toDouble();[m
     depths[i] = depth;[m
     previousDepth = depth;[m
   }[m
[36m@@ -893,7 +896,8 @@[m [mList<double> _estimateLayerResistivities([m
   return resistivities;[m
 }[m
 [m
[31m-List<double?> _buildThicknesses(List<double> boundaries, double minThick, double maxThick) {[m
[32m+[m[32mList<double?> _buildThicknesses([m
[32m+[m[32m    List<double> boundaries, double minThick, double maxThick) {[m
   if (boundaries.isEmpty) {[m
     return [null];[m
   }[m
[36m@@ -1079,20 +1083,25 @@[m [m_SiteInversionInput _aggregateSiteForInversion(SiteRecord site) {[m
   for (final spacing in spacings) {[m
     final aSample = spacing.orientationA.latest;[m
     final bSample = spacing.orientationB.latest;[m
[31m-    final hasA =[m
[31m-        aSample != null && !aSample.isBad && (aSample.resistanceOhm ?? 0) > 0;[m
[31m-    final hasB =[m
[31m-        bSample != null && !bSample.isBad && (bSample.resistanceOhm ?? 0) > 0;[m
[31m-    if (!hasA && !hasB) {[m
[31m-      continue;[m
[31m-    }[m
[32m+[m
     double? rhoA;[m
[31m-    if (hasA) {[m
[31m-      rhoA = calc.rhoAWenner(spacing.spacingFeet, aSample!.resistanceOhm!);[m
[32m+[m[32m    if (aSample != null && !aSample.isBad) {[m
[32m+[m[32m      final resistance = aSample.resistanceOhm;[m
[32m+[m[32m      if (resistance != null && resistance > 0) {[m
[32m+[m[32m        rhoA = calc.rhoAWenner(spacing.spacingFeet, resistance);[m
[32m+[m[32m      }[m
     }[m
[32m+[m
     double? rhoB;[m
[31m-    if (hasB) {[m
[31m-      rhoB = calc.rhoAWenner(spacing.spacingFeet, bSample!.resistanceOhm!);[m
[32m+[m[32m    if (bSample != null && !bSample.isBad) {[m
[32m+[m[32m      final resistance = bSample.resistanceOhm;[m
[32m+[m[32m      if (resistance != null && resistance > 0) {[m
[32m+[m[32m        rhoB = calc.rhoAWenner(spacing.spacingFeet, resistance);[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (rhoA == null && rhoB == null) {[m
[32m+[m[32m      continue;[m
     }[m
     final values = <double>[if (rhoA != null) rhoA, if (rhoB != null) rhoB];[m
     if (values.isEmpty) {[m
[36m@@ -1168,7 +1177,8 @@[m [mclass LiteInversionService {[m
     }[m
 [m
     predicted = _forward(spacings, thicknesses, logRhos);[m
[31m-    final residuals = List<double>.generate(predicted.length, (i) => observations[i] - predicted[i]);[m
[32m+[m[32m    final residuals = List<double>.generate([m
[32m+[m[32m        predicted.length, (i) => observations[i] - predicted[i]);[m
     final rms = _rms(residuals);[m
     final chiSq = _chiSquare(residuals, usable);[m
     final oneSigma = _oneSigmaBand(predicted, residuals);[m
[36m@@ -1215,8 +1225,7 @@[m [mclass LiteInversionService {[m
           .map((entry) => entry.value)[m
           .where((value) => value.isFinite && value > 0)[m
           .toList();[m
[31m-      final trailingSamples = paired[m
[31m-          .reversed[m
[32m+[m[32m      final trailingSamples = paired.reversed[m
           .take(math.min(3, paired.length))[m
           .map((entry) => entry.value)[m
           .where((value) => value.isFinite && value > 0)[m
[36m@@ -1253,7 +1262,8 @@[m [mclass LiteInversionService {[m
     return _SeedResult(rhos: rhos, thicknesses: thicknesses);[m
   }[m
 [m
[31m-  List<double> _forward(List<double> spacings, List<double?> thicknesses, List<double> logRhos) {[m
[32m+[m[32m  List<double> _forward([m
[32m+[m[32m      List<double> spacings, List<double?> thicknesses, List<double> logRhos) {[m
     final rhos = logRhos.map(math.exp).toList();[m
     final outputs = <double>[];[m
     for (var spacing in spacings) {[m
[36m@@ -1284,7 +1294,8 @@[m [mclass LiteInversionService {[m
   ) {[m
     final eps = 1e-3;[m
     final base = _forward(spacings, thicknesses, logRhos);[m
[31m-    final jacobian = List.generate(spacings.length, (_) => List<double>.filled(logRhos.length, 0));[m
[32m+[m[32m    final jacobian = List.generate([m
[32m+[m[32m        spacings.length, (_) => List<double>.filled(logRhos.length, 0));[m
 [m
     for (var j = 0; j < logRhos.length; j++) {[m
       final perturbed = List<double>.from(logRhos);[m
[36m@@ -1304,7 +1315,8 @@[m [mclass LiteInversionService {[m
   ) {[m
     final rows = jacobian.length;[m
     final cols = jacobian.first.length;[m
[31m-    final jt = List.generate(cols, (i) => List<double>.generate(rows, (j) => jacobian[j][i]));[m
[32m+[m[32m    final jt = List.generate([m
[32m+[m[32m        cols, (i) => List<double>.generate(rows, (j) => jacobian[j][i]));[m
     final jtj = List.generate(cols, (_) => List<double>.filled(cols, 0.0));[m
 [m
     for (var i = 0; i < cols; i++) {[m
[36m@@ -1388,7 +1400,8 @@[m [mclass LiteInversionService {[m
     if (residuals.isEmpty) return 0;[m
     double chi = 0;[m
     for (var i = 0; i < residuals.length; i++) {[m
[31m-      final sigma = points[i].sigmaRhoOhmM ?? (0.05 * points[i].rhoAppOhmM.abs());[m
[32m+[m[32m      final sigma =[m
[32m+[m[32m          points[i].sigmaRhoOhmM ?? (0.05 * points[i].rhoAppOhmM.abs());[m
       final weight = sigma == 0 ? 1 : 1 / sigma;[m
       chi += math.pow(residuals[i] * weight, 2).toDouble();[m
     }[m
[36m@@ -1399,7 +1412,8 @@[m [mclass LiteInversionService {[m
     if (predicted.isEmpty) return [];[m
     final variance = residuals.isEmpty[m
         ? 0[m
[31m-        : residuals.map((r) => r * r).reduce((a, b) => a + b) / residuals.length;[m
[32m+[m[32m        : residuals.map((r) => r * r).reduce((a, b) => a + b) /[m
[32m+[m[32m            residuals.length;[m
     final sigma = math.sqrt(variance);[m
     return predicted.map((p) => p == 0 ? sigma : (sigma / p)).toList();[m
   }[m
[36m@@ -1479,7 +1493,8 @@[m [mclass LiteInversionService {[m
     return best;[m
   }[m
 [m
[31m-  List<double> _logSlopeBreaks(List<double> spacing, List<double> obs, int count) {[m
[32m+[m[32m  List<double> _logSlopeBreaks([m
[32m+[m[32m      List<double> spacing, List<double> obs, int count) {[m
     final logSpacing = spacing.map((e) => math.log(e)).toList();[m
     final logRho = obs.map((e) => math.log(e)).toList();[m
     final slopes = <double>[];[m
[36m@@ -1499,7 +1514,8 @@[m [mclass LiteInversionService {[m
         final idx = math.min(i, spacing.length - 1);[m
         breaks.add(spacing[idx]);[m
       } else {[m
[31m-        final slopeIndex = sortedIndices[math.min(i, sortedIndices.length - 1)] + 1;[m
[32m+[m[32m        final slopeIndex =[m
[32m+[m[32m            sortedIndices[math.min(i, sortedIndices.length - 1)] + 1;[m
         final idx = math.min(slopeIndex, spacing.length - 1);[m
         breaks.add(spacing[idx]);[m
       }[m
[36m@@ -1516,7 +1532,8 @@[m [mclass _SeedResult {[m
 }[m
 [m
 class _TwoLayerSeed {[m
[31m-  const _TwoLayerSeed({required this.rho1, required this.rho2, required this.h});[m
[32m+[m[32m  const _TwoLayerSeed([m
[32m+[m[32m      {required this.rho1, required this.rho2, required this.h});[m
 [m
   final double rho1;[m
   final double rho2;[m
[1mdiff --git a/lib/services/logging_service.dart b/lib/services/logging_service.dart[m
[1mindex 34f50be..9ee60c4 100644[m
[1m--- a/lib/services/logging_service.dart[m
[1m+++ b/lib/services/logging_service.dart[m
[36m@@ -33,7 +33,8 @@[m [mclass LoggingService {[m
     final timestamp = DateTime.now().toIso8601String().replaceAll(':', '-');[m
     final file = File('${directory.path}/session_$timestamp.log');[m
     _sink = file.openWrite(mode: FileMode.writeOnlyAppend);[m
[31m-    _sink?.writeln('--- ResiCheck session started ${DateTime.now().toIso8601String()} ---');[m
[32m+[m[32m    _sink?.writeln([m
[32m+[m[32m        '--- ResiCheck session started ${DateTime.now().toIso8601String()} ---');[m
 [m
     final previousDebugPrint = _previousDebugPrint;[m
     debugPrint = (String? message, {int? wrapWidth}) {[m
[36m@@ -47,7 +48,8 @@[m [mclass LoggingService {[m
     _previousFlutterError = FlutterError.onError;[m
     final previousFlutterError = _previousFlutterError;[m
     FlutterError.onError = (FlutterErrorDetails details) {[m
[31m-      final buffer = StringBuffer('FlutterError: ${details.exceptionAsString()}');[m
[32m+[m[32m      final buffer =[m
[32m+[m[32m          StringBuffer('FlutterError: ${details.exceptionAsString()}');[m
       if (details.stack != null) {[m
         buffer[m
           ..writeln()[m
[1mdiff --git a/lib/services/mock_stream.dart b/lib/services/mock_stream.dart[m
[1mindex 1a2c5c3..5e22b50 100644[m
[1m--- a/lib/services/mock_stream.dart[m
[1m+++ b/lib/services/mock_stream.dart[m
[36m@@ -59,7 +59,9 @@[m [mclass MockStreamService {[m
       if (rng.nextDouble() < 0.05) {[m
         contactR['p1'] = 6000 + rng.nextDouble() * 2000;[m
       }[m
[31m-      final spDrift = rng.nextDouble() < 0.1 ? (rng.nextDouble() * 12 - 6) : (rng.nextDouble() * 2 - 1);[m
[32m+[m[32m      final spDrift = rng.nextDouble() < 0.1[m
[32m+[m[32m          ? (rng.nextDouble() * 12 - 6)[m
[32m+[m[32m          : (rng.nextDouble() * 2 - 1);[m
       final sigma = rhoApp * (0.02 + rng.nextDouble() * 0.03);[m
       final repeats = List.generate([m
         3,[m
[1mdiff --git a/lib/services/persistence.dart b/lib/services/persistence.dart[m
[1mindex 57e0e12..867ca61 100644[m
[1m--- a/lib/services/persistence.dart[m
[1m+++ b/lib/services/persistence.dart[m
[36m@@ -45,7 +45,8 @@[m [mclass PersistenceService {[m
     await file.writeAsString(data);[m
   }[m
 [m
[31m-  Future<File> _resolveProjectFile(String name, {bool ensureDir = false}) async {[m
[32m+[m[32m  Future<File> _resolveProjectFile(String name,[m
[32m+[m[32m      {bool ensureDir = false}) async {[m
     final dir = await _directoryProvider();[m
     if (ensureDir && !await dir.exists()) {[m
       await dir.create(recursive: true);[m
[1mdiff --git a/lib/services/qc_rules.dart b/lib/services/qc_rules.dart[m
[1mindex 06cfa7c..e27fcfe 100644[m
[1m--- a/lib/services/qc_rules.dart[m
[1m+++ b/lib/services/qc_rules.dart[m
[36m@@ -34,12 +34,16 @@[m [mQaLevel classifyPoint({[m
   final maxContact = point.contactRMax ?? 0;[m
 [m
   final exceedsRedCv = cv >= (kQaYellowCvLimit - _kQaEpsilon);[m
[31m-  final exceedsRedResidual = absResidual >= (kQaYellowResidualLimit - _kQaEpsilon);[m
[32m+[m[32m  final exceedsRedResidual =[m
[32m+[m[32m      absResidual >= (kQaYellowResidualLimit - _kQaEpsilon);[m
   final exceedsYellowCv = cv >= (kQaGreenCvLimit - _kQaEpsilon);[m
   final exceedsYellowResidual =[m
       absResidual >= (kQaGreenResidualLimit - _kQaEpsilon);[m
 [m
[31m-  if (exceedsRedCv || exceedsRedResidual || spDrift >= kQaSpLimitMv || maxContact >= kQaContactLimitOhm) {[m
[32m+[m[32m  if (exceedsRedCv ||[m
[32m+[m[32m      exceedsRedResidual ||[m
[32m+[m[32m      spDrift >= kQaSpLimitMv ||[m
[32m+[m[32m      maxContact >= kQaContactLimitOhm) {[m
     return QaLevel.red;[m
   }[m
   if (point.hasRhoQaWarning) return QaLevel.yellow;[m
[36m@@ -98,7 +102,9 @@[m [mQaSummary summarizeQa([m
     final level = classifyPoint([m
       residual: residual,[m
       coefficientOfVariation:[m
[31m-          point.sigmaRhoOhmM == null || point.rhoAppOhmM == 0 ? null : (point.sigmaRhoOhmM! / point.rhoAppOhmM),[m
[32m+[m[32m          point.sigmaRhoOhmM == null || point.rhoAppOhmM == 0[m
[32m+[m[32m              ? null[m
[32m+[m[32m              : (point.sigmaRhoOhmM! / point.rhoAppOhmM),[m
       point: point,[m
     );[m
     qaCounts[level] = (qaCounts[level] ?? 0) + 1;[m
[1mdiff --git a/lib/services/storage_service.dart b/lib/services/storage_service.dart[m
[1mindex 760a746..5700acf 100644[m
[1m--- a/lib/services/storage_service.dart[m
[1m+++ b/lib/services/storage_service.dart[m
[36m@@ -18,7 +18,8 @@[m [mconst _sampleProjectFolderName = 'Sample_Project';[m
 const _sampleProjectAsset = 'assets/samples/sample_project.json';[m
 [m
 class ProjectStorageService {[m
[31m-  ProjectStorageService({Directory? overrideRoot}) : _overrideRoot = overrideRoot;[m
[32m+[m[32m  ProjectStorageService({Directory? overrideRoot})[m
[32m+[m[32m      : _overrideRoot = overrideRoot;[m
 [m
   final Directory? _overrideRoot;[m
   final _uuid = const Uuid();[m
[36m@@ -97,7 +98,8 @@[m [mclass ProjectStorageService {[m
     }[m
     final updated = project.copyWith(updatedAt: DateTime.now());[m
     final file = File(p.join(directory.path, _projectFileName));[m
[31m-    await file.writeAsString(JsonEncoder.withIndent('  ').convert(updated.toJson()));[m
[32m+[m[32m    await file[m
[32m+[m[32m        .writeAsString(JsonEncoder.withIndent('  ').convert(updated.toJson()));[m
     return updated;[m
   }[m
 [m
[36m@@ -150,7 +152,8 @@[m [mclass ProjectStorageService {[m
   ) async {[m
     final root = await _ensureRoot();[m
     final dir = Directory([m
[31m-      p.join(root.path, _safeFolderName(project.projectName), _exportsFolderName),[m
[32m+[m[32m      p.join([m
[32m+[m[32m          root.path, _safeFolderName(project.projectName), _exportsFolderName),[m
     );[m
     if (!await dir.exists()) {[m
       await dir.create(recursive: true);[m
[36m@@ -163,8 +166,8 @@[m [mclass ProjectStorageService {[m
   Future<Directory> ensureSiteDirectory([m
       ProjectRecord project, String siteId) async {[m
     final root = await _ensureRoot();[m
[31m-    final dir = Directory(p.join(root.path, _safeFolderName(project.projectName),[m
[31m-        _sitesFolderName, siteId));[m
[32m+[m[32m    final dir = Directory(p.join(root.path,[m
[32m+[m[32m        _safeFolderName(project.projectName), _sitesFolderName, siteId));[m
     if (!await dir.exists()) {[m
       await dir.create(recursive: true);[m
     }[m
[36m@@ -186,7 +189,9 @@[m [mclass ProjectStorageService {[m
   String _safeFolderName(String name) {[m
     final trimmed = name.trim();[m
     final sanitized = trimmed.replaceAll(RegExp(r'[^A-Za-z0-9-_]'), '_');[m
[31m-    return sanitized.isEmpty ? 'Project_${DateTime.now().millisecondsSinceEpoch}' : sanitized;[m
[32m+[m[32m    return sanitized.isEmpty[m
[32m+[m[32m        ? 'Project_${DateTime.now().millisecondsSinceEpoch}'[m
[32m+[m[32m        : sanitized;[m
   }[m
 }[m
 [m
[1mdiff --git a/lib/services/templates_service.dart b/lib/services/templates_service.dart[m
[1mindex c4e5f22..885111f 100644[m
[1m--- a/lib/services/templates_service.dart[m
[1m+++ b/lib/services/templates_service.dart[m
[36m@@ -74,7 +74,8 @@[m [mclass TemplatesService {[m
     final raw = await rootBundle.loadString(assetPath);[m
     final decoded = jsonDecode(raw) as List<dynamic>;[m
     _cache = decoded[m
[31m-        .map((dynamic item) => GhostTemplate.fromJson(item as Map<String, dynamic>))[m
[32m+[m[32m        .map((dynamic item) =>[m
[32m+[m[32m            GhostTemplate.fromJson(item as Map<String, dynamic>))[m
         .toList();[m
     return _cache!;[m
   }[m
[1mdiff --git a/lib/state/project_controller.dart b/lib/state/project_controller.dart[m
[1mindex 0fad3d6..08125bd 100644[m
[1m--- a/lib/state/project_controller.dart[m
[1m+++ b/lib/state/project_controller.dart[m
[36m@@ -24,10 +24,9 @@[m [mclass ProjectState {[m
   final bool hasUnsavedChanges;[m
   final bool autosaveEnabled;[m
 [m
[31m-  Site? get activeSite =>[m
[31m-      project != null && activeSiteId != null[m
[31m-          ? project!.siteById(activeSiteId!)[m
[31m-          : null;[m
[32m+[m[32m  Site? get activeSite => project != null && activeSiteId != null[m
[32m+[m[32m      ? project!.siteById(activeSiteId!)[m
[32m+[m[32m      : null;[m
 [m
   ProjectState copyWith({[m
     Object? project = _stateUnset,[m
[36m@@ -38,9 +37,8 @@[m [mclass ProjectState {[m
     bool? autosaveEnabled,[m
   }) {[m
     return ProjectState([m
[31m-      project: identical(project, _stateUnset)[m
[31m-          ? this.project[m
[31m-          : project as Project?,[m
[32m+[m[32m      project:[m
[32m+[m[32m          identical(project, _stateUnset) ? this.project : project as Project?,[m
       activeSiteId: identical(activeSiteId, _stateUnset)[m
           ? this.activeSiteId[m
           : activeSiteId as String?,[m
[36m@@ -53,8 +51,7 @@[m [mclass ProjectState {[m
 }[m
 [m
 class ProjectController extends StateNotifier<ProjectState> {[m
[31m-  ProjectController(this._persistence)[m
[31m-      : super(const ProjectState());[m
[32m+[m[32m  ProjectController(this._persistence) : super(const ProjectState());[m
 [m
   final PersistenceService _persistence;[m
   Timer? _autosaveTimer;[m
[36m@@ -93,9 +90,8 @@[m [mclass ProjectController extends StateNotifier<ProjectState> {[m
   Future<void> saveProject({String? asName, String? fileId}) async {[m
     final project = state.project;[m
     if (project == null) return;[m
[31m-    final projectToSave = asName != null[m
[31m-        ? project.copyWith(projectName: asName)[m
[31m-        : project;[m
[32m+[m[32m    final projectToSave =[m
[32m+[m[32m        asName != null ? project.copyWith(projectName: asName) : project;[m
     state = state.copyWith(isSaving: true);[m
     try {[m
       await _persistence.saveProject(projectToSave, fileId: fileId);[m
[36m@@ -123,16 +119,18 @@[m [mclass ProjectController extends StateNotifier<ProjectState> {[m
   }[m
 [m
   void updateReading(Direction direction, int spacingIndex, double? rho) {[m
[31m-    _modifyActiveSite(direction, spacingIndex, (point) => point.copyWith(rho: rho));[m
[32m+[m[32m    _modifyActiveSite([m
[32m+[m[32m        direction, spacingIndex, (point) => point.copyWith(rho: rho));[m
   }[m
 [m
   void markBad(Direction direction, int spacingIndex, {bool excluded = true}) {[m
[31m-    _modifyActiveSite(direction, spacingIndex,[m
[31m-        (point) => point.copyWith(excluded: excluded));[m
[32m+[m[32m    _modifyActiveSite([m
[32m+[m[32m        direction, spacingIndex, (point) => point.copyWith(excluded: excluded));[m
   }[m
 [m
   void setNote(Direction direction, int spacingIndex, String note) {[m
[31m-    _modifyActiveSite(direction, spacingIndex, (point) => point.copyWith(note: note));[m
[32m+[m[32m    _modifyActiveSite([m
[32m+[m[32m        direction, spacingIndex, (point) => point.copyWith(note: note));[m
   }[m
 [m
   void _modifyActiveSite([m
[36m@@ -160,18 +158,21 @@[m [mclass ProjectController extends StateNotifier<ProjectState> {[m
     final updatedPoints = List<SpacingPoint>.from(readings.points);[m
     updatedPoints[spacingIndex] = updater(updatedPoints[spacingIndex]);[m
 [m
[31m-    final updatedReadings = readings.copyWith(points: List.unmodifiable(updatedPoints));[m
[32m+[m[32m    final updatedReadings =[m
[32m+[m[32m        readings.copyWith(points: List.unmodifiable(updatedPoints));[m
     final updatedSite = site.updateReadings(direction, updatedReadings);[m
 [m
     final updatedSites = List<Site>.from(project.sites);[m
     updatedSites[siteIndex] = updatedSite;[m
 [m
[31m-    final updatedProject = project.copyWith(sites: List.unmodifiable(updatedSites));[m
[32m+[m[32m    final updatedProject =[m
[32m+[m[32m        project.copyWith(sites: List.unmodifiable(updatedSites));[m
     _setProject(updatedProject, markSaved: false);[m
   }[m
 [m
   void _setProject(Project project, {required bool markSaved}) {[m
[31m-    final firstSiteId = project.sites.isNotEmpty ? project.sites.first.siteId : null;[m
[32m+[m[32m    final firstSiteId =[m
[32m+[m[32m        project.sites.isNotEmpty ? project.sites.first.siteId : null;[m
     final currentActive = state.activeSiteId;[m
     final resolvedActive =[m
         currentActive != null && project.siteById(currentActive) != null[m
[1mdiff --git a/lib/state/providers.dart b/lib/state/providers.dart[m
[1mindex ef0bbe5..87bf471 100644[m
[1m--- a/lib/state/providers.dart[m
[1m+++ b/lib/state/providers.dart[m
[36m@@ -6,7 +6,8 @@[m [mimport '../services/inversion.dart';[m
 import '../services/mock_stream.dart';[m
 import '../services/qc_rules.dart';[m
 [m
[31m-final mockStreamProvider = Provider<MockStreamService>((ref) => MockStreamService());[m
[32m+[m[32mfinal mockStreamProvider =[m
[32m+[m[32m    Provider<MockStreamService>((ref) => MockStreamService());[m
 [m
 class SpacingPointsNotifier extends StateNotifier<List<SpacingPoint>> {[m
   SpacingPointsNotifier() : super(const []);[m
[36m@@ -37,9 +38,11 @@[m [mclass SpacingPointsNotifier extends StateNotifier<List<SpacingPoint>> {[m
 }[m
 [m
 final spacingPointsProvider =[m
[31m-    StateNotifierProvider<SpacingPointsNotifier, List<SpacingPoint>>((ref) => SpacingPointsNotifier());[m
[32m+[m[32m    StateNotifierProvider<SpacingPointsNotifier, List<SpacingPoint>>([m
[32m+[m[32m        (ref) => SpacingPointsNotifier());[m
 [m
[31m-final inversionServiceProvider = Provider<LiteInversionService>((ref) => LiteInversionService());[m
[32m+[m[32mfinal inversionServiceProvider =[m
[32m+[m[32m    Provider<LiteInversionService>((ref) => LiteInversionService());[m
 [m
 final inversionProvider = Provider<InversionModel>((ref) {[m
   final points = ref.watch(spacingPointsProvider);[m
[36m@@ -64,8 +67,11 @@[m [mfinal qaSummaryProvider = Provider<QaSummary>((ref) {[m
   }[m
   final residuals = <double>[];[m
   for (var i = 0; i < points.length; i++) {[m
[31m-    final fit = i < inversion.predictedRho.length ? inversion.predictedRho[i] : inversion.predictedRho.last;[m
[31m-    residuals.add(points[i].rhoAppOhmM == 0 ? 0 : (points[i].rhoAppOhmM - fit) / fit);[m
[32m+[m[32m    final fit = i < inversion.predictedRho.length[m
[32m+[m[32m        ? inversion.predictedRho[i][m
[32m+[m[32m        : inversion.predictedRho.last;[m
[32m+[m[32m    residuals.add([m
[32m+[m[32m        points[i].rhoAppOhmM == 0 ? 0 : (points[i].rhoAppOhmM - fit) / fit);[m
   }[m
   return summarizeQa(points, residuals, inversion.predictedRho);[m
 });[m
[36m@@ -92,35 +98,40 @@[m [mclass TelemetryNotifier extends StateNotifier<TelemetryState> {[m
   TelemetryNotifier()[m
       : super(TelemetryState(current: [], voltage: [], spDrift: []));[m
 [m
[31m-  void addSample({required double current, required double voltage, double? spDrift}) {[m
[32m+[m[32m  void addSample([m
[32m+[m[32m      {required double current, required double voltage, double? spDrift}) {[m
     final now = DateTime.now();[m
     final cutoff = now.subtract(const Duration(seconds: 30));[m
 [m
[31m-    List<TelemetrySample> updateList(List<TelemetrySample> samples, double value) {[m
[32m+[m[32m    List<TelemetrySample> updateList([m
[32m+[m[32m        List<TelemetrySample> samples, double value) {[m
       final updated = [...samples, TelemetrySample(now, value)][m
         ..removeWhere((sample) => sample.timestamp.isBefore(cutoff));[m
       return updated;[m
     }[m
 [m
     List<TelemetrySample> trimOnly(List<TelemetrySample> samples) {[m
[31m-      return [...samples]..removeWhere((sample) => sample.timestamp.isBefore(cutoff));[m
[32m+[m[32m      return [...samples][m
[32m+[m[32m        ..removeWhere((sample) => sample.timestamp.isBefore(cutoff));[m
     }[m
 [m
     state = TelemetryState([m
       current: updateList(state.current, current),[m
       voltage: updateList(state.voltage, voltage),[m
[31m-      spDrift: spDrift != null ? updateList(state.spDrift, spDrift) : trimOnly(state.spDrift),[m
[32m+[m[32m      spDrift: spDrift != null[m
[32m+[m[32m          ? updateList(state.spDrift, spDrift)[m
[32m+[m[32m          : trimOnly(state.spDrift),[m
     );[m
   }[m
 }[m
 [m
[31m-final telemetryProvider = StateNotifierProvider<TelemetryNotifier, TelemetryState>((ref) {[m
[32m+[m[32mfinal telemetryProvider =[m
[32m+[m[32m    StateNotifierProvider<TelemetryNotifier, TelemetryState>((ref) {[m
   return TelemetryNotifier();[m
 });[m
 [m
 class SimulationController extends StateNotifier<bool> {[m
[31m-  SimulationController(this.ref)[m
[31m-      : super(false);[m
[32m+[m[32m  SimulationController(this.ref) : super(false);[m
 [m
   final Ref ref;[m
 [m
[36m@@ -155,7 +166,8 @@[m [mclass SimulationController extends StateNotifier<bool> {[m
   }[m
 }[m
 [m
[31m-final simulationControllerProvider = StateNotifierProvider<SimulationController, bool>((ref) {[m
[32m+[m[32mfinal simulationControllerProvider =[m
[32m+[m[32m    StateNotifierProvider<SimulationController, bool>((ref) {[m
   final controller = SimulationController(ref);[m
   ref.onDispose(() => controller.stop());[m
   return controller;[m
[1mdiff --git a/lib/ui/import/import_sheet.dart b/lib/ui/import/import_sheet.dart[m
[1mindex 70622ab..0fe8e53 100644[m
[1m--- a/lib/ui/import/import_sheet.dart[m
[1m+++ b/lib/ui/import/import_sheet.dart[m
[36m@@ -65,7 +65,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
         : 'Site-${widget.project.sites.length + 1}';[m
     _siteIdController = TextEditingController(text: defaultSiteId);[m
     _displayNameController = TextEditingController(text: defaultSiteId);[m
[31m-    _selectedMergeSiteId = widget.initialSiteId ?? widget.project.sites.firstOrNull?.siteId;[m
[32m+[m[32m    _selectedMergeSiteId =[m
[32m+[m[32m        widget.initialSiteId ?? widget.project.sites.firstOrNull?.siteId;[m
     unawaited(_restoreUnitPreference());[m
   }[m
 [m
[36m@@ -85,7 +86,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
 [m
     return SafeArea([m
       child: Padding([m
[31m-        padding: EdgeInsets.only(bottom: MediaQuery.of(context).viewInsets.bottom),[m
[32m+[m[32m        padding:[m
[32m+[m[32m            EdgeInsets.only(bottom: MediaQuery.of(context).viewInsets.bottom),[m
         child: SizedBox([m
           height: MediaQuery.of(context).size.height * 0.9,[m
           child: Scaffold([m
[36m@@ -101,7 +103,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
             body: Column([m
               children: [[m
                 Padding([m
[31m-                  padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),[m
[32m+[m[32m                  padding:[m
[32m+[m[32m                      const EdgeInsets.symmetric(horizontal: 16, vertical: 12),[m
                   child: Row([m
                     children: [[m
                       FilledButton.icon([m
[36m@@ -110,7 +113,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                             ? const SizedBox([m
                                 width: 16,[m
                                 height: 16,[m
[31m-                                child: CircularProgressIndicator(strokeWidth: 2),[m
[32m+[m[32m                                child:[m
[32m+[m[32m                                    CircularProgressIndicator(strokeWidth: 2),[m
                               )[m
                             : const Icon(Icons.upload_file),[m
                         label: const Text('Choose file'),[m
[36m@@ -257,7 +261,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                       return ColumnMapRow([m
                         descriptor: column,[m
                         selected: selected,[m
[31m-                        onChanged: (target) => _updateAssignment(column.index, target),[m
[32m+[m[32m                        onChanged: (target) =>[m
[32m+[m[32m                            _updateAssignment(column.index, target),[m
                       );[m
                     },[m
                   ),[m
[36m@@ -281,7 +286,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                 ),[m
                 if (preview.issues.isNotEmpty) ...[[m
                   const SizedBox(height: 12),[m
[31m-                  Text('Detected file issues', style: Theme.of(context).textTheme.titleSmall),[m
[32m+[m[32m                  Text('Detected file issues',[m
[32m+[m[32m                      style: Theme.of(context).textTheme.titleSmall),[m
                   const SizedBox(height: 4),[m
                   SizedBox([m
                     height: 80,[m
[36m@@ -290,7 +296,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                         for (final issue in preview.issues)[m
                           ListTile([m
                             dense: true,[m
[31m-                            leading: const Icon(Icons.warning_amber_outlined, size: 20),[m
[32m+[m[32m                            leading: const Icon(Icons.warning_amber_outlined,[m
[32m+[m[32m                                size: 20),[m
                             title: Text('Row ${issue.index}: ${issue.message}'),[m
                           ),[m
                       ],[m
[36m@@ -355,10 +362,12 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
     );[m
   }[m
 [m
[31m-  Widget _buildFooter(BuildContext context, ImportValidationResult? validation) {[m
[32m+[m[32m  Widget _buildFooter([m
[32m+[m[32m      BuildContext context, ImportValidationResult? validation) {[m
     final theme = Theme.of(context);[m
     final canValidate = _session != null && _mapping != null && !_validating;[m
[31m-    final canImport = validation != null && validation.importedRows > 0 && !_validating;[m
[32m+[m[32m    final canImport =[m
[32m+[m[32m        validation != null && validation.importedRows > 0 && !_validating;[m
 [m
     return Container([m
       padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),[m
[36m@@ -384,13 +393,15 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                     for (final issue in validation.issues.take(6))[m
                       ListTile([m
                         dense: true,[m
[31m-                        leading: Icon(Icons.info_outline, color: theme.colorScheme.tertiary),[m
[32m+[m[32m                        leading: Icon(Icons.info_outline,[m
[32m+[m[32m                            color: theme.colorScheme.tertiary),[m
                         title: Text('Row ${issue.rowIndex}: ${issue.message}'),[m
                       ),[m
                     if (validation.issues.length > 6)[m
                       Padding([m
                         padding: const EdgeInsets.only(left: 40, top: 4),[m
[31m-                        child: Text('… and ${validation.issues.length - 6} more'),[m
[32m+[m[32m                        child:[m
[32m+[m[32m                            Text('… and ${validation.issues.length - 6} more'),[m
                       ),[m
                   ],[m
                 ),[m
[36m@@ -474,12 +485,15 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
                       child: Text(site.displayName),[m
                     ),[m
                 ],[m
[31m-                onChanged: (value) => setState(() => _selectedMergeSiteId = value),[m
[32m+[m[32m                onChanged: (value) =>[m
[32m+[m[32m                    setState(() => _selectedMergeSiteId = value),[m
               ),[m
               CheckboxListTile([m
                 value: _overwrite,[m
[31m-                onChanged: (value) => setState(() => _overwrite = value ?? false),[m
[31m-                title: const Text('Overwrite existing readings for matching spacings'),[m
[32m+[m[32m                onChanged: (value) =>[m
[32m+[m[32m                    setState(() => _overwrite = value ?? false),[m
[32m+[m[32m                title: const Text([m
[32m+[m[32m                    'Overwrite existing readings for matching spacings'),[m
                 controlAffinity: ListTileControlAffinity.leading,[m
               ),[m
             ],[m
[36m@@ -641,7 +655,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
     );[m
   }[m
 [m
[31m-  Widget? _buildUnitInferenceBanner(ImportPreview preview, ImportMapping mapping) {[m
[32m+[m[32m  Widget? _buildUnitInferenceBanner([m
[32m+[m[32m      ImportPreview preview, ImportMapping mapping) {[m
     final detection = preview.unitDetection;[m
     if (!detection.hasGuess || detection.ambiguous) {[m
       return null;[m
[36m@@ -766,7 +781,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
         return;[m
       }[m
       final auto = _service.autoMap(session.preview);[m
[31m-      final resolvedUnit = _resolveInitialUnit(session.preview.unitDetection, auto.distanceUnit);[m
[32m+[m[32m      final resolvedUnit =[m
[32m+[m[32m          _resolveInitialUnit(session.preview.unitDetection, auto.distanceUnit);[m
       setState(() {[m
         _session = session;[m
         _mapping = ImportMapping([m
[36m@@ -796,7 +812,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
       updated[columnIndex] = target;[m
     }[m
     setState(() {[m
[31m-      _mapping = ImportMapping(assignments: updated, distanceUnit: mapping.distanceUnit);[m
[32m+[m[32m      _mapping = ImportMapping([m
[32m+[m[32m          assignments: updated, distanceUnit: mapping.distanceUnit);[m
       _validation = null;[m
     });[m
   }[m
[36m@@ -853,7 +870,8 @@[m [mclass _ImportSheetState extends State<ImportSheet> {[m
         powerMilliAmps: widget.project.defaultPowerMilliAmps,[m
         stacks: widget.project.defaultStacks,[m
         soil: widget.project.sites.firstOrNull?.soil ?? SoilType.unknown,[m
[31m-        moisture: widget.project.sites.firstOrNull?.moisture ?? MoistureLevel.normal,[m
[32m+[m[32m        moisture:[m
[32m+[m[32m            widget.project.sites.firstOrNull?.moisture ?? MoistureLevel.normal,[m
       );[m
       Navigator.of(context).pop(ImportSheetOutcome.newSite(site));[m
       return;[m
[1mdiff --git a/lib/ui/import/widgets/column_map_row.dart b/lib/ui/import/widgets/column_map_row.dart[m
[1mindex 316110f..7d804fe 100644[m
[1m--- a/lib/ui/import/widgets/column_map_row.dart[m
[1m+++ b/lib/ui/import/widgets/column_map_row.dart[m
[36m@@ -32,7 +32,8 @@[m [mclass ColumnMapRow extends StatelessWidget {[m
               message: descriptor.header,[m
               child: Text([m
                 descriptor.header,[m
[31m-                style: theme.textTheme.bodyMedium?.copyWith(fontWeight: FontWeight.w600),[m
[32m+[m[32m                style: theme.textTheme.bodyMedium[m
[32m+[m[32m                    ?.copyWith(fontWeight: FontWeight.w600),[m
                 overflow: TextOverflow.ellipsis,[m
                 maxLines: 1,[m
               ),[m
[1mdiff --git a/lib/ui/project_workflow/depth_cue_summary.dart b/lib/ui/project_workflow/depth_cue_summary.dart[m
[1mnew file mode 100644[m
[1mindex 0000000..8c3964a[m
[1m--- /dev/null[m
[1m+++ b/lib/ui/project_workflow/depth_cue_summary.dart[m
[36m@@ -0,0 +1,270 @@[m
[32m+[m[32mimport 'dart:math' as math;[m
[32m+[m[32mimport 'dart:ui';[m
[32m+[m
[32m+[m[32mimport 'package:flutter/material.dart';[m
[32m+[m
[32m+[m[32mimport '../../models/calc.dart';[m
[32m+[m[32mimport '../../models/site.dart';[m
[32m+[m[32mimport '../../utils/distance_unit.dart';[m
[32m+[m[32mimport '../../utils/format.dart';[m
[32m+[m[32mimport '../../utils/units.dart' as units;[m
[32m+[m
[32m+[m[32mclass DepthCueSummaryData {[m
[32m+[m[32m  DepthCueSummaryData({[m
[32m+[m[32m    required this.message,[m
[32m+[m[32m    required this.steps,[m
[32m+[m[32m    required this.hasCue,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final String message;[m
[32m+[m[32m  final List<DepthCueStep> steps;[m
[32m+[m[32m  final bool hasCue;[m
[32m+[m
[32m+[m[32m  static DepthCueSummaryData fromSite([m
[32m+[m[32m    SiteRecord site,[m
[32m+[m[32m    DistanceUnit distanceUnit,[m
[32m+[m[32m  ) {[m
[32m+[m[32m    final steps = _buildSteps(site);[m
[32m+[m[32m    if (steps.isEmpty) {[m
[32m+[m[32m      return DepthCueSummaryData([m
[32m+[m[32m        message:[m
[32m+[m[32m            'Depth cue will appear once valid resistivity values are recorded.',[m
[32m+[m[32m        steps: const [],[m
[32m+[m[32m        hasCue: false,[m
[32m+[m[32m      );[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    final trend = _describeTrend(steps);[m
[32m+[m[32m    final deepest = steps.last;[m
[32m+[m[32m    final depthLabel = formatCompactValue([m
[32m+[m[32m      distanceUnit.fromMeters(deepest.depthMeters),[m
[32m+[m[32m    );[m
[32m+[m[32m    final unitLabel = distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m    final metersTooltip = formatMetersTooltip(deepest.depthMeters);[m
[32m+[m[32m    final rhoLabel = formatCompactValue(deepest.rho);[m
[32m+[m
[32m+[m[32m    return DepthCueSummaryData([m
[32m+[m[32m      message:[m
[32m+[m[32m          'Depth cue: $trend toward $depthLabel $unitLabel (~$metersTooltip m, ≈$rhoLabel Ω·m).',[m
[32m+[m[32m      steps: List.unmodifiable(steps),[m
[32m+[m[32m      hasCue: true,[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  static List<DepthCueStep> _buildSteps(SiteRecord site) {[m
[32m+[m[32m    final steps = <DepthCueStep>[];[m
[32m+[m[32m    double? fallbackSpacingFeet;[m
[32m+[m
[32m+[m[32m    for (final spacing in site.spacings) {[m
[32m+[m[32m      fallbackSpacingFeet ??= spacing.spacingFeet;[m
[32m+[m[32m      final aSample = spacing.orientationA.latest;[m
[32m+[m[32m      final bSample = spacing.orientationB.latest;[m
[32m+[m
[32m+[m[32m      final resistances = <double>[[m
[32m+[m[32m        if (aSample != null && !aSample.isBad && aSample.resistanceOhm != null)[m
[32m+[m[32m          aSample.resistanceOhm!,[m
[32m+[m[32m        if (bSample != null && !bSample.isBad && bSample.resistanceOhm != null)[m
[32m+[m[32m          bSample.resistanceOhm!,[m
[32m+[m[32m      ];[m
[32m+[m
[32m+[m[32m      if (resistances.isEmpty) {[m
[32m+[m[32m        continue;[m
[32m+[m[32m      }[m
[32m+[m
[32m+[m[32m      final avgResistance =[m
[32m+[m[32m          resistances.reduce((value, element) => value + element) /[m
[32m+[m[32m              resistances.length;[m
[32m+[m[32m      final rho = rhoAWenner(spacing.spacingFeet, avgResistance);[m
[32m+[m[32m      final depthFeet = 0.5 * spacing.spacingFeet;[m
[32m+[m[32m      steps.add([m
[32m+[m[32m        DepthCueStep([m
[32m+[m[32m          depthMeters: units.feetToMeters(depthFeet).toDouble(),[m
[32m+[m[32m          rho: rho,[m
[32m+[m[32m        ),[m
[32m+[m[32m      );[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (steps.isEmpty && fallbackSpacingFeet != null) {[m
[32m+[m[32m      final fallbackDepth =[m
[32m+[m[32m          units.feetToMeters(fallbackSpacingFeet * 0.5).toDouble();[m
[32m+[m[32m      steps.add([m
[32m+[m[32m        DepthCueStep([m
[32m+[m[32m          depthMeters: fallbackDepth,[m
[32m+[m[32m          rho: 1.0,[m
[32m+[m[32m        ),[m
[32m+[m[32m      );[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    steps.sort((a, b) => a.depthMeters.compareTo(b.depthMeters));[m
[32m+[m[32m    return steps;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  static String _describeTrend(List<DepthCueStep> steps) {[m
[32m+[m[32m    if (steps.length < 2) {[m
[32m+[m[32m      return 'Resistivity stable';[m
[32m+[m[32m    }[m
[32m+[m[32m    final delta = steps.last.rho - steps.first.rho;[m
[32m+[m[32m    if (delta.abs() < 0.5) {[m
[32m+[m[32m      return 'Resistivity stable';[m
[32m+[m[32m    }[m
[32m+[m[32m    return delta > 0 ? 'Resistivity increasing' : 'Resistivity decreasing';[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mclass DepthCueStep {[m
[32m+[m[32m  const DepthCueStep({[m
[32m+[m[32m    required this.depthMeters,[m
[32m+[m[32m    required this.rho,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final double depthMeters;[m
[32m+[m[32m  final double rho;[m
[32m+[m
[32m+[m[32m  double depthInUnit(DistanceUnit unit) => unit.fromMeters(depthMeters);[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mclass DepthCueTable extends StatelessWidget {[m
[32m+[m[32m  const DepthCueTable({[m
[32m+[m[32m    super.key,[m
[32m+[m[32m    required this.summary,[m
[32m+[m[32m    required this.distanceUnit,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final DepthCueSummaryData summary;[m
[32m+[m[32m  final DistanceUnit distanceUnit;[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  Widget build(BuildContext context) {[m
[32m+[m[32m    if (summary.steps.isEmpty) {[m
[32m+[m[32m      return const SizedBox.shrink();[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    const maxVisibleRows = 4;[m
[32m+[m[32m    final steps = summary.steps;[m
[32m+[m[32m    final visibleSteps = steps.take(maxVisibleRows).toList();[m
[32m+[m[32m    final hiddenCount = math.max(0, steps.length - visibleSteps.length);[m
[32m+[m[32m    final theme = Theme.of(context);[m
[32m+[m[32m    final unitLabel = distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m    final headerStyle =[m
[32m+[m[32m        theme.textTheme.labelSmall?.copyWith(fontWeight: FontWeight.w600);[m
[32m+[m[32m    final valueStyle = theme.textTheme.bodySmall?.copyWith([m
[32m+[m[32m      fontFeatures: const [FontFeature.tabularFigures()],[m
[32m+[m[32m    );[m
[32m+[m
[32m+[m[32m    return Column([m
[32m+[m[32m      crossAxisAlignment: CrossAxisAlignment.stretch,[m
[32m+[m[32m      children: [[m
[32m+[m[32m        Text([m
[32m+[m[32m          '${steps.length} spacing${steps.length == 1 ? '' : 's'} informing cue',[m
[32m+[m[32m          style: theme.textTheme.bodySmall,[m
[32m+[m[32m        ),[m
[32m+[m[32m        const SizedBox(height: 12),[m
[32m+[m[32m        ConstrainedBox([m
[32m+[m[32m          constraints: const BoxConstraints(maxHeight: 160),[m
[32m+[m[32m          child: Scrollbar([m
[32m+[m[32m            thumbVisibility: steps.length > maxVisibleRows,[m
[32m+[m[32m            child: SingleChildScrollView([m
[32m+[m[32m              child: Column([m
[32m+[m[32m                mainAxisSize: MainAxisSize.min,[m
[32m+[m[32m                crossAxisAlignment: CrossAxisAlignment.stretch,[m
[32m+[m[32m                children: [[m
[32m+[m[32m                  _HeaderRow(unitLabel: unitLabel, style: headerStyle),[m
[32m+[m[32m                  const Divider(height: 12),[m
[32m+[m[32m                  Column([m
[32m+[m[32m                    mainAxisSize: MainAxisSize.min,[m
[32m+[m[32m                    children: [[m
[32m+[m[32m                      for (final step in visibleSteps)[m
[32m+[m[32m                        _DataRow([m
[32m+[m[32m                          depthLabel: formatCompactValue([m
[32m+[m[32m                            distanceUnit.fromMeters(step.depthMeters),[m
[32m+[m[32m                          ),[m
[32m+[m[32m                          rhoLabel: formatCompactValue(step.rho),[m
[32m+[m[32m                          style: valueStyle,[m
[32m+[m[32m                        ),[m
[32m+[m[32m                      if (hiddenCount > 0)[m
[32m+[m[32m                        Padding([m
[32m+[m[32m                          padding: const EdgeInsets.only(top: 8),[m
[32m+[m[32m                          child: Text([m
[32m+[m[32m                            '+$hiddenCount more spacing${hiddenCount == 1 ? '' : 's'}',[m
[32m+[m[32m                            style: theme.textTheme.labelSmall?.copyWith([m
[32m+[m[32m                              color: theme.colorScheme.outline,[m
[32m+[m[32m                            ),[m
[32m+[m[32m                          ),[m
[32m+[m[32m                        ),[m
[32m+[m[32m                    ],[m
[32m+[m[32m                  ),[m
[32m+[m[32m                ],[m
[32m+[m[32m              ),[m
[32m+[m[32m            ),[m
[32m+[m[32m          ),[m
[32m+[m[32m        ),[m
[32m+[m[32m      ],[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mclass _HeaderRow extends StatelessWidget {[m
[32m+[m[32m  const _HeaderRow({[m
[32m+[m[32m    required this.unitLabel,[m
[32m+[m[32m    this.style,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final String unitLabel;[m
[32m+[m[32m  final TextStyle? style;[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  Widget build(BuildContext context) {[m
[32m+[m[32m    return SizedBox([m
[32m+[m[32m      height: 32,[m
[32m+[m[32m      child: Row([m
[32m+[m[32m        children: [[m
[32m+[m[32m          Expanded([m
[32m+[m[32m            child: Center([m
[32m+[m[32m              child: Text('Depth ($unitLabel)', style: style),[m
[32m+[m[32m            ),[m
[32m+[m[32m          ),[m
[32m+[m[32m          const SizedBox(width: 12),[m
[32m+[m[32m          Expanded([m
[32m+[m[32m            child: Center([m
[32m+[m[32m              child: Text('ρa (Ω·m)', style: style),[m
[32m+[m[32m            ),[m
[32m+[m[32m          ),[m
[32m+[m[32m        ],[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mclass _DataRow extends StatelessWidget {[m
[32m+[m[32m  const _DataRow({[m
[32m+[m[32m    required this.depthLabel,[m
[32m+[m[32m    required this.rhoLabel,[m
[32m+[m[32m    this.style,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final String depthLabel;[m
[32m+[m[32m  final String rhoLabel;[m
[32m+[m[32m  final TextStyle? style;[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  Widget build(BuildContext context) {[m
[32m+[m[32m    return SizedBox([m
[32m+[m[32m      height: 32,[m
[32m+[m[32m      child: Row([m
[32m+[m[32m        children: [[m
[32m+[m[32m          Expanded([m
[32m+[m[32m            child: Center([m
[32m+[m[32m              child: Text(depthLabel, style: style),[m
[32m+[m[32m            ),[m
[32m+[m[32m          ),[m
[32m+[m[32m          const SizedBox(width: 12),[m
[32m+[m[32m          Expanded([m
[32m+[m[32m            child: Center([m
[32m+[m[32m              child: Text(rhoLabel, style: style),[m
[32m+[m[32m            ),[m
[32m+[m[32m          ),[m
[32m+[m[32m        ],[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[1mdiff --git a/lib/ui/project_workflow/depth_profile_tab.dart b/lib/ui/project_workflow/depth_profile_tab.dart[m
[1mindex d83299f..699317e 100644[m
[1m--- a/lib/ui/project_workflow/depth_profile_tab.dart[m
[1m+++ b/lib/ui/project_workflow/depth_profile_tab.dart[m
[36m@@ -38,7 +38,8 @@[m [mclass _DepthProfileTabState extends State<DepthProfileTab> {[m
 [m
     final deepest = steps.last;[m
     final depthValue = widget.distanceUnit.fromMeters(deepest.depthMeters);[m
[31m-    final depthUnitLabel = widget.distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m    final depthUnitLabel =[m
[32m+[m[32m        widget.distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
     final trend = _trendDescription(steps);[m
     final message =[m
         'Depth cue: $trend toward ${formatCompactValue(depthValue)} $depthUnitLabel (~${formatMetersTooltip(deepest.depthMeters)} m, ≈${formatCompactValue(deepest.rho)} Ω·m).';[m
[36m@@ -106,7 +107,8 @@[m [mclass _DepthProfileTabState extends State<DepthProfileTab> {[m
       );[m
     }[m
     if (steps.isEmpty && fallbackSpacingFt != null) {[m
[31m-      final fallbackDepth = units.feetToMeters(fallbackSpacingFt * 0.5).toDouble();[m
[32m+[m[32m      final fallbackDepth =[m
[32m+[m[32m          units.feetToMeters(fallbackSpacingFt * 0.5).toDouble();[m
       steps.add(_DepthStep(depthMeters: fallbackDepth, rho: 1.0));[m
     }[m
     steps.sort((a, b) => a.depthMeters.compareTo(b.depthMeters));[m
[36m@@ -216,7 +218,6 @@[m [mclass _DepthProfileTabState extends State<DepthProfileTab> {[m
     }[m
     return delta > 0 ? 'Resistivity increasing' : 'Resistivity decreasing';[m
   }[m
[31m-[m
 }[m
 [m
 class _DepthStep {[m
[1mdiff --git a/lib/ui/project_workflow/home_page.dart b/lib/ui/project_workflow/home_page.dart[m
[1mindex c83cd91..c453ca9 100644[m
[1m--- a/lib/ui/project_workflow/home_page.dart[m
[1m+++ b/lib/ui/project_workflow/home_page.dart[m
[36m@@ -13,7 +13,8 @@[m [mclass ProjectWorkflowHomePage extends StatefulWidget {[m
   const ProjectWorkflowHomePage({super.key});[m
 [m
   @override[m
[31m-  State<ProjectWorkflowHomePage> createState() => _ProjectWorkflowHomePageState();[m
[32m+[m[32m  State<ProjectWorkflowHomePage> createState() =>[m
[32m+[m[32m      _ProjectWorkflowHomePageState();[m
 }[m
 [m
 class _ProjectWorkflowHomePageState extends State<ProjectWorkflowHomePage> {[m
[36m@@ -110,8 +111,8 @@[m [mclass _ProjectWorkflowHomePageState extends State<ProjectWorkflowHomePage> {[m
   Widget build(BuildContext context) {[m
     return CallbackShortcuts([m
       bindings: {[m
[31m-        const SingleActivator(LogicalKeyboardKey.keyI, control: true):[m
[31m-            () => unawaited(_startImport()),[m
[32m+[m[32m        const SingleActivator(LogicalKeyboardKey.keyI, control: true): () =>[m
[32m+[m[32m            unawaited(_startImport()),[m
       },[m
       child: Focus([m
         autofocus: true,[m
[36m@@ -207,7 +208,8 @@[m [mclass _ProjectWorkflowHomePageState extends State<ProjectWorkflowHomePage> {[m
     if (!mounted) return;[m
     if (record == null) {[m
       ScaffoldMessenger.of(context).showSnackBar([m
[31m-        SnackBar(content: Text('Failed to open project ${summary.projectName}')),[m
[32m+[m[32m        SnackBar([m
[32m+[m[32m            content: Text('Failed to open project ${summary.projectName}')),[m
       );[m
       return;[m
     }[m
[1mdiff --git a/lib/ui/project_workflow/inversion_summary_panel.dart b/lib/ui/project_workflow/inversion_summary_panel.dart[m
[1mindex f5f47d4..d55faa6 100644[m
[1m--- a/lib/ui/project_workflow/inversion_summary_panel.dart[m
[1m+++ b/lib/ui/project_workflow/inversion_summary_panel.dart[m
[36m@@ -2,8 +2,8 @@[m [mimport 'dart:ui';[m
 [m
 import 'package:flutter/material.dart';[m
 [m
[31m-import '../../models/calc.dart';[m
 import '../../models/site.dart';[m
[32m+[m[32mimport '../../services/inversion.dart';[m
 import '../../utils/distance_unit.dart';[m
 import 'depth_cue_summary.dart';[m
 import 'plots_panel.dart';[m
[36m@@ -63,11 +63,6 @@[m [mclass InversionSummaryPanel extends StatelessWidget {[m
                   isLoading: isLoading,[m
                   distanceUnit: distanceUnit,[m
                   siteLabel: null,[m
[31m-                  useCard: false,[m
[31m-                  padding: EdgeInsets.zero,[m
[31m-                  showHeader: false,[m
[31m-                  showSummaryChips: false,[m
[31m-                  showRmsBadge: false,[m
                 ),[m
               ),[m
             ),[m
[1mdiff --git a/lib/ui/project_workflow/plots_panel.dart b/lib/ui/project_workflow/plots_panel.dart[m
[1mindex f0d7ebd..2459a49 100644[m
[1m--- a/lib/ui/project_workflow/plots_panel.dart[m
[1m+++ b/lib/ui/project_workflow/plots_panel.dart[m
[36m@@ -115,8 +115,8 @@[m [mclass PlotsPanel extends StatelessWidget {[m
         lineTouchData: LineTouchData([m
           touchTooltipData: LineTouchTooltipData([m
             tooltipBgColor: theme.colorScheme.surface.withValues([m
[31m-                  alpha: (0.9 * 255).round().toDouble(),[m
[31m-                ),[m
[32m+[m[32m              alpha: (0.9 * 255).round().toDouble(),[m
[32m+[m[32m            ),[m
             getTooltipItems: (touchedSpots) {[m
               return touchedSpots.map((spot) {[m
                 final spacing = math.pow(10, spot.x);[m
[36m@@ -163,10 +163,13 @@[m [mclass PlotsPanel extends StatelessWidget {[m
               child: Text('ρa (Ω·m)'),[m
             ),[m
           ),[m
[31m-          rightTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[31m-          topTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m          rightTitles:[m
[32m+[m[32m              const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m          topTitles:[m
[32m+[m[32m              const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
         ),[m
[31m-        gridData: FlGridData(show: true, drawVerticalLine: true, drawHorizontalLine: true),[m
[32m+[m[32m        gridData: FlGridData([m
[32m+[m[32m            show: true, drawVerticalLine: true, drawHorizontalLine: true),[m
         borderData: FlBorderData(show: true),[m
         lineBarsData: [[m
           if (data.aSeries.isNotEmpty)[m
[36m@@ -370,7 +373,11 @@[m [mSeriesData buildSeriesForSite(SiteRecord site, {required bool showOutliers}) {[m
 }[m
 [m
 class _AxisRanges {[m
[31m-  _AxisRanges({required this.minX, required this.maxX, required this.minY, required this.maxY});[m
[32m+[m[32m  _AxisRanges([m
[32m+[m[32m      {required this.minX,[m
[32m+[m[32m      required this.maxX,[m
[32m+[m[32m      required this.minY,[m
[32m+[m[32m      required this.maxY});[m
 [m
   final double minX;[m
   final double maxX;[m
[36m@@ -402,7 +409,8 @@[m [mclass _LegendEntry extends StatelessWidget {[m
           width: 18,[m
           height: 10,[m
           child: CustomPaint([m
[31m-            painter: _LegendLinePainter(color: color, dashed: dashed, marker: marker),[m
[32m+[m[32m            painter: _LegendLinePainter([m
[32m+[m[32m                color: color, dashed: dashed, marker: marker),[m
           ),[m
         ),[m
         const SizedBox(width: 6),[m
[36m@@ -708,8 +716,10 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
             border: Border.all(color: theme.colorScheme.outlineVariant),[m
           ),[m
           titlesData: FlTitlesData([m
[31m-            topTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[31m-            rightTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m            topTitles:[m
[32m+[m[32m                const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m            rightTitles:[m
[32m+[m[32m                const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
             bottomTitles: AxisTitles([m
               axisNameWidget: const Padding([m
                 padding: EdgeInsets.only(top: 8.0),[m
[36m@@ -776,11 +786,13 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
                   top: 12,[m
                   right: 12,[m
                   child: Container([m
[31m-                    padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),[m
[32m+[m[32m                    padding:[m
[32m+[m[32m                        const EdgeInsets.symmetric(horizontal: 12, vertical: 6),[m
                     decoration: BoxDecoration([m
                       color: theme.colorScheme.surface.withValues(alpha: 0.9),[m
                       borderRadius: BorderRadius.circular(12),[m
[31m-                      border: Border.all(color: theme.colorScheme.outlineVariant),[m
[32m+[m[32m                      border:[m
[32m+[m[32m                          Border.all(color: theme.colorScheme.outlineVariant),[m
                     ),[m
                     child: Text([m
                       'RMS ${(summary.rms * 100).toStringAsFixed(1)}%',[m
[36m@@ -820,7 +832,8 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
                   ),[m
                 _SummaryChip([m
                   label: 'Solved',[m
[31m-                  value: '${summary.solvedAt.hour.toString().padLeft(2, '0')}:${summary.solvedAt.minute.toString().padLeft(2, '0')}',[m
[32m+[m[32m                  value:[m
[32m+[m[32m                      '${summary.solvedAt.hour.toString().padLeft(2, '0')}:${summary.solvedAt.minute.toString().padLeft(2, '0')}',[m
                   color: theme.colorScheme.secondary,[m
                 ),[m
               ],[m
[36m@@ -835,7 +848,8 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
     if (ticks.isEmpty) {[m
       return value;[m
     }[m
[31m-    return ticks.reduce((a, b) => (a - value).abs() < (b - value).abs() ? a : b);[m
[32m+[m[32m    return ticks[m
[32m+[m[32m        .reduce((a, b) => (a - value).abs() < (b - value).abs() ? a : b);[m
   }[m
 [m
   static List<double> _buildDepthTicks(double maxDepth) {[m
[36m@@ -853,12 +867,15 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
     return [for (var i = start; i <= end; i++) i];[m
   }[m
 [m
[31m-  static List<FlSpot> _buildProfile(TwoLayerInversionResult summary, double depthMeters) {[m
[32m+[m[32m  static List<FlSpot> _buildProfile([m
[32m+[m[32m      TwoLayerInversionResult summary, double depthMeters) {[m
     final spots = <FlSpot>[];[m
     final topLog = _log10(summary.rho1);[m
     spots.add(FlSpot(topLog, 0));[m
     final firstBoundary = summary.thicknessM ??[m
[31m-        (summary.layerDepths.isNotEmpty ? summary.layerDepths.first : summary.maxDepthMeters / 2);[m
[32m+[m[32m        (summary.layerDepths.isNotEmpty[m
[32m+[m[32m            ? summary.layerDepths.first[m
[32m+[m[32m            : summary.maxDepthMeters / 2);[m
     final cappedBoundary = math.min(firstBoundary, depthMeters);[m
     spots.add(FlSpot(topLog, -cappedBoundary));[m
     final secondLog = _log10(summary.rho2);[m
[36m@@ -879,11 +896,13 @@[m [mclass InversionPlotPanel extends StatelessWidget {[m
     return '${rho.toStringAsFixed(2)} Ω·m';[m
   }[m
 [m
[31m-  static String _unitLabel(DistanceUnit unit) => unit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m  static String _unitLabel(DistanceUnit unit) =>[m
[32m+[m[32m      unit == DistanceUnit.feet ? 'ft' : 'm';[m
 }[m
 [m
 class _SummaryChip extends StatelessWidget {[m
[31m-  const _SummaryChip({required this.label, required this.value, required this.color});[m
[32m+[m[32m  const _SummaryChip([m
[32m+[m[32m      {required this.label, required this.value, required this.color});[m
 [m
   final String label;[m
   final String value;[m
[36m@@ -903,7 +922,10 @@[m [mclass _SummaryChip extends StatelessWidget {[m
         text: TextSpan([m
           style: theme.textTheme.labelMedium,[m
           children: [[m
[31m-            TextSpan(text: '$label ', style: theme.textTheme.labelMedium?.copyWith(color: color, fontWeight: FontWeight.w600)),[m
[32m+[m[32m            TextSpan([m
[32m+[m[32m                text: '$label ',[m
[32m+[m[32m                style: theme.textTheme.labelMedium[m
[32m+[m[32m                    ?.copyWith(color: color, fontWeight: FontWeight.w600)),[m
             TextSpan(text: value, style: theme.textTheme.labelMedium),[m
           ],[m
         ),[m
[1mdiff --git a/lib/ui/project_workflow/project_shell.dart b/lib/ui/project_workflow/project_shell.dart[m
[1mindex 9e99df4..8d2c75d 100644[m
[1m--- a/lib/ui/project_workflow/project_shell.dart[m
[1m+++ b/lib/ui/project_workflow/project_shell.dart[m
[36m@@ -37,19 +37,6 @@[m [mclass ProjectShell extends StatefulWidget {[m
   State<ProjectShell> createState() => _ProjectShellState();[m
 }[m
 [m
[31m-void _fireAndForget(Future<void> future) {[m
[31m-  try {[m
[31m-    // ignore: discarded_futures[m
[31m-    unawaited(future);[m
[31m-  } catch (_) {[m
[31m-    future.ignore();[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-extension _FutureIgnore on Future<void> {[m
[31m-  void ignore() {}[m
[31m-}[m
[31m-[m
 class _ProjectShellState extends State<ProjectShell> {[m
   late ProjectRecord _project;[m
   SiteRecord? _selectedSite;[m
[36m@@ -117,7 +104,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
     }[m
     setState(() {[m
       _project = saved;[m
[31m-      _selectedSite = saved.siteById(_selectedSite?.siteId ?? '') ?? saved.sites.firstOrNull;[m
[32m+[m[32m      _selectedSite = saved.siteById(_selectedSite?.siteId ?? '') ??[m
[32m+[m[32m          saved.sites.firstOrNull;[m
       _saveIndicator = 'Saved ${DateFormat('HH:mm:ss').format(DateTime.now())}';[m
     });[m
   }[m
[36m@@ -149,11 +137,13 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
     _historyIndex = _history.length - 1;[m
   }[m
 [m
[31m-  void _applyProjectUpdate(ProjectRecord Function(ProjectRecord current) updater) {[m
[32m+[m[32m  void _applyProjectUpdate([m
[32m+[m[32m      ProjectRecord Function(ProjectRecord current) updater) {[m
     final updated = updater(_project);[m
     setState(() {[m
       _project = updated;[m
[31m-      _selectedSite = updated.siteById(_selectedSite?.siteId ?? '') ?? updated.sites.firstOrNull;[m
[32m+[m[32m      _selectedSite = updated.siteById(_selectedSite?.siteId ?? '') ??[m
[32m+[m[32m          updated.sites.firstOrNull;[m
       _pushHistory(updated);[m
     });[m
     _scheduleAutosave();[m
[36m@@ -186,8 +176,9 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
             isBad: false,[m
           );[m
           final updatedHistory = history.addSample(sample);[m
[31m-          final updatedRecord =[m
[31m-              record.updateHistory(orientation, updatedHistory).applyAutoInterpretation();[m
[32m+[m[32m          final updatedRecord = record[m
[32m+[m[32m              .updateHistory(orientation, updatedHistory)[m
[32m+[m[32m              .applyAutoInterpretation();[m
           return updatedRecord;[m
         });[m
       });[m
[36m@@ -451,7 +442,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
   Future<void> _deleteSite(SiteRecord site) async {[m
     if (_project.sites.length <= 1) {[m
       ScaffoldMessenger.of(context).showSnackBar([m
[31m-        const SnackBar(content: Text('Projects must contain at least one site.')),[m
[32m+[m[32m        const SnackBar([m
[32m+[m[32m            content: Text('Projects must contain at least one site.')),[m
       );[m
       return;[m
     }[m
[36m@@ -460,7 +452,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
       builder: (context) {[m
         return AlertDialog([m
           title: const Text('Delete site'),[m
[31m-          content: Text('Delete ${site.displayName}? This action cannot be undone.'),[m
[32m+[m[32m          content:[m
[32m+[m[32m              Text('Delete ${site.displayName}? This action cannot be undone.'),[m
           actions: [[m
             TextButton([m
               onPressed: () => Navigator.of(context).pop(false),[m
[36m@@ -550,7 +543,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
       final inversion = summary ?? _inversionResult;[m
       if (inversion == null) {[m
         ScaffoldMessenger.of(context).showSnackBar([m
[31m-          const SnackBar(content: Text('Need at least two valid spacings to export PDF.')),[m
[32m+[m[32m          const SnackBar([m
[32m+[m[32m              content: Text('Need at least two valid spacings to export PDF.')),[m
         );[m
         return;[m
       }[m
[36m@@ -598,16 +592,21 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
       if (entries.isEmpty) {[m
         if (!mounted) return;[m
         ScaffoldMessenger.of(context).showSnackBar([m
[31m-          const SnackBar(content: Text('No sites have enough data to export a PDF report.')),[m
[32m+[m[32m          const SnackBar([m
[32m+[m[32m              content:[m
[32m+[m[32m                  Text('No sites have enough data to export a PDF report.')),[m
         );[m
         return;[m
       }[m
[31m-      final file = await _exportService.exportBatchInversionPdf(_project, entries);[m
[32m+[m[32m      final file =[m
[32m+[m[32m          await _exportService.exportBatchInversionPdf(_project, entries);[m
       if (!mounted) {[m
         return;[m
       }[m
       final skipped = sites.length - entries.length;[m
[31m-      final suffix = skipped > 0 ? ' (skipped $skipped site${skipped == 1 ? '' : 's'})' : '';[m
[32m+[m[32m      final suffix = skipped > 0[m
[32m+[m[32m          ? ' (skipped $skipped site${skipped == 1 ? '' : 's'})'[m
[32m+[m[32m          : '';[m
       ScaffoldMessenger.of(context).showSnackBar([m
         SnackBar(content: Text('Saved batch PDF to ${file.path}$suffix')),[m
       );[m
[36m@@ -656,8 +655,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
     setState(() {[m
       _historyIndex--;[m
       _project = _history[_historyIndex];[m
[31m-      _selectedSite =[m
[31m-          _project.siteById(_selectedSite?.siteId ?? '') ?? _project.sites.firstOrNull;[m
[32m+[m[32m      _selectedSite = _project.siteById(_selectedSite?.siteId ?? '') ??[m
[32m+[m[32m          _project.sites.firstOrNull;[m
     });[m
   }[m
 [m
[36m@@ -668,8 +667,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
     setState(() {[m
       _historyIndex++;[m
       _project = _history[_historyIndex];[m
[31m-      _selectedSite =[m
[31m-          _project.siteById(_selectedSite?.siteId ?? '') ?? _project.sites.firstOrNull;[m
[32m+[m[32m      _selectedSite = _project.siteById(_selectedSite?.siteId ?? '') ??[m
[32m+[m[32m          _project.sites.firstOrNull;[m
     });[m
   }[m
 [m
[36m@@ -793,7 +792,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                 ),[m
               ),[m
             IconButton([m
[31m-              icon: Icon(_showOutliers ? Icons.visibility : Icons.visibility_off),[m
[32m+[m[32m              icon:[m
[32m+[m[32m                  Icon(_showOutliers ? Icons.visibility : Icons.visibility_off),[m
               tooltip: _showOutliers ? 'Hide outliers' : 'Show outliers',[m
               onPressed: _toggleOutliers,[m
             ),[m
[36m@@ -885,7 +885,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                   Container([m
                     width: double.infinity,[m
                     color: Theme.of(context).colorScheme.surfaceContainerHigh,[m
[31m-                    padding: const EdgeInsets.symmetric(horizontal: 16, vertical: 8),[m
[32m+[m[32m                    padding:[m
[32m+[m[32m                        const EdgeInsets.symmetric(horizontal: 16, vertical: 8),[m
                     child: Row([m
                       children: [[m
                         Text(_saveIndicator),[m
[36m@@ -943,7 +944,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                                     const SizedBox(height: 12),[m
                                     Expanded([m
                                       flex: 5,[m
[31m-                                      child: _buildInversionSummaryCard(context, site),[m
[32m+[m[32m                                      child: _buildInversionSummaryCard([m
[32m+[m[32m                                          context, site),[m
                                     ),[m
                                   ],[m
                                 ),[m
[36m@@ -983,7 +985,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                                     const SizedBox(height: 12),[m
                                     Expanded([m
                                       flex: 5,[m
[31m-                                      child: _buildInversionSummaryCard(context, site),[m
[32m+[m[32m                                      child: _buildInversionSummaryCard([m
[32m+[m[32m                                          context, site),[m
                                     ),[m
                                   ],[m
                                 ),[m
[36m@@ -1000,7 +1003,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                                     const SizedBox(height: 12),[m
                                     Expanded([m
                                       flex: 2,[m
[31m-                                      child: _buildRightDetailCard(context, site),[m
[32m+[m[32m                                      child:[m
[32m+[m[32m                                          _buildRightDetailCard(context, site),[m
                                     ),[m
                                   ],[m
                                 ),[m
[36m@@ -1009,7 +1013,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
                           );[m
                         }[m
                         return SingleChildScrollView([m
[31m-                          padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 12),[m
[32m+[m[32m                          padding: const EdgeInsets.symmetric([m
[32m+[m[32m                              horizontal: 12, vertical: 12),[m
                           child: Column([m
                             crossAxisAlignment: CrossAxisAlignment.stretch,[m
                             children: [[m
[36m@@ -1146,6 +1151,7 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
         onSdChanged: _handleSdChanged,[m
         onInterpretationChanged: _handleInterpretationChanged,[m
         onToggleBad: _handleBadToggle,[m
[32m+[m[32m        onMetadataChanged: _handleMetadataChanged,[m
         onShowHistory: _showHistory,[m
         onFocusChanged: _recordFocus,[m
       ),[m
[36m@@ -1172,10 +1178,8 @@[m [mclass _ProjectShellState extends State<ProjectShell> {[m
     for (final spacing in site.spacings) {[m
       final a = spacing.orientationA.latest;[m
       final b = spacing.orientationB.latest;[m
[31m-      final hasValidA =[m
[31m-          a != null && !a.isBad && a.resistanceOhm != null;[m
[31m-      final hasValidB =[m
[31m-          b != null && !b.isBad && b.resistanceOhm != null;[m
[32m+[m[32m      final hasValidA = a != null && !a.isBad && a.resistanceOhm != null;[m
[32m+[m[32m      final hasValidB = b != null && !b.isBad && b.resistanceOhm != null;[m
       if (hasValidA || hasValidB) {[m
         valid++;[m
       }[m
[36m@@ -1297,4 +1301,3 @@[m [mclass SiteListPanel extends StatelessWidget {[m
     );[m
   }[m
 }[m
[31m-[m
[1mdiff --git a/lib/ui/project_workflow/right_detail_panel.dart b/lib/ui/project_workflow/right_detail_panel.dart[m
[1mnew file mode 100644[m
[1mindex 0000000..5641d4e[m
[1m--- /dev/null[m
[1m+++ b/lib/ui/project_workflow/right_detail_panel.dart[m
[36m@@ -0,0 +1,214 @@[m
[32m+[m[32mimport 'package:flutter/material.dart';[m
[32m+[m
[32m+[m[32mimport '../../models/site.dart';[m
[32m+[m
[32m+[m[32mclass RightDetailPanel extends StatefulWidget {[m
[32m+[m[32m  const RightDetailPanel({[m
[32m+[m[32m    super.key,[m
[32m+[m[32m    required this.site,[m
[32m+[m[32m    required this.projectDefaultStacks,[m
[32m+[m[32m    required this.onMetadataChanged,[m
[32m+[m[32m  });[m
[32m+[m
[32m+[m[32m  final SiteRecord site;[m
[32m+[m[32m  final int projectDefaultStacks;[m
[32m+[m[32m  final void Function({[m
[32m+[m[32m    double? power,[m
[32m+[m[32m    int? stacks,[m
[32m+[m[32m    SoilType? soil,[m
[32m+[m[32m    MoistureLevel? moisture,[m
[32m+[m[32m  }) onMetadataChanged;[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  State<RightDetailPanel> createState() => _RightDetailPanelState();[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mclass _RightDetailPanelState extends State<RightDetailPanel> {[m
[32m+[m[32m  late TextEditingController _powerController;[m
[32m+[m[32m  late int _stacks;[m
[32m+[m[32m  late SoilType _soil;[m
[32m+[m[32m  late MoistureLevel _moisture;[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  void initState() {[m
[32m+[m[32m    super.initState();[m
[32m+[m[32m    _powerController = TextEditingController([m
[32m+[m[32m      text: widget.site.powerMilliAmps.toStringAsFixed(1),[m
[32m+[m[32m    );[m
[32m+[m[32m    _stacks = widget.site.stacks;[m
[32m+[m[32m    _soil = widget.site.soil;[m
[32m+[m[32m    _moisture = widget.site.moisture;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  void didUpdateWidget(RightDetailPanel oldWidget) {[m
[32m+[m[32m    super.didUpdateWidget(oldWidget);[m
[32m+[m[32m    if (oldWidget.site != widget.site) {[m
[32m+[m[32m      _powerController.text = widget.site.powerMilliAmps.toStringAsFixed(1);[m
[32m+[m[32m      _stacks = widget.site.stacks;[m
[32m+[m[32m      _soil = widget.site.soil;[m
[32m+[m[32m      _moisture = widget.site.moisture;[m
[32m+[m[32m    }[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  void dispose() {[m
[32m+[m[32m    _powerController.dispose();[m
[32m+[m[32m    super.dispose();[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  @override[m
[32m+[m[32m  Widget build(BuildContext context) {[m
[32m+[m[32m    final theme = Theme.of(context);[m
[32m+[m
[32m+[m[32m    return Card([m
[32m+[m[32m      clipBehavior: Clip.antiAlias,[m
[32m+[m[32m      color: theme.colorScheme.surfaceContainerHighest,[m
[32m+[m[32m      child: Padding([m
[32m+[m[32m        padding: const EdgeInsets.all(20),[m
[32m+[m[32m        child: Column([m
[32m+[m[32m          crossAxisAlignment: CrossAxisAlignment.stretch,[m
[32m+[m[32m          mainAxisSize: MainAxisSize.min,[m
[32m+[m[32m          children: [[m
[32m+[m[32m            Text([m
[32m+[m[32m              'Site details',[m
[32m+[m[32m              style: theme.textTheme.titleMedium?.copyWith([m
[32m+[m[32m                fontWeight: FontWeight.w600,[m
[32m+[m[32m              ),[m
[32m+[m[32m            ),[m
[32m+[m[32m            const SizedBox(height: 12),[m
[32m+[m[32m            Text([m
[32m+[m[32m              'Site ID: ${widget.site.siteId}',[m
[32m+[m[32m              style: theme.textTheme.bodySmall?.copyWith([m
[32m+[m[32m                color: theme.colorScheme.outline,[m
[32m+[m[32m              ),[m
[32m+[m[32m            ),[m
[32m+[m[32m            const SizedBox(height: 16),[m
[32m+[m[32m            _buildPowerField(theme),[m
[32m+[m[32m            const SizedBox(height: 16),[m
[32m+[m[32m            _buildStacksField(theme),[m
[32m+[m[32m            const SizedBox(height: 16),[m
[32m+[m[32m            _buildSoilField(theme),[m
[32m+[m[32m            const SizedBox(height: 16),[m
[32m+[m[32m            _buildMoistureField(theme),[m
[32m+[m[32m          ],[m
[32m+[m[32m        ),[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  Widget _buildPowerField(ThemeData theme) {[m
[32m+[m[32m    return TextField([m
[32m+[m[32m      controller: _powerController,[m
[32m+[m[32m      decoration: InputDecoration([m
[32m+[m[32m        labelText: 'Transmitter power (mA)',[m
[32m+[m[32m        helperText: 'Typical: 0.5–2.0 mA',[m
[32m+[m[32m        suffixText: 'mA',[m
[32m+[m[32m        border: const OutlineInputBorder(),[m
[32m+[m[32m      ),[m
[32m+[m[32m      keyboardType:[m
[32m+[m[32m          const TextInputType.numberWithOptions(decimal: true, signed: false),[m
[32m+[m[32m      onSubmitted: _handlePowerSubmitted,[m
[32m+[m[32m      onEditingComplete: () => _handlePowerSubmitted(_powerController.text),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  Widget _buildStacksField(ThemeData theme) {[m
[32m+[m[32m    final options = List<int>.generate(18, (index) => index + 1);[m
[32m+[m[32m    return InputDecorator([m
[32m+[m[32m      decoration: InputDecoration([m
[32m+[m[32m        labelText: 'Stack count',[m
[32m+[m[32m        border: const OutlineInputBorder(),[m
[32m+[m[32m        helperText: 'Project default: ${widget.projectDefaultStacks}',[m
[32m+[m[32m      ),[m
[32m+[m[32m      child: DropdownButtonHideUnderline([m
[32m+[m[32m        child: DropdownButton<int>([m
[32m+[m[32m          value: _stacks.clamp(1, options.last),[m
[32m+[m[32m          isExpanded: true,[m
[32m+[m[32m          onChanged: (value) {[m
[32m+[m[32m            if (value == null) return;[m
[32m+[m[32m            setState(() {[m
[32m+[m[32m              _stacks = value;[m
[32m+[m[32m            });[m
[32m+[m[32m            widget.onMetadataChanged(stacks: value);[m
[32m+[m[32m          },[m
[32m+[m[32m          items: [[m
[32m+[m[32m            for (final value in options)[m
[32m+[m[32m              DropdownMenuItem<int>([m
[32m+[m[32m                value: value,[m
[32m+[m[32m                child: Text('$value stacks'),[m
[32m+[m[32m              ),[m
[32m+[m[32m          ],[m
[32m+[m[32m        ),[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  Widget _buildSoilField(ThemeData theme) {[m
[32m+[m[32m    return InputDecorator([m
[32m+[m[32m      decoration: const InputDecoration([m
[32m+[m[32m        labelText: 'Soil type',[m
[32m+[m[32m        border: OutlineInputBorder(),[m
[32m+[m[32m      ),[m
[32m+[m[32m      child: DropdownButtonHideUnderline([m
[32m+[m[32m        child: DropdownButton<SoilType>([m
[32m+[m[32m          value: _soil,[m
[32m+[m[32m          isExpanded: true,[m
[32m+[m[32m          onChanged: (value) {[m
[32m+[m[32m            if (value == null) return;[m
[32m+[m[32m            setState(() {[m
[32m+[m[32m              _soil = value;[m
[32m+[m[32m            });[m
[32m+[m[32m            widget.onMetadataChanged(soil: value);[m
[32m+[m[32m          },[m
[32m+[m[32m          items: [[m
[32m+[m[32m            for (final value in SoilType.values)[m
[32m+[m[32m              DropdownMenuItem<SoilType>([m
[32m+[m[32m                value: value,[m
[32m+[m[32m                child: Text(value.label),[m
[32m+[m[32m              ),[m
[32m+[m[32m          ],[m
[32m+[m[32m        ),[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  Widget _buildMoistureField(ThemeData theme) {[m
[32m+[m[32m    return InputDecorator([m
[32m+[m[32m      decoration: const InputDecoration([m
[32m+[m[32m        labelText: 'Moisture level',[m
[32m+[m[32m        border: OutlineInputBorder(),[m
[32m+[m[32m      ),[m
[32m+[m[32m      child: DropdownButtonHideUnderline([m
[32m+[m[32m        child: DropdownButton<MoistureLevel>([m
[32m+[m[32m          value: _moisture,[m
[32m+[m[32m          isExpanded: true,[m
[32m+[m[32m          onChanged: (value) {[m
[32m+[m[32m            if (value == null) return;[m
[32m+[m[32m            setState(() {[m
[32m+[m[32m              _moisture = value;[m
[32m+[m[32m            });[m
[32m+[m[32m            widget.onMetadataChanged(moisture: value);[m
[32m+[m[32m          },[m
[32m+[m[32m          items: [[m
[32m+[m[32m            for (final value in MoistureLevel.values)[m
[32m+[m[32m              DropdownMenuItem<MoistureLevel>([m
[32m+[m[32m                value: value,[m
[32m+[m[32m                child: Text(value.label),[m
[32m+[m[32m              ),[m
[32m+[m[32m          ],[m
[32m+[m[32m        ),[m
[32m+[m[32m      ),[m
[32m+[m[32m    );[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  void _handlePowerSubmitted(String value) {[m
[32m+[m[32m    final parsed = double.tryParse(value);[m
[32m+[m[32m    if (parsed == null || parsed.isNaN || parsed.isNegative) {[m
[32m+[m[32m      _powerController.text = widget.site.powerMilliAmps.toStringAsFixed(1);[m
[32m+[m[32m      return;[m
[32m+[m[32m    }[m
[32m+[m[32m    _powerController.text = parsed.toStringAsFixed(1);[m
[32m+[m[32m    widget.onMetadataChanged(power: parsed);[m
[32m+[m[32m  }[m
[32m+[m[32m}[m
[1mdiff --git a/lib/ui/project_workflow/shortcuts.dart b/lib/ui/project_workflow/shortcuts.dart[m
[1mindex 379c505..cdd397c 100644[m
[1m--- a/lib/ui/project_workflow/shortcuts.dart[m
[1m+++ b/lib/ui/project_workflow/shortcuts.dart[m
[36m@@ -46,8 +46,8 @@[m [mclass ProjectWorkflowShortcuts extends StatelessWidget {[m
             const _ImportIntent(),[m
         LogicalKeySet(LogicalKeyboardKey.control, LogicalKeyboardKey.keyZ):[m
             const _UndoIntent(),[m
[31m-        LogicalKeySet(LogicalKeyboardKey.control, LogicalKeyboardKey.shift, LogicalKeyboardKey.keyZ):[m
[31m-            const _RedoIntent(),[m
[32m+[m[32m        LogicalKeySet(LogicalKeyboardKey.control, LogicalKeyboardKey.shift,[m
[32m+[m[32m            LogicalKeyboardKey.keyZ): const _RedoIntent(),[m
       },[m
       child: Actions([m
         actions: <Type, Action<Intent>>{[m
[36m@@ -55,15 +55,18 @@[m [mclass ProjectWorkflowShortcuts extends StatelessWidget {[m
             onMarkBad();[m
             return null;[m
           }),[m
[31m-          _ToggleOutliersIntent: CallbackAction<_ToggleOutliersIntent>(onInvoke: (_) {[m
[32m+[m[32m          _ToggleOutliersIntent:[m
[32m+[m[32m              CallbackAction<_ToggleOutliersIntent>(onInvoke: (_) {[m
             onToggleOutliers();[m
             return null;[m
           }),[m
[31m-          _ToggleAllSitesIntent: CallbackAction<_ToggleAllSitesIntent>(onInvoke: (_) {[m
[32m+[m[32m          _ToggleAllSitesIntent:[m
[32m+[m[32m              CallbackAction<_ToggleAllSitesIntent>(onInvoke: (_) {[m
             onToggleAllSites();[m
             return null;[m
           }),[m
[31m-          _ToggleLockAxesIntent: CallbackAction<_ToggleLockAxesIntent>(onInvoke: (_) {[m
[32m+[m[32m          _ToggleLockAxesIntent:[m
[32m+[m[32m              CallbackAction<_ToggleLockAxesIntent>(onInvoke: (_) {[m
             onToggleLockAxes();[m
             return null;[m
           }),[m
[1mdiff --git a/lib/ui/project_workflow/table_panel.dart b/lib/ui/project_workflow/table_panel.dart[m
[1mindex 719ca43..3a9cba7 100644[m
[1m--- a/lib/ui/project_workflow/table_panel.dart[m
[1m+++ b/lib/ui/project_workflow/table_panel.dart[m
[36m@@ -89,7 +89,8 @@[m [mclass TablePanel extends StatefulWidget {[m
     double spacingFt,[m
     OrientationKind orientation,[m
   ) onShowHistory;[m
[31m-  final void Function(double spacingFt, OrientationKind orientation) onFocusChanged;[m
[32m+[m[32m  final void Function(double spacingFt, OrientationKind orientation)[m
[32m+[m[32m      onFocusChanged;[m
 [m
   @visibleForTesting[m
   static const String sdPromptPattern = r'^[0-9]{0,2}(\.[0-9])?$';[m
[36m@@ -153,8 +154,8 @@[m [mclass _RowConfig {[m
   final bool hideB;[m
   final bool sdWarningA;[m
   final bool sdWarningB;[m
[31m-   final double? sdValueA;[m
[31m-   final double? sdValueB;[m
[32m+[m[32m  final double? sdValueA;[m
[32m+[m[32m  final double? sdValueB;[m
   final double insideFeet;[m
   final double insideMeters;[m
   final double outsideFeet;[m
[36m@@ -237,6 +238,7 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
     _tableController.dispose();[m
     super.dispose();[m
   }[m
[32m+[m
   @override[m
   Widget build(BuildContext context) {[m
     final spacings = [...widget.site.spacings][m
[36m@@ -288,10 +290,10 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
 [m
       final hideA = !widget.showOutliers && (aSample?.isBad ?? false);[m
       final hideB = !widget.showOutliers && (bSample?.isBad ?? false);[m
[31m-      final sdWarningA =[m
[31m-          (aSample?.standardDeviationPercent ?? 0) > qcConfig.sdThresholdPercent;[m
[31m-      final sdWarningB =[m
[31m-          (bSample?.standardDeviationPercent ?? 0) > qcConfig.sdThresholdPercent;[m
[32m+[m[32m      final sdWarningA = (aSample?.standardDeviationPercent ?? 0) >[m
[32m+[m[32m          qcConfig.sdThresholdPercent;[m
[32m+[m[32m      final sdWarningB = (bSample?.standardDeviationPercent ?? 0) >[m
[32m+[m[32m          qcConfig.sdThresholdPercent;[m
 [m
       rowConfigs.add([m
         _RowConfig([m
[36m@@ -359,6 +361,7 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
       ],[m
     );[m
   }[m
[32m+[m
   Widget _buildTable([m
     BuildContext context,[m
     ThemeData theme,[m
[36m@@ -371,9 +374,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
         final maxHeight = constraints.hasBoundedHeight[m
             ? math.min(constraints.maxHeight, 460.0)[m
             : 460.0;[m
[31m-        final minWidth = constraints.hasBoundedWidth[m
[31m-            ? constraints.maxWidth[m
[31m-            : 520.0;[m
[32m+[m[32m        final minWidth =[m
[32m+[m[32m            constraints.hasBoundedWidth ? constraints.maxWidth : 520.0;[m
         final headingStyle = theme.textTheme.labelSmall?.copyWith([m
           fontWeight: FontWeight.w600,[m
           fontSize: 12,[m
[36m@@ -433,7 +435,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
                               DataColumn(label: SizedBox.shrink()),[m
                             ],[m
                             rows: rows[m
[31m-                                .map((row) => _buildDataRow(context, theme, row))[m
[32m+[m[32m                                .map([m
[32m+[m[32m                                    (row) => _buildDataRow(context, theme, row))[m
                                 .toList(),[m
                           ),[m
                         ],[m
[36m@@ -597,11 +600,12 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
   Widget _buildSpacingCell(ThemeData theme, _RowConfig row) {[m
     final spacingText = formatCompactValue(row.record.spacingFeet);[m
     final customNote = row.record.interpretation?.trim();[m
[32m+[m[32m    final customNoteText = customNote ?? '';[m
     final autoNote = row.record.computeAutoInterpretation();[m
     final hasCustom = customNote != null && customNote.isNotEmpty;[m
     final consistencyLabel = _consistencyLabel(autoNote);[m
     final tooltip = hasCustom[m
[31m-        ? customNote![m
[32m+[m[32m        ? customNoteText[m
         : consistencyLabel != null[m
             ? 'Consistency compares N–S vs W–E using SD-weighted difference. Lower is better (default threshold ${const QcConfig().sdThresholdPercent.toStringAsFixed(0)}%).'[m
             : 'Tap to record interpretation notes';[m
[36m@@ -631,10 +635,11 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
                 onTap: () => _editInterpretation(row),[m
                 behavior: HitTestBehavior.opaque,[m
                 child: Padding([m
[31m-                  padding: const EdgeInsets.symmetric(vertical: 2, horizontal: 4),[m
[32m+[m[32m                  padding:[m
[32m+[m[32m                      const EdgeInsets.symmetric(vertical: 2, horizontal: 4),[m
                   child: hasCustom[m
                       ? Text([m
[31m-                          customNote!,[m
[32m+[m[32m                          customNoteText,[m
                           maxLines: 2,[m
                           overflow: TextOverflow.ellipsis,[m
                           textAlign: TextAlign.center,[m
[36m@@ -765,7 +770,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
 [m
     final isBad = sample?.isBad ?? false;[m
     final rank = _tabRanks[key] ?? 0;[m
[31m-    final sdValue = orientation == OrientationKind.a ? row.sdValueA : row.sdValueB;[m
[32m+[m[32m    final sdValue =[m
[32m+[m[32m        orientation == OrientationKind.a ? row.sdValueA : row.sdValueB;[m
     final sdWarning =[m
         orientation == OrientationKind.a ? row.sdWarningA : row.sdWarningB;[m
     final sdText = hide[m
[36m@@ -775,7 +781,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
             : '${_formatSd(sdValue)}%';[m
     final sdColor = sdWarning[m
         ? theme.colorScheme.error[m
[31m-        : theme.textTheme.labelSmall?.color ?? theme.colorScheme.onSurfaceVariant;[m
[32m+[m[32m        : theme.textTheme.labelSmall?.color ??[m
[32m+[m[32m            theme.colorScheme.onSurfaceVariant;[m
     final buttonStyle = TextButton.styleFrom([m
       padding: const EdgeInsets.symmetric(horizontal: 8),[m
       minimumSize: const Size(0, 28),[m
[36m@@ -784,9 +791,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
     );[m
     const controlDensity = VisualDensity(horizontal: -2, vertical: -4);[m
 [m
[31m-    final decoration = hide[m
[31m-        ? _hiddenResistanceDecoration[m
[31m-        : _resistanceDecoration;[m
[32m+[m[32m    final decoration =[m
[32m+[m[32m        hide ? _hiddenResistanceDecoration : _resistanceDecoration;[m
 [m
     return Opacity([m
       opacity: hide ? 0.45 : 1.0,[m
[36m@@ -914,7 +920,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
       context: context,[m
       builder: (context) {[m
         return AlertDialog([m
[31m-          title: Text('Notes for ${formatCompactValue(row.record.spacingFeet)} ft'),[m
[32m+[m[32m          title: Text([m
[32m+[m[32m              'Notes for ${formatCompactValue(row.record.spacingFeet)} ft'),[m
           content: Column([m
             mainAxisSize: MainAxisSize.min,[m
             crossAxisAlignment: CrossAxisAlignment.stretch,[m
[36m@@ -961,6 +968,7 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
       widget.onInterpretationChanged(row.record.spacingFeet, result);[m
     }[m
   }[m
[32m+[m
   Widget _buildMetadata(BuildContext context) {[m
     return LayoutBuilder([m
       builder: (context, constraints) {[m
[36m@@ -1018,7 +1026,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
                   child: _buildMoistureDropdown([m
                     context,[m
                     value: widget.site.moisture,[m
[31m-                    onChanged: (level) => widget.onMetadataChanged(moisture: level),[m
[32m+[m[32m                    onChanged: (level) =>[m
[32m+[m[32m                        widget.onMetadataChanged(moisture: level),[m
                   ),[m
                 ),[m
               ],[m
[36m@@ -1152,7 +1161,8 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
             child: Row([m
               mainAxisSize: MainAxisSize.min,[m
               children: [[m
[31m-                Icon(Icons.lock_outline, size: 14, color: theme.colorScheme.outline),[m
[32m+[m[32m                Icon(Icons.lock_outline,[m
[32m+[m[32m                    size: 14, color: theme.colorScheme.outline),[m
                 const SizedBox(width: 6),[m
                 Flexible([m
                   child: Text([m
[36m@@ -1185,8 +1195,10 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
       ),[m
     ];[m
   }[m
[32m+[m
   void _syncControllers(List<_FieldKey> keys, Map<_FieldKey, String> values) {[m
[31m-    final staleKeys = _controllers.keys.where((key) => !keys.contains(key)).toList();[m
[32m+[m[32m    final staleKeys =[m
[32m+[m[32m        _controllers.keys.where((key) => !keys.contains(key)).toList();[m
     for (final key in staleKeys) {[m
       _controllers.remove(key)?.dispose();[m
       _focusNodes.remove(key)?.dispose();[m
[36m@@ -1194,9 +1206,10 @@[m [mclass _TablePanelState extends State<TablePanel> {[m
 [m
     for (final key in keys) {[m
       final text = values[key] ?? '';[m
[31m-      final controller =[m
[31m-          _controllers.putIfAbsent(key, () => TextEditingController(text: text));[m
[31m-      final focusNode = _focusNodes.putIfAbsent(key, () => _createFocusNode(key));[m
[32m+[m[32m      final controller = _controllers.putIfAbsent([m
[32m+[m[32m          key, () => TextEditingController(text: text));[m
[32m+[m[32m      final focusNode =[m
[32m+[m[32m          _focusNodes.putIfAbsent(key, () => _createFocusNode(key));[m
       if (!focusNode.hasFocus && controller.text != text) {[m
         controller.text = text;[m
       }[m
[36m@@ -1515,12 +1528,15 @@[m [mclass TablePanelDebugFixture extends StatelessWidget {[m
       onSdChanged: (_, __, ___) {},[m
       onInterpretationChanged: (_, __) {},[m
       onToggleBad: (_, __, ___) {},[m
[31m-      onMetadataChanged: ({double? power, int? stacks, SoilType? soil, MoistureLevel? moisture}) {},[m
[32m+[m[32m      onMetadataChanged: ([m
[32m+[m[32m          {double? power,[m
[32m+[m[32m          int? stacks,[m
[32m+[m[32m          SoilType? soil,[m
[32m+[m[32m          MoistureLevel? moisture}) {},[m
       onShowHistory: (_, __) async {},[m
       onFocusChanged: (_, __) {},[m
     );[m
   }[m
[31m-[m
 }[m
 [m
 String _soilShortLabel(SoilType soil) {[m
[1mdiff --git a/lib/ui/screens/home_screen.dart b/lib/ui/screens/home_screen.dart[m
[1mindex 959e309..eaa6726 100644[m
[1m--- a/lib/ui/screens/home_screen.dart[m
[1m+++ b/lib/ui/screens/home_screen.dart[m
[36m@@ -94,7 +94,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
           PopupMenuButton<String>([m
             onSelected: _handleMenu,[m
             itemBuilder: (context) => const [[m
[31m-              PopupMenuItem(value: 'import', child: Text('Import CSV (sample)')),[m
[32m+[m[32m              PopupMenuItem([m
[32m+[m[32m                  value: 'import', child: Text('Import CSV (sample)')),[m
               PopupMenuItem(value: 'export', child: Text('Export CSV')),[m
               PopupMenuItem(value: 'settings', child: Text('Settings (stub)')),[m
             ],[m
[36m@@ -112,7 +113,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                   Expanded([m
                     child: points.isEmpty[m
                         ? const Center([m
[31m-                            child: Text('No data yet. Import a CSV or start simulation.'),[m
[32m+[m[32m                            child: Text([m
[32m+[m[32m                                'No data yet. Import a CSV or start simulation.'),[m
                           )[m
                         : SoundingChart([m
                             points: points,[m
[36m@@ -126,7 +128,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                     child: Container([m
                       height: 220,[m
                       decoration: BoxDecoration([m
[31m-                        color: Theme.of(context).colorScheme.surfaceContainerHighest,[m
[32m+[m[32m                        color: Theme.of(context)[m
[32m+[m[32m                            .colorScheme[m
[32m+[m[32m                            .surfaceContainerHighest,[m
                         borderRadius: BorderRadius.circular(12),[m
                         border: Border.all([m
                           color: Theme.of(context).colorScheme.outlineVariant,[m
[36m@@ -188,11 +192,14 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
             const SizedBox(width: 8),[m
             Expanded([m
               child: Tooltip([m
[31m-                message: 'Generate a synthetic VES (ρₐ vs a-spacing) for demo/QA.',[m
[32m+[m[32m                message:[m
[32m+[m[32m                    'Generate a synthetic VES (ρₐ vs a-spacing) for demo/QA.',[m
                 child: FilledButton.tonalIcon([m
                   icon: Icon(isSimulating ? Icons.stop : Icons.play_arrow),[m
[31m-                  label: Text(isSimulating ? 'Stop simulation' : 'Simulate sounding'),[m
[31m-                  onPressed: () => ref.read(simulationControllerProvider.notifier).toggle(),[m
[32m+[m[32m                  label: Text([m
[32m+[m[32m                      isSimulating ? 'Stop simulation' : 'Simulate sounding'),[m
[32m+[m[32m                  onPressed: () =>[m
[32m+[m[32m                      ref.read(simulationControllerProvider.notifier).toggle(),[m
                 ),[m
               ),[m
             ),[m
[36m@@ -230,7 +237,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
               title: const Text('Settings'),[m
               content: const Text('Settings are not yet implemented.'),[m
               actions: [[m
[31m-                TextButton(onPressed: () => Navigator.pop(ctx), child: const Text('OK')),[m
[32m+[m[32m                TextButton([m
[32m+[m[32m                    onPressed: () => Navigator.pop(ctx),[m
[32m+[m[32m                    child: const Text('OK')),[m
               ],[m
             ),[m
           );[m
[36m@@ -238,7 +247,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
     }[m
   }[m
 [m
[31m-  Widget _buildProjectPanel(ProjectState projectState, List<SpacingPoint> points) {[m
[32m+[m[32m  Widget _buildProjectPanel([m
[32m+[m[32m      ProjectState projectState, List<SpacingPoint> points) {[m
     final theme = Theme.of(context);[m
     final isSaving = projectState.isSaving;[m
     return Padding([m
[36m@@ -247,14 +257,17 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
         elevation: 0,[m
         child: ExpansionTile([m
           initiallyExpanded: _projectExpanded,[m
[31m-          onExpansionChanged: (expanded) => setState(() => _projectExpanded = expanded),[m
[32m+[m[32m          onExpansionChanged: (expanded) =>[m
[32m+[m[32m              setState(() => _projectExpanded = expanded),[m
           title: const Text('Project'),[m
[31m-          childrenPadding: const EdgeInsets.symmetric(horizontal: 16, vertical: 12),[m
[32m+[m[32m          childrenPadding:[m
[32m+[m[32m              const EdgeInsets.symmetric(horizontal: 16, vertical: 12),[m
           children: [[m
             TextField([m
               controller: _projectNameController,[m
               focusNode: _projectNameFocus,[m
[31m-              decoration: const InputDecoration(labelText: 'Project / Site name'),[m
[32m+[m[32m              decoration:[m
[32m+[m[32m                  const InputDecoration(labelText: 'Project / Site name'),[m
             ),[m
             const SizedBox(height: 8),[m
             TextField([m
[36m@@ -280,7 +293,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
               initialValue: _distanceUnit,[m
               decoration: const InputDecoration(labelText: 'Distance units'),[m
               items: DistanceUnit.values[m
[31m-                  .map((unit) => DropdownMenuItem(value: unit, child: Text(unit.label)))[m
[32m+[m[32m                  .map((unit) =>[m
[32m+[m[32m                      DropdownMenuItem(value: unit, child: Text(unit.label)))[m
                   .toList(),[m
               onChanged: (unit) {[m
                 if (unit != null) {[m
[36m@@ -325,15 +339,18 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
 [m
   void _applyProjectState(ProjectState state) {[m
     final project = state.project;[m
[31m-    final site = project?.sites.isNotEmpty == true ? project!.sites.first : null;[m
[32m+[m[32m    final site =[m
[32m+[m[32m        project?.sites.isNotEmpty == true ? project!.sites.first : null;[m
     final meta = site?.meta ?? const <String, dynamic>{};[m
     final projectName = project?.projectName ?? '';[m
     final line = (meta['line'] as String?) ?? site?.displayName ?? '';[m
     final operator = meta['operator'] as String? ?? '';[m
     final notes = meta['notes'] as String? ?? '';[m
[31m-    final distance = DistanceUnitX.parse(meta['distanceUnit'] as String?, fallback: _distanceUnit);[m
[32m+[m[32m    final distance = DistanceUnitX.parse(meta['distanceUnit'] as String?,[m
[32m+[m[32m        fallback: _distanceUnit);[m
 [m
[31m-    void update(TextEditingController controller, FocusNode focusNode, String value) {[m
[32m+[m[32m    void update([m
[32m+[m[32m        TextEditingController controller, FocusNode focusNode, String value) {[m
       if (!focusNode.hasFocus && controller.text != value) {[m
         controller.text = value;[m
       }[m
[36m@@ -438,14 +455,18 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
     final site = project_models.Site([m
       siteId: siteId.isNotEmpty ? siteId : 'site-1',[m
       displayName: siteId.isNotEmpty ? siteId : null,[m
[31m-      dirA: project_models.DirectionReadings(dir: project_models.Direction.a, points: dirA),[m
[31m-      dirB: project_models.DirectionReadings(dir: project_models.Direction.b, points: dirB),[m
[32m+[m[32m      dirA: project_models.DirectionReadings([m
[32m+[m[32m          dir: project_models.Direction.a, points: dirA),[m
[32m+[m[32m      dirB: project_models.DirectionReadings([m
[32m+[m[32m          dir: project_models.Direction.b, points: dirB),[m
       meta: meta.isEmpty ? null : meta,[m
     );[m
 [m
     return project_models.Project([m
       projectName: name.isNotEmpty ? name : 'Untitled project',[m
[31m-      arrayType: points.isNotEmpty ? points.first.arrayType.name : ArrayType.wenner.name,[m
[32m+[m[32m      arrayType: points.isNotEmpty[m
[32m+[m[32m          ? points.first.arrayType.name[m
[32m+[m[32m          : ArrayType.wenner.name,[m
       spacingsMeters: sortedPoints.map((p) => p.spacingMeters).toList(),[m
       sites: [site],[m
     );[m
[36m@@ -463,7 +484,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
       for (final entry in raw) {[m
         if (entry is Map) {[m
           try {[m
[31m-            restored.add(SpacingPoint.fromJson(Map<String, dynamic>.from(entry as Map)));[m
[32m+[m[32m            restored[m
[32m+[m[32m                .add(SpacingPoint.fromJson(Map<String, dynamic>.from(entry)));[m
           } catch (_) {[m
             continue;[m
           }[m
[36m@@ -476,7 +498,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
     final arrayType = _resolveArrayType(project.arrayType);[m
     final restored = <SpacingPoint>[];[m
 [m
[31m-    void addPoints(project_models.Direction direction, List<project_models.SpacingPoint> source) {[m
[32m+[m[32m    void addPoints(project_models.Direction direction,[m
[32m+[m[32m        List<project_models.SpacingPoint> source) {[m
       for (var i = 0; i < source.length; i++) {[m
         final point = source[i];[m
         if (point.rho == null) continue;[m
[36m@@ -548,7 +571,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
             }[m
 [m
             final spacingFeet = parseValue(aFeetController);[m
[31m-            final spacingMeters = spacingFeet != null ? feetToMeters(spacingFeet) : null;[m
[32m+[m[32m            final spacingMeters =[m
[32m+[m[32m                spacingFeet != null ? feetToMeters(spacingFeet) : null;[m
             final geometryFactor = spacingMeters != null && spacingMeters > 0[m
                 ? _geometryFactorForArray(arrayType, spacingMeters)[m
                 : null;[m
[36m@@ -559,37 +583,47 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
             final current = parseValue(currentController);[m
 [m
             final hasRho = rhoInput != null && rhoInput > 0;[m
[31m-            final hasResistance = resistanceInput != null && resistanceInput > 0;[m
[32m+[m[32m            final hasResistance =[m
[32m+[m[32m                resistanceInput != null && resistanceInput > 0;[m
 [m
             double? resolvedRhoValue = hasRho ? rhoInput : null;[m
             double? resolvedResistanceValue;[m
             if (hasRho && geometryFactor != null && geometryFactor > 0) {[m
[31m-              final rhoValue = rhoInput;[m
[31m-              if (rhoValue != null) {[m
[31m-                resolvedResistanceValue = rhoValue / geometryFactor;[m
[31m-              }[m
[31m-            } else if (!hasRho && hasResistance && geometryFactor != null && geometryFactor > 0) {[m
[31m-              final resistanceValue = resistanceInput;[m
[31m-              if (resistanceValue != null) {[m
[31m-                resolvedResistanceValue = resistanceValue;[m
[31m-                resolvedRhoValue = resistanceValue * geometryFactor;[m
[31m-              }[m
[32m+[m[32m              resolvedResistanceValue = rhoInput / geometryFactor;[m
[32m+[m[32m            } else if (!hasRho &&[m
[32m+[m[32m                hasResistance &&[m
[32m+[m[32m                geometryFactor != null &&[m
[32m+[m[32m                geometryFactor > 0) {[m
[32m+[m[32m              resolvedResistanceValue = resistanceInput;[m
[32m+[m[32m              resolvedRhoValue = resistanceInput * geometryFactor;[m
             }[m
 [m
             final rhoValue = rhoInput;[m
             final resistanceValue = resistanceInput;[m
[31m-            final computedResistance = rhoValue != null && geometryFactor != null && geometryFactor > 0[m
[31m-                ? rhoValue / geometryFactor[m
[31m-                : null;[m
[31m-            final computedRho = resistanceValue != null && !hasRho && hasResistance && geometryFactor != null && geometryFactor > 0[m
[32m+[m[32m            final computedResistance =[m
[32m+[m[32m                rhoValue != null && geometryFactor != null && geometryFactor > 0[m
[32m+[m[32m                    ? rhoValue / geometryFactor[m
[32m+[m[32m                    : null;[m
[32m+[m[32m            final computedRho = resistanceValue != null &&[m
[32m+[m[32m                    !hasRho &&[m
[32m+[m[32m                    hasResistance &&[m
[32m+[m[32m                    geometryFactor != null &&[m
[32m+[m[32m                    geometryFactor > 0[m
                 ? resistanceValue * geometryFactor[m
                 : null;[m
 [m
[31m-            final rhoFromVi = (voltage != null && current != null && current != 0 && spacingMeters != null)[m
[31m-                ? _geometryFactorForArray(arrayType, spacingMeters) * (voltage / current)[m
[32m+[m[32m            final rhoFromVi = (voltage != null &&[m
[32m+[m[32m                    current != null &&[m
[32m+[m[32m                    current != 0 &&[m
[32m+[m[32m                    spacingMeters != null)[m
[32m+[m[32m                ? _geometryFactorForArray(arrayType, spacingMeters) *[m
[32m+[m[32m                    (voltage / current)[m
                 : null;[m
[31m-            final rhoDiffPercent = (resolvedRhoValue != null && rhoFromVi != null && resolvedRhoValue != 0)[m
[31m-                ? ((rhoFromVi - resolvedRhoValue).abs() / resolvedRhoValue) * 100[m
[32m+[m[32m            final rhoDiffPercent = (resolvedRhoValue != null &&[m
[32m+[m[32m                    rhoFromVi != null &&[m
[32m+[m[32m                    resolvedRhoValue != 0)[m
[32m+[m[32m                ? ((rhoFromVi - resolvedRhoValue).abs() / resolvedRhoValue) *[m
[32m+[m[32m                    100[m
                 : null;[m
 [m
             final hasVoltage = voltageController.text.trim().isNotEmpty;[m
[36m@@ -598,11 +632,15 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                 spacingFeet > 0 &&[m
                 resolvedRhoValue != null &&[m
                 resolvedRhoValue > 0 &&[m
[31m-                (!hasResistance || geometryFactor != null && geometryFactor > 0);[m
[32m+[m[32m                (!hasResistance ||[m
[32m+[m[32m                    geometryFactor != null && geometryFactor > 0);[m
             final bool sigmaValid = sigmaRho == null || sigmaRho >= 0;[m
             final bool advancedPaired = hasVoltage == hasCurrent;[m
             final bool advancedCurrentValid = current == null || current > 0;[m
[31m-            final bool isAddEnabled = baseValid && sigmaValid && advancedPaired && advancedCurrentValid;[m
[32m+[m[32m            final bool isAddEnabled = baseValid &&[m
[32m+[m[32m                sigmaValid &&[m
[32m+[m[32m                advancedPaired &&[m
[32m+[m[32m                advancedCurrentValid;[m
 [m
             return AlertDialog([m
               title: const Text('Add manual point'),[m
[36m@@ -615,11 +653,17 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         Expanded([m
                           child: DropdownButtonFormField<ArrayType>([m
                             initialValue: arrayType,[m
[31m-                            decoration: const InputDecoration(labelText: 'Array'),[m
[31m-                            onChanged: (value) => setState(() => arrayType = value ?? arrayType),[m
[32m+[m[32m                            decoration:[m
[32m+[m[32m                                const InputDecoration(labelText: 'Array'),[m
[32m+[m[32m                            onChanged: (value) =>[m
[32m+[m[32m                                setState(() => arrayType = value ?? arrayType),[m
                             items: const [[m
[31m-                              DropdownMenuItem(value: ArrayType.wenner, child: Text('Wenner')),[m
[31m-                              DropdownMenuItem(value: ArrayType.schlumberger, child: Text('Schlumberger')),[m
[32m+[m[32m                              DropdownMenuItem([m
[32m+[m[32m                                  value: ArrayType.wenner,[m
[32m+[m[32m                                  child: Text('Wenner')),[m
[32m+[m[32m                              DropdownMenuItem([m
[32m+[m[32m                                  value: ArrayType.schlumberger,[m
[32m+[m[32m                                  child: Text('Schlumberger')),[m
                             ],[m
                           ),[m
                         ),[m
[36m@@ -627,10 +671,13 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         Expanded([m
                           child: DropdownButtonFormField<SoundingDirection>([m
                             initialValue: direction,[m
[31m-                            decoration: const InputDecoration(labelText: 'Direction'),[m
[31m-                            onChanged: (value) => setState(() => direction = value ?? direction),[m
[32m+[m[32m                            decoration:[m
[32m+[m[32m                                const InputDecoration(labelText: 'Direction'),[m
[32m+[m[32m                            onChanged: (value) =>[m
[32m+[m[32m                                setState(() => direction = value ?? direction),[m
                             items: SoundingDirection.values[m
[31m-                                .map((dir) => DropdownMenuItem(value: dir, child: Text(dir.label)))[m
[32m+[m[32m                                .map((dir) => DropdownMenuItem([m
[32m+[m[32m                                    value: dir, child: Text(dir.label)))[m
                                 .toList(),[m
                           ),[m
                         ),[m
[36m@@ -642,7 +689,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         icon: const Icon(Icons.paste),[m
                         label: const Text('Bulk paste'),[m
                         onPressed: () async {[m
[31m-                          final newDirection = await _showBulkPasteSheet(arrayType, direction);[m
[32m+[m[32m                          final newDirection =[m
[32m+[m[32m                              await _showBulkPasteSheet(arrayType, direction);[m
                           if (newDirection != null) {[m
                             setState(() => direction = newDirection);[m
                           }[m
[36m@@ -651,8 +699,10 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                     ),[m
                     TextField([m
                       controller: aFeetController,[m
[31m-                      decoration: const InputDecoration(labelText: 'A-spacing (ft)'),[m
[31m-                      keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                      decoration:[m
[32m+[m[32m                          const InputDecoration(labelText: 'A-spacing (ft)'),[m
[32m+[m[32m                      keyboardType:[m
[32m+[m[32m                          const TextInputType.numberWithOptions(decimal: true),[m
                       onChanged: (_) => setState(() {}),[m
                     ),[m
                     if (spacingMeters != null)[m
[36m@@ -673,7 +723,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         labelText: 'Apparent ρ (Ω·m)',[m
                         helperText: 'Leave blank if you only logged apparent R',[m
                       ),[m
[31m-                      keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                      keyboardType:[m
[32m+[m[32m                          const TextInputType.numberWithOptions(decimal: true),[m
                       onChanged: (_) => setState(() {}),[m
                     ),[m
                     if (computedResistance != null)[m
[36m@@ -683,7 +734,10 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                           padding: const EdgeInsets.only(top: 4),[m
                           child: Text([m
                             'Computed R ≈ ${computedResistance.toStringAsFixed(3)} Ω',[m
[31m-                            style: Theme.of(context).textTheme.bodySmall?.copyWith(fontStyle: FontStyle.italic),[m
[32m+[m[32m                            style: Theme.of(context)[m
[32m+[m[32m                                .textTheme[m
[32m+[m[32m                                .bodySmall[m
[32m+[m[32m                                ?.copyWith(fontStyle: FontStyle.italic),[m
                           ),[m
                         ),[m
                       ),[m
[36m@@ -692,9 +746,11 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                       controller: resistanceController,[m
                       decoration: const InputDecoration([m
                         labelText: 'Apparent R (Ω)',[m
[31m-                        helperText: 'Provide if you logged resistance instead of ρ',[m
[32m+[m[32m                        helperText:[m
[32m+[m[32m                            'Provide if you logged resistance instead of ρ',[m
                       ),[m
[31m-                      keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                      keyboardType:[m
[32m+[m[32m                          const TextInputType.numberWithOptions(decimal: true),[m
                       onChanged: (_) => setState(() {}),[m
                     ),[m
                     if (computedRho != null)[m
[36m@@ -704,7 +760,10 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                           padding: const EdgeInsets.only(top: 4),[m
                           child: Text([m
                             'Computed ρ ≈ ${computedRho.toStringAsFixed(2)} Ω·m',[m
[31m-                            style: Theme.of(context).textTheme.bodySmall?.copyWith(fontStyle: FontStyle.italic),[m
[32m+[m[32m                            style: Theme.of(context)[m
[32m+[m[32m                                .textTheme[m
[32m+[m[32m                                .bodySmall[m
[32m+[m[32m                                ?.copyWith(fontStyle: FontStyle.italic),[m
                           ),[m
                         ),[m
                       ),[m
[36m@@ -715,7 +774,10 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                           padding: const EdgeInsets.only(top: 4),[m
                           child: Text([m
                             'Enter apparent ρ or apparent R.',[m
[31m-                            style: Theme.of(context).textTheme.bodySmall?.copyWith([m
[32m+[m[32m                            style: Theme.of(context)[m
[32m+[m[32m                                .textTheme[m
[32m+[m[32m                                .bodySmall[m
[32m+[m[32m                                ?.copyWith([m
                                   color: Theme.of(context).colorScheme.error,[m
                                 ),[m
                           ),[m
[36m@@ -724,13 +786,16 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                     const SizedBox(height: 12),[m
                     TextField([m
                       controller: sigmaRhoController,[m
[31m-                      decoration: const InputDecoration(labelText: 'Std dev σρ (Ω·m, optional)'),[m
[31m-                      keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                      decoration: const InputDecoration([m
[32m+[m[32m                          labelText: 'Std dev σρ (Ω·m, optional)'),[m
[32m+[m[32m                      keyboardType:[m
[32m+[m[32m                          const TextInputType.numberWithOptions(decimal: true),[m
                       onChanged: (_) => setState(() {}),[m
                     ),[m
                     TextField([m
                       controller: notesController,[m
[31m-                      decoration: const InputDecoration(labelText: 'Notes / tag (optional)'),[m
[32m+[m[32m                      decoration: const InputDecoration([m
[32m+[m[32m                          labelText: 'Notes / tag (optional)'),[m
                       keyboardType: TextInputType.text,[m
                     ),[m
                     const SizedBox(height: 12),[m
[36m@@ -755,8 +820,12 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         alignment: Alignment.centerLeft,[m
                         child: Text([m
                           'Δρ vs V/I: ${rhoDiffPercent.toStringAsFixed(1)}%',[m
[31m-                          style: Theme.of(context).textTheme.bodySmall?.copyWith([m
[31m-                                color: rhoDiffPercent > SpacingPoint.rhoQaThresholdPercent[m
[32m+[m[32m                          style: Theme.of(context)[m
[32m+[m[32m                              .textTheme[m
[32m+[m[32m                              .bodySmall[m
[32m+[m[32m                              ?.copyWith([m
[32m+[m[32m                                color: rhoDiffPercent >[m
[32m+[m[32m                                        SpacingPoint.rhoQaThresholdPercent[m
                                     ? Colors.orange[m
                                     : Theme.of(context).colorScheme.onSurface,[m
                               ),[m
[36m@@ -766,27 +835,35 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                     ExpansionTile([m
                       title: const Text('Advanced'),[m
                       initiallyExpanded: advancedExpanded,[m
[31m-                      onExpansionChanged: (value) => setState(() => advancedExpanded = value),[m
[31m-                      childrenPadding: const EdgeInsets.symmetric(horizontal: 8),[m
[32m+[m[32m                      onExpansionChanged: (value) =>[m
[32m+[m[32m                          setState(() => advancedExpanded = value),[m
[32m+[m[32m                      childrenPadding:[m
[32m+[m[32m                          const EdgeInsets.symmetric(horizontal: 8),[m
                       children: [[m
                         TextField([m
                           controller: voltageController,[m
[31m-                          decoration: const InputDecoration(labelText: 'Potential (V)'),[m
[31m-                          keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                          decoration:[m
[32m+[m[32m                              const InputDecoration(labelText: 'Potential (V)'),[m
[32m+[m[32m                          keyboardType: const TextInputType.numberWithOptions([m
[32m+[m[32m                              decimal: true),[m
                           onChanged: (_) => setState(() {}),[m
                         ),[m
                         TextField([m
                           controller: currentController,[m
[31m-                          decoration: const InputDecoration(labelText: 'Current (A)'),[m
[31m-                          keyboardType: const TextInputType.numberWithOptions(decimal: true),[m
[32m+[m[32m                          decoration:[m
[32m+[m[32m                              const InputDecoration(labelText: 'Current (A)'),[m
[32m+[m[32m                          keyboardType: const TextInputType.numberWithOptions([m
[32m+[m[32m                              decimal: true),[m
                           onChanged: (_) => setState(() {}),[m
                         ),[m
                         if (rhoFromVi != null)[m
                           Padding([m
[31m-                            padding: const EdgeInsets.only(top: 8.0, bottom: 12),[m
[32m+[m[32m                            padding:[m
[32m+[m[32m                                const EdgeInsets.only(top: 8.0, bottom: 12),[m
                             child: Align([m
                               alignment: Alignment.centerLeft,[m
[31m-                              child: Text('ρ (from V/I): ${rhoFromVi.toStringAsFixed(2)} Ω·m'),[m
[32m+[m[32m                              child: Text([m
[32m+[m[32m                                  'ρ (from V/I): ${rhoFromVi.toStringAsFixed(2)} Ω·m'),[m
                             ),[m
                           ),[m
                       ],[m
[36m@@ -795,49 +872,63 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                 ),[m
               ),[m
               actions: [[m
[31m-                TextButton(onPressed: () => Navigator.pop(ctx), child: const Text('Cancel')),[m
[32m+[m[32m                TextButton([m
[32m+[m[32m                    onPressed: () => Navigator.pop(ctx),[m
[32m+[m[32m                    child: const Text('Cancel')),[m
                 FilledButton([m
                   onPressed: isAddEnabled[m
                       ? () {[m
                           if (hasVoltage != hasCurrent) {[m
                             ScaffoldMessenger.of(context).showSnackBar([m
[31m-                              const SnackBar(content: Text('Provide both Potential and Current for advanced QA.')),[m
[32m+[m[32m                              const SnackBar([m
[32m+[m[32m                                  content: Text([m
[32m+[m[32m                                      'Provide both Potential and Current for advanced QA.')),[m
                             );[m
                             return;[m
                           }[m
                           if (current != null && current <= 0) {[m
                             ScaffoldMessenger.of(context).showSnackBar([m
[31m-                              const SnackBar(content: Text('Current must be greater than zero.')),[m
[32m+[m[32m                              const SnackBar([m
[32m+[m[32m                                  content: Text([m
[32m+[m[32m                                      'Current must be greater than zero.')),[m
                             );[m
                             return;[m
                           }[m
 [m
[31m-                          final spacingFeetValue = spacingFeet;[m
[31m-                          if (spacingFeetValue == null) {[m
[32m+[m[32m                          final spacingFeetValue = parseValue(aFeetController);[m
[32m+[m[32m                          if (spacingFeetValue == null ||[m
[32m+[m[32m                              spacingFeetValue <= 0) {[m
                             ScaffoldMessenger.of(context).showSnackBar([m
[31m-                              const SnackBar(content: Text('A-spacing is required.')),[m
[32m+[m[32m                              const SnackBar([m
[32m+[m[32m                                  content: Text('A-spacing is required.')),[m
                             );[m
                             return;[m
                           }[m
[31m-                          final spacingMetersValue = feetToMeters(spacingFeetValue);[m
[31m-                          final geometry = _geometryFactorForArray(arrayType, spacingMetersValue);[m
[32m+[m[32m                          final spacingMetersValue =[m
[32m+[m[32m                              feetToMeters(spacingFeetValue);[m
[32m+[m[32m                          final geometry = _geometryFactorForArray([m
[32m+[m[32m                              arrayType, spacingMetersValue);[m
                           double? finalRho = resolvedRhoValue;[m
                           double? finalResistance = resolvedResistanceValue;[m
[31m-                          if (finalRho == null && hasResistance && geometry > 0) {[m
[31m-                            final resistanceValue = resistanceInput;[m
[31m-                            if (resistanceValue != null) {[m
[31m-                              finalRho = resistanceValue * geometry;[m
[31m-                              finalResistance = resistanceValue;[m
[31m-                            }[m
[32m+[m[32m                          if (finalRho == null &&[m
[32m+[m[32m                              hasResistance &&[m
[32m+[m[32m                              geometry > 0) {[m
[32m+[m[32m                            finalRho = resistanceInput * geometry;[m
[32m+[m[32m                            finalResistance = resistanceInput;[m
                           }[m
                           if (finalRho == null || finalRho <= 0) {[m
                             ScaffoldMessenger.of(context).showSnackBar([m
[31m-                              const SnackBar(content: Text('Could not resolve apparent resistivity.')),[m
[32m+[m[32m                              const SnackBar([m
[32m+[m[32m                                  content: Text([m
[32m+[m[32m                                      'Could not resolve apparent resistivity.')),[m
                             );[m
                             return;[m
                           }[m
[31m-                          final sigmaValue = sigmaRho != null && sigmaRho >= 0 ? sigmaRho : null;[m
[31m-                          final manualId = DateFormat('yyyyMMddHHmmss').format(DateTime.now());[m
[32m+[m[32m                          final sigmaValue = sigmaRho != null && sigmaRho >= 0[m
[32m+[m[32m                              ? sigmaRho[m
[32m+[m[32m                              : null;[m
[32m+[m[32m                          final manualId = DateFormat('yyyyMMddHHmmss')[m
[32m+[m[32m                              .format(DateTime.now());[m
                           try {[m
                             final point = SpacingPoint([m
                               id: manualId,[m
[36m@@ -855,9 +946,13 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                               stacks: 1,[m
                               repeats: null,[m
                               timestamp: DateTime.now(),[m
[31m-                              notes: notesController.text.trim().isEmpty ? null : notesController.text.trim(),[m
[32m+[m[32m                              notes: notesController.text.trim().isEmpty[m
[32m+[m[32m                                  ? null[m
[32m+[m[32m                                  : notesController.text.trim(),[m
                             );[m
[31m-                            ref.read(spacingPointsProvider.notifier).addPoint(point);[m
[32m+[m[32m                            ref[m
[32m+[m[32m                                .read(spacingPointsProvider.notifier)[m
[32m+[m[32m                                .addPoint(point);[m
                             if (voltage != null && current != null) {[m
                               ref.read(telemetryProvider.notifier).addSample([m
                                     current: current,[m
[36m@@ -867,7 +962,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                             Navigator.pop(ctx);[m
                           } catch (error) {[m
                             ScaffoldMessenger.of(context).showSnackBar([m
[31m-                              SnackBar(content: Text('Could not add point: ${error.toString()}')),[m
[32m+[m[32m                              SnackBar([m
[32m+[m[32m                                  content: Text([m
[32m+[m[32m                                      'Could not add point: ${error.toString()}')),[m
                             );[m
                           }[m
                         }[m
[36m@@ -887,7 +984,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
     SoundingDirection initialDirection,[m
   ) async {[m
     final pasteController = TextEditingController();[m
[31m-    final bulkNotesController = TextEditingController(text: '${initialDirection.label} bulk');[m
[32m+[m[32m    final bulkNotesController =[m
[32m+[m[32m        TextEditingController(text: '${initialDirection.label} bulk');[m
     SoundingDirection selectedDirection = initialDirection;[m
     int? lastAdded;[m
     List<String> skippedMessages = const [];[m
[36m@@ -901,23 +999,28 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
           builder: (sheetCtx, setState) {[m
             final bottomInset = MediaQuery.of(sheetCtx).viewInsets.bottom;[m
             return Padding([m
[31m-              padding: EdgeInsets.only(left: 16, right: 16, top: 16, bottom: bottomInset + 16),[m
[32m+[m[32m              padding: EdgeInsets.only([m
[32m+[m[32m                  left: 16, right: 16, top: 16, bottom: bottomInset + 16),[m
               child: Column([m
                 mainAxisSize: MainAxisSize.min,[m
                 children: [[m
[31m-                  Text('Bulk paste points', style: Theme.of(sheetCtx).textTheme.titleMedium),[m
[32m+[m[32m                  Text('Bulk paste points',[m
[32m+[m[32m                      style: Theme.of(sheetCtx).textTheme.titleMedium),[m
                   const SizedBox(height: 12),[m
                   DropdownButtonFormField<SoundingDirection>([m
                     initialValue: selectedDirection,[m
                     decoration: const InputDecoration(labelText: 'Orientation'),[m
[31m-                    onChanged: (value) => setState(() => selectedDirection = value ?? selectedDirection),[m
[32m+[m[32m                    onChanged: (value) => setState([m
[32m+[m[32m                        () => selectedDirection = value ?? selectedDirection),[m
                     items: SoundingDirection.values[m
[31m-                        .map((dir) => DropdownMenuItem(value: dir, child: Text(dir.label)))[m
[32m+[m[32m                        .map((dir) => DropdownMenuItem([m
[32m+[m[32m                            value: dir, child: Text(dir.label)))[m
                         .toList(),[m
                   ),[m
                   TextField([m
                     controller: bulkNotesController,[m
[31m-                    decoration: const InputDecoration(labelText: 'Notes / tag (optional)'),[m
[32m+[m[32m                    decoration: const InputDecoration([m
[32m+[m[32m                        labelText: 'Notes / tag (optional)'),[m
                   ),[m
                   const SizedBox(height: 12),[m
                   TextField([m
[36m@@ -936,7 +1039,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                       TextButton([m
                         onPressed: () => Navigator.pop([m
                           sheetCtx,[m
[31m-                          lastAdded != null && lastAdded! > 0 ? selectedDirection : null,[m
[32m+[m[32m                          lastAdded != null && lastAdded! > 0[m
[32m+[m[32m                              ? selectedDirection[m
[32m+[m[32m                              : null,[m
                         ),[m
                         child: const Text('Close'),[m
                       ),[m
[36m@@ -945,31 +1050,40 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                         onPressed: () {[m
                           final raw = pasteController.text;[m
                           final lines = raw.split(RegExp(r'\r?\n'));[m
[31m-                          final notifier = ref.read(spacingPointsProvider.notifier);[m
[32m+[m[32m                          final notifier =[m
[32m+[m[32m                              ref.read(spacingPointsProvider.notifier);[m
                           final newSkipped = <String>[];[m
                           var added = 0;[m
                           for (var i = 0; i < lines.length; i++) {[m
                             final line = lines[i].trim();[m
                             if (line.isEmpty) continue;[m
[31m-                            final parts = line.split(RegExp(r'[\s,]+')).where((token) => token.isNotEmpty).toList();[m
[32m+[m[32m                            final parts = line[m
[32m+[m[32m                                .split(RegExp(r'[\s,]+'))[m
[32m+[m[32m                                .where((token) => token.isNotEmpty)[m
[32m+[m[32m                                .toList();[m
                             if (parts.length < 2) {[m
[31m-                              newSkipped.add('Row ${i + 1}: expected A(ft) and Ω values.');[m
[32m+[m[32m                              newSkipped.add([m
[32m+[m[32m                                  'Row ${i + 1}: expected A(ft) and Ω values.');[m
                               continue;[m
                             }[m
                             final aFeet = double.tryParse(parts[0]);[m
                             final resistance = double.tryParse(parts[1]);[m
                             if (aFeet == null || resistance == null) {[m
[31m-                              newSkipped.add('Row ${i + 1}: non-numeric value.');[m
[32m+[m[32m                              newSkipped[m
[32m+[m[32m                                  .add('Row ${i + 1}: non-numeric value.');[m
                               continue;[m
                             }[m
                             if (aFeet <= 0 || resistance <= 0) {[m
[31m-                              newSkipped.add('Row ${i + 1}: values must be > 0.');[m
[32m+[m[32m                              newSkipped[m
[32m+[m[32m                                  .add('Row ${i + 1}: values must be > 0.');[m
                               continue;[m
                             }[m
                             final aMeters = feetToMeters(aFeet);[m
[31m-                            final k = _geometryFactorForArray(arrayType, aMeters);[m
[32m+[m[32m                            final k =[m
[32m+[m[32m                                _geometryFactorForArray(arrayType, aMeters);[m
                             if (k <= 0) {[m
[31m-                              newSkipped.add('Row ${i + 1}: geometry factor unavailable.');[m
[32m+[m[32m                              newSkipped.add([m
[32m+[m[32m                                  'Row ${i + 1}: geometry factor unavailable.');[m
                               continue;[m
                             }[m
                             final rho = resistance * k;[m
[36m@@ -980,7 +1094,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                               rhoAppOhmM: rho,[m
                               direction: selectedDirection,[m
                               spacingMeters: aMeters,[m
[31m-                              notes: notes.isEmpty ? '${selectedDirection.label} bulk' : notes,[m
[32m+[m[32m                              notes: notes.isEmpty[m
[32m+[m[32m                                  ? '${selectedDirection.label} bulk'[m
[32m+[m[32m                                  : notes,[m
                             );[m
                             notifier.addPoint(point);[m
                             added++;[m
[36m@@ -988,7 +1104,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                           setState(() {[m
                             lastAdded = added;[m
                             skippedMessages = newSkipped;[m
[31m-                            summary = 'Added ${added.toString()} row(s). Skipped ${newSkipped.length}.';[m
[32m+[m[32m                            summary =[m
[32m+[m[32m                                'Added ${added.toString()} row(s). Skipped ${newSkipped.length}.';[m
                           });[m
                         },[m
                         child: const Text('Import'),[m
[36m@@ -999,7 +1116,8 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                     const SizedBox(height: 12),[m
                     Align([m
                       alignment: Alignment.centerLeft,[m
[31m-                      child: Text(summary!, style: Theme.of(sheetCtx).textTheme.bodySmall),[m
[32m+[m[32m                      child: Text(summary!,[m
[32m+[m[32m                          style: Theme.of(sheetCtx).textTheme.bodySmall),[m
                     ),[m
                     if (skippedMessages.isNotEmpty)[m
                       ...skippedMessages.map([m
[36m@@ -1010,7 +1128,9 @@[m [mclass _HomeScreenState extends ConsumerState<HomeScreen> {[m
                             style: Theme.of(sheetCtx)[m
                                 .textTheme[m
                                 .bodySmall[m
[31m-                                ?.copyWith(color: Theme.of(sheetCtx).colorScheme.error),[m
[32m+[m[32m                                ?.copyWith([m
[32m+[m[32m                                    color:[m
[32m+[m[32m                                        Theme.of(sheetCtx).colorScheme.error),[m
                           ),[m
                         ),[m
                       ),[m
[1mdiff --git a/lib/ui/widgets/header_badges.dart b/lib/ui/widgets/header_badges.dart[m
[1mindex 33a405b..98f2322 100644[m
[1m--- a/lib/ui/widgets/header_badges.dart[m
[1m+++ b/lib/ui/widgets/header_badges.dart[m
[36m@@ -22,8 +22,16 @@[m [mclass HeaderBadges extends StatelessWidget {[m
           _badge('Green', summary.green.toString(), color: Colors.green),[m
           _badge('Yellow', summary.yellow.toString(), color: Colors.orange),[m
           _badge('Red', summary.red.toString(), color: Colors.red),[m
[31m-          _badge('SP drift', summary.lastSpDrift == null ? '—' : '${summary.lastSpDrift!.toStringAsFixed(2)} mV'),[m
[31m-          _badge('Contact Ω', summary.worstContact == null ? '—' : summary.worstContact!.toStringAsFixed(0)),[m
[32m+[m[32m          _badge([m
[32m+[m[32m              'SP drift',[m
[32m+[m[32m              summary.lastSpDrift == null[m
[32m+[m[32m                  ? '—'[m
[32m+[m[32m                  : '${summary.lastSpDrift!.toStringAsFixed(2)} mV'),[m
[32m+[m[32m          _badge([m
[32m+[m[32m              'Contact Ω',[m
[32m+[m[32m              summary.worstContact == null[m
[32m+[m[32m                  ? '—'[m
[32m+[m[32m                  : summary.worstContact!.toStringAsFixed(0)),[m
         ],[m
       ),[m
     );[m
[36m@@ -31,13 +39,19 @@[m [mclass HeaderBadges extends StatelessWidget {[m
 [m
   Widget _badge(String label, String value, {Color? color}) {[m
     return Chip([m
[31m-      avatar: color != null ? CircleAvatar(backgroundColor: color, radius: 6) : null,[m
[32m+[m[32m      avatar: color != null[m
[32m+[m[32m          ? CircleAvatar(backgroundColor: color, radius: 6)[m
[32m+[m[32m          : null,[m
       label: Column([m
         mainAxisSize: MainAxisSize.min,[m
         crossAxisAlignment: CrossAxisAlignment.start,[m
         children: [[m
[31m-          Text(label, style: const TextStyle(fontSize: 12, fontWeight: FontWeight.w500)),[m
[31m-          Text(value, style: const TextStyle(fontSize: 14, fontWeight: FontWeight.bold)),[m
[32m+[m[32m          Text(label,[m
[32m+[m[32m              style:[m
[32m+[m[32m                  const TextStyle(fontSize: 12, fontWeight: FontWeight.w500)),[m
[32m+[m[32m          Text(value,[m
[32m+[m[32m              style:[m
[32m+[m[32m                  const TextStyle(fontSize: 14, fontWeight: FontWeight.bold)),[m
         ],[m
       ),[m
     );[m
[1mdiff --git a/lib/ui/widgets/point_details_sheet.dart b/lib/ui/widgets/point_details_sheet.dart[m
[1mindex dbd1409..996e8f7 100644[m
[1m--- a/lib/ui/widgets/point_details_sheet.dart[m
[1m+++ b/lib/ui/widgets/point_details_sheet.dart[m
[36m@@ -27,7 +27,8 @@[m [mclass PointDetailsSheet extends ConsumerWidget {[m
             Text('σρ: ${point.sigmaRhoOhmM!.toStringAsFixed(2)} Ω·m'),[m
           Text('R (derived): ${point.resistanceOhm.toStringAsFixed(2)} Ω'),[m
           if (point.resistanceStdOhm != null)[m
[31m-            Text('σR (derived): ${point.resistanceStdOhm!.toStringAsFixed(2)} Ω'),[m
[32m+[m[32m            Text([m
[32m+[m[32m                'σR (derived): ${point.resistanceStdOhm!.toStringAsFixed(2)} Ω'),[m
           Text('Direction: ${point.direction.label}'),[m
           if (point.voltageV != null)[m
             Text('Voltage: ${point.voltageV!.toStringAsFixed(3)} V'),[m
[36m@@ -41,7 +42,9 @@[m [mclass PointDetailsSheet extends ConsumerWidget {[m
             Row([m
               children: [[m
                 Icon([m
[31m-                  point.hasRhoQaWarning ? Icons.warning_amber_rounded : Icons.info_outline,[m
[32m+[m[32m                  point.hasRhoQaWarning[m
[32m+[m[32m                      ? Icons.warning_amber_rounded[m
[32m+[m[32m                      : Icons.info_outline,[m
                   color: point.hasRhoQaWarning[m
                       ? Colors.orange[m
                       : Theme.of(context).colorScheme.primary,[m
[36m@@ -61,8 +64,8 @@[m [mclass PointDetailsSheet extends ConsumerWidget {[m
               Switch([m
                 value: excluded,[m
                 onChanged: (value) {[m
[31m-                  ref.read(spacingPointsProvider.notifier).updatePoint(point.id, (current) =>[m
[31m-                      current.copyWith(excluded: value));[m
[32m+[m[32m                  ref.read(spacingPointsProvider.notifier).updatePoint([m
[32m+[m[32m                      point.id, (current) => current.copyWith(excluded: value));[m
                   Navigator.pop(context);[m
                 },[m
               ),[m
[1mdiff --git a/lib/ui/widgets/points_table.dart b/lib/ui/widgets/points_table.dart[m
[1mindex 16f5e22..a5552c9 100644[m
[1m--- a/lib/ui/widgets/points_table.dart[m
[1m+++ b/lib/ui/widgets/points_table.dart[m
[36m@@ -44,7 +44,10 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
         final controller = _controllers[point.id];[m
         final focusNode = _focusNodes[point.id];[m
         final text = point.notes ?? '';[m
[31m-        if (controller != null && focusNode != null && !focusNode.hasFocus && controller.text != text) {[m
[32m+[m[32m        if (controller != null &&[m
[32m+[m[32m            focusNode != null &&[m
[32m+[m[32m            !focusNode.hasFocus &&[m
[32m+[m[32m            controller.text != text) {[m
           controller.text = text;[m
         }[m
       }[m
[36m@@ -64,13 +67,15 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
 [m
   void _syncControllers() {[m
     final existingIds = widget.points.map((p) => p.id).toSet();[m
[31m-    final keysToRemove = _controllers.keys.where((id) => !existingIds.contains(id)).toList();[m
[32m+[m[32m    final keysToRemove =[m
[32m+[m[32m        _controllers.keys.where((id) => !existingIds.contains(id)).toList();[m
     for (final id in keysToRemove) {[m
       _controllers.remove(id)?.dispose();[m
       _focusNodes.remove(id)?.dispose();[m
     }[m
     for (final point in widget.points) {[m
[31m-      _controllers.putIfAbsent(point.id, () => TextEditingController(text: point.notes ?? ''));[m
[32m+[m[32m      _controllers.putIfAbsent([m
[32m+[m[32m          point.id, () => TextEditingController(text: point.notes ?? ''));[m
       _focusNodes.putIfAbsent(point.id, () => FocusNode());[m
       final focusNode = _focusNodes[point.id]!;[m
       final controller = _controllers[point.id]!;[m
[36m@@ -99,14 +104,17 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
           ? (point.rhoAppOhmM - predictedValue) / predictedValue[m
           : 0.0;[m
       final coefficientOfVariation =[m
[31m-          point.sigmaRhoOhmM == null || point.rhoAppOhmM == 0 ? null : (point.sigmaRhoOhmM! / point.rhoAppOhmM);[m
[32m+[m[32m          point.sigmaRhoOhmM == null || point.rhoAppOhmM == 0[m
[32m+[m[32m              ? null[m
[32m+[m[32m              : (point.sigmaRhoOhmM! / point.rhoAppOhmM);[m
       final qaLevel = classifyPoint([m
         residual: residual,[m
         coefficientOfVariation: coefficientOfVariation,[m
         point: point,[m
       );[m
       final qaColor = _qaColor(qaLevel);[m
[31m-      final rhoText = point.rhoAppOhmM.isFinite ? point.rhoAppOhmM.toStringAsFixed(2) : '—';[m
[32m+[m[32m      final rhoText =[m
[32m+[m[32m          point.rhoAppOhmM.isFinite ? point.rhoAppOhmM.toStringAsFixed(2) : '—';[m
       final resistance = point.resistanceOhm;[m
       final sigma = point.sigmaRhoOhmM;[m
       final isExcluded = point.excluded;[m
[36m@@ -114,15 +122,18 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
       rows.add([m
         DataRow([m
           color: isExcluded[m
[31m-              ? WidgetStatePropertyAll(theme.colorScheme.surfaceContainerHighest.withValues(alpha: 0.4))[m
[32m+[m[32m              ? WidgetStatePropertyAll(theme.colorScheme.surfaceContainerHighest[m
[32m+[m[32m                  .withValues(alpha: 0.4))[m
               : null,[m
           cells: [[m
             DataCell(Text('${i + 1}')),[m
             DataCell(Text(point.arrayType.name)),[m
             DataCell(Text(point.direction.label)),[m
[31m-            DataCell(Text(widget.distanceUnit.formatSpacing(point.spacingMeters))),[m
[32m+[m[32m            DataCell([m
[32m+[m[32m                Text(widget.distanceUnit.formatSpacing(point.spacingMeters))),[m
             DataCell(Text(rhoText)),[m
[31m-            DataCell(Text(resistance.isFinite ? resistance.toStringAsFixed(2) : '—')),[m
[32m+[m[32m            DataCell(Text([m
[32m+[m[32m                resistance.isFinite ? resistance.toStringAsFixed(2) : '—')),[m
             DataCell(Text(sigma != null ? sigma.toStringAsFixed(2) : '—')),[m
             DataCell(Center([m
               child: Container([m
[36m@@ -131,7 +142,8 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
                 decoration: BoxDecoration([m
                   color: qaColor,[m
                   shape: BoxShape.circle,[m
[31m-                  border: Border.all(color: theme.colorScheme.onSurface, width: 0.5),[m
[32m+[m[32m                  border: Border.all([m
[32m+[m[32m                      color: theme.colorScheme.onSurface, width: 0.5),[m
                 ),[m
               ),[m
             )),[m
[36m@@ -148,7 +160,8 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
                   ),[m
                   textInputAction: TextInputAction.done,[m
                   onSubmitted: (value) => _commitNote(point.id, value),[m
[31m-                  onEditingComplete: () => _commitNote(point.id, controller.text),[m
[32m+[m[32m                  onEditingComplete: () =>[m
[32m+[m[32m                      _commitNote(point.id, controller.text),[m
                 ),[m
               ),[m
             ),[m
[36m@@ -156,7 +169,9 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
               IconButton([m
                 icon: const Icon(Icons.delete_outline, size: 20),[m
                 tooltip: 'Delete point',[m
[31m-                onPressed: () => ref.read(spacingPointsProvider.notifier).removePoint(point.id),[m
[32m+[m[32m                onPressed: () => ref[m
[32m+[m[32m                    .read(spacingPointsProvider.notifier)[m
[32m+[m[32m                    .removePoint(point.id),[m
               ),[m
             ),[m
           ],[m
[36m@@ -171,7 +186,8 @@[m [mclass _PointsTableState extends ConsumerState<PointsTable> {[m
         child: ConstrainedBox([m
           constraints: const BoxConstraints(minWidth: 720),[m
           child: DataTable([m
[31m-            headingTextStyle: theme.textTheme.labelMedium?.copyWith(fontWeight: FontWeight.bold),[m
[32m+[m[32m            headingTextStyle: theme.textTheme.labelMedium[m
[32m+[m[32m                ?.copyWith(fontWeight: FontWeight.bold),[m
             dataRowMinHeight: 44,[m
             columns: [[m
               const DataColumn(label: Text('#')),[m
[1mdiff --git a/lib/ui/widgets/residual_strip.dart b/lib/ui/widgets/residual_strip.dart[m
[1mindex 476c02b..fc36fe0 100644[m
[1m--- a/lib/ui/widgets/residual_strip.dart[m
[1m+++ b/lib/ui/widgets/residual_strip.dart[m
[36m@@ -6,7 +6,8 @@[m [mimport '../../models/spacing_point.dart';[m
 import '../../services/qc_rules.dart';[m
 [m
 class ResidualStrip extends StatelessWidget {[m
[31m-  const ResidualStrip({super.key, required this.points, required this.inversion});[m
[32m+[m[32m  const ResidualStrip([m
[32m+[m[32m      {super.key, required this.points, required this.inversion});[m
 [m
   final List<SpacingPoint> points;[m
   final dynamic inversion;[m
[36m@@ -41,7 +42,8 @@[m [mclass ResidualStrip extends StatelessWidget {[m
         child: Column([m
           crossAxisAlignment: CrossAxisAlignment.stretch,[m
           children: [[m
[31m-            const Text('Residuals', style: TextStyle(fontWeight: FontWeight.bold)),[m
[32m+[m[32m            const Text('Residuals',[m
[32m+[m[32m                style: TextStyle(fontWeight: FontWeight.bold)),[m
             const SizedBox(height: 8),[m
             Expanded([m
               child: Row([m
[36m@@ -57,7 +59,9 @@[m [mclass ResidualStrip extends StatelessWidget {[m
                   Expanded([m
                     child: Container([m
                       decoration: BoxDecoration([m
[31m-                        color: Theme.of(context).colorScheme.surfaceContainerHighest,[m
[32m+[m[32m                        color: Theme.of(context)[m
[32m+[m[32m                            .colorScheme[m
[32m+[m[32m                            .surfaceContainerHighest,[m
                         borderRadius: BorderRadius.circular(8),[m
                       ),[m
                       child: Stack([m
[36m@@ -73,24 +77,32 @@[m [mclass ResidualStrip extends StatelessWidget {[m
                             ),[m
                           ),[m
                           Padding([m
[31m-                            padding: const EdgeInsets.symmetric(horizontal: 8, vertical: 6),[m
[32m+[m[32m                            padding: const EdgeInsets.symmetric([m
[32m+[m[32m                                horizontal: 8, vertical: 6),[m
                             child: Column([m
                               children: [[m
                                 Align([m
                                   alignment: Alignment.topLeft,[m
[31m-                                  child: Text('+15%', style: Theme.of(context).textTheme.bodySmall),[m
[32m+[m[32m                                  child: Text('+15%',[m
[32m+[m[32m                                      style: Theme.of(context)[m
[32m+[m[32m                                          .textTheme[m
[32m+[m[32m                                          .bodySmall),[m
                                 ),[m
                                 const SizedBox(height: 4),[m
                                 Expanded([m
                                   child: Row([m
[31m-                                    crossAxisAlignment: CrossAxisAlignment.stretch,[m
[32m+[m[32m                                    crossAxisAlignment:[m
[32m+[m[32m                                        CrossAxisAlignment.stretch,[m
                                     children: bars,[m
                                   ),[m
                                 ),[m
                                 const SizedBox(height: 4),[m
                                 Align([m
                                   alignment: Alignment.bottomLeft,[m
[31m-                                  child: Text('-15%', style: Theme.of(context).textTheme.bodySmall),[m
[32m+[m[32m                                  child: Text('-15%',[m
[32m+[m[32m                                      style: Theme.of(context)[m
[32m+[m[32m                                          .textTheme[m
[32m+[m[32m                                          .bodySmall),[m
                                 ),[m
                               ],[m
                             ),[m
[36m@@ -160,7 +172,15 @@[m [mclass _ResidualGridPainter extends CustomPainter {[m
   final Color color;[m
 [m
   static const double _limit = 0.15;[m
[31m-  static const List<double> _lines = [-_limit, -0.1, -0.05, 0, 0.05, 0.1, _limit];[m
[32m+[m[32m  static const List<double> _lines = [[m
[32m+[m[32m    -_limit,[m
[32m+[m[32m    -0.1,[m
[32m+[m[32m    -0.05,[m
[32m+[m[32m    0,[m
[32m+[m[32m    0.05,[m
[32m+[m[32m    0.1,[m
[32m+[m[32m    _limit[m
[32m+[m[32m  ];[m
 [m
   @override[m
   void paint(Canvas canvas, Size size) {[m
[1mdiff --git a/lib/ui/widgets/sounding_chart.dart b/lib/ui/widgets/sounding_chart.dart[m
[1mindex c8c014d..e89c2c2 100644[m
[1m--- a/lib/ui/widgets/sounding_chart.dart[m
[1m+++ b/lib/ui/widgets/sounding_chart.dart[m
[36m@@ -71,8 +71,9 @@[m [mclass SoundingChart extends StatelessWidget {[m
       }[m
       final level = classifyPoint([m
         residual: residual ?? 0,[m
[31m-        coefficientOfVariation:[m
[31m-            p.sigmaRhoOhmM == null || p.rhoAppOhmM == 0 ? null : (p.sigmaRhoOhmM! / p.rhoAppOhmM),[m
[32m+[m[32m        coefficientOfVariation: p.sigmaRhoOhmM == null || p.rhoAppOhmM == 0[m
[32m+[m[32m            ? null[m
[32m+[m[32m            : (p.sigmaRhoOhmM! / p.rhoAppOhmM),[m
         point: p,[m
       );[m
       colors.add(_qaColor(level));[m
[36m@@ -184,8 +185,10 @@[m [mclass SoundingChart extends StatelessWidget {[m
                 },[m
               ),[m
             ),[m
[31m-            rightTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[31m-            topTitles: const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m            rightTitles:[m
[32m+[m[32m                const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
[32m+[m[32m            topTitles:[m
[32m+[m[32m                const AxisTitles(sideTitles: SideTitles(showTitles: false)),[m
           ),[m
           lineBarsData: lineBars,[m
           gridData: FlGridData([m
[36m@@ -193,21 +196,26 @@[m [mclass SoundingChart extends StatelessWidget {[m
             drawVerticalLine: true,[m
             drawHorizontalLine: true,[m
             verticalInterval: bottomTicks.length > 1[m
[31m-                ? (bottomTicks.last - bottomTicks.first) / (bottomTicks.length - 1)[m
[32m+[m[32m                ? (bottomTicks.last - bottomTicks.first) /[m
[32m+[m[32m                    (bottomTicks.length - 1)[m
                 : null,[m
             horizontalInterval: leftTicks.length > 1[m
                 ? (leftTicks.last - leftTicks.first) / (leftTicks.length - 1)[m
                 : null,[m
[31m-            getDrawingVerticalLine: (_) => FlLine(color: gridColor, strokeWidth: 0.5),[m
[31m-            getDrawingHorizontalLine: (_) => FlLine(color: gridColor, strokeWidth: 0.5),[m
[32m+[m[32m            getDrawingVerticalLine: (_) =>[m
[32m+[m[32m                FlLine(color: gridColor, strokeWidth: 0.5),[m
[32m+[m[32m            getDrawingHorizontalLine: (_) =>[m
[32m+[m[32m                FlLine(color: gridColor, strokeWidth: 0.5),[m
           ),[m
           lineTouchData: LineTouchData([m
             handleBuiltInTouches: true,[m
             touchTooltipData: LineTouchTooltipData([m
               getTooltipItems: (touchedSpots) {[m
                 const textStyle = TextStyle(color: Colors.white, fontSize: 11);[m
[31m-                final unitSuffix = distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
[31m-                return List<LineTooltipItem>.generate(touchedSpots.length, (index) {[m
[32m+[m[32m                final unitSuffix =[m
[32m+[m[32m                    distanceUnit == DistanceUnit.feet ? 'ft' : 'm';[m
[32m+[m[32m                return List<LineTooltipItem>.generate(touchedSpots.length,[m
[32m+[m[32m                    (index) {[m
                   final spot = touchedSpots[index];[m
                   final spacingMetersValue = math.pow(10, spot.x).toDouble();[m
                   final rhoValueLinear = math.pow(10, spot.y).toDouble();[m
[36m@@ -222,8 +230,10 @@[m [mclass SoundingChart extends StatelessWidget {[m
                     );[m
                   }[m
 [m
[31m-                  final spacingLabel = distanceUnit.formatSpacing(spacingMetersValue);[m
[31m-                  final labelPrefix = spot.barIndex < pointsBarIndex ? 'Model' : 'Band';[m
[32m+[m[32m                  final spacingLabel =[m
[32m+[m[32m                      distanceUnit.formatSpacing(spacingMetersValue);[m
[32m+[m[32m                  final labelPrefix =[m
[32m+[m[32m                      spot.barIndex < pointsBarIndex ? 'Model' : 'Band';[m
                   return LineTooltipItem([m
                     '$labelPrefix • a: $spacingLabel $unitSuffix\nρₐ: ${rhoValueLinear.toStringAsFixed(2)} Ω·m',[m
                     textStyle,[m
[1mdiff --git a/lib/ui/widgets/telemetry_panel.dart b/lib/ui/widgets/telemetry_panel.dart[m
[1mindex f445fde..446e0f5 100644[m
[1m--- a/lib/ui/widgets/telemetry_panel.dart[m
[1m+++ b/lib/ui/widgets/telemetry_panel.dart[m
[36m@@ -13,11 +13,17 @@[m [mclass TelemetryPanel extends StatelessWidget {[m
       padding: const EdgeInsets.all(12.0),[m
       child: Row([m
         children: [[m
[31m-          Expanded(child: _TelemetryCard(title: 'Current (A)', samples: state.current)),[m
[32m+[m[32m          Expanded([m
[32m+[m[32m              child:[m
[32m+[m[32m                  _TelemetryCard(title: 'Current (A)', samples: state.current)),[m
           const SizedBox(width: 8),[m
[31m-          Expanded(child: _TelemetryCard(title: 'Potential (V)', samples: state.voltage)),[m
[32m+[m[32m          Expanded([m
[32m+[m[32m              child: _TelemetryCard([m
[32m+[m[32m                  title: 'Potential (V)', samples: state.voltage)),[m
           const SizedBox(width: 8),[m
[31m-          Expanded(child: _TelemetryCard(title: 'SP Drift (mV)', samples: state.spDrift)),[m
[32m+[m[32m          Expanded([m
[32m+[m[32m              child: _TelemetryCard([m
[32m+[m[32m                  title: 'SP Drift (mV)', samples: state.spDrift)),[m
         ],[m
       ),[m
     );[m
[36m@@ -32,7 +38,8 @@[m [mclass _TelemetryCard extends StatelessWidget {[m
 [m
   @override[m
   Widget build(BuildContext context) {[m
[31m-    final latest = samples.isEmpty ? '—' : samples.last.value.toStringAsFixed(2);[m
[32m+[m[32m    final latest =[m
[32m+[m[32m        samples.isEmpty ? '—' : samples.last.value.toStringAsFixed(2);[m
     return Card([m
       child: Padding([m
         padding: const EdgeInsets.all(12.0),[m
[36m@@ -45,7 +52,8 @@[m [mclass _TelemetryCard extends StatelessWidget {[m
             SizedBox([m
               height: 32,[m
               child: CustomPaint([m
[31m-                painter: _SparklinePainter(samples.map((e) => e.value).toList()),[m
[32m+[m[32m                painter:[m
[32m+[m[32m                    _SparklinePainter(samples.map((e) => e.value).toList()),[m
                 size: Size.infinite,[m
               ),[m
             ),[m
[36m@@ -67,7 +75,8 @@[m [mclass _SparklinePainter extends CustomPainter {[m
       final paint = Paint()[m
         ..color = Colors.grey[m
         ..strokeWidth = 1.0;[m
[31m-      canvas.drawLine(Offset(0, size.height / 2), Offset(size.width, size.height / 2), paint);[m
[32m+[m[32m      canvas.drawLine(Offset(0, size.height / 2),[m
[32m+[m[32m          Offset(size.width, size.height / 2), paint);[m
       return;[m
     }[m
     final minVal = values.reduce((a, b) => a < b ? a : b);[m
[1mdiff --git a/lib/utils/distance_unit.dart b/lib/utils/distance_unit.dart[m
[1mindex ac84c87..8e05a97 100644[m
[1m--- a/lib/utils/distance_unit.dart[m
[1m+++ b/lib/utils/distance_unit.dart[m
[36m@@ -45,7 +45,8 @@[m [mextension DistanceUnitX on DistanceUnit {[m
     return value.toStringAsFixed(2);[m
   }[m
 [m
[31m-  static DistanceUnit parse(String? name, {DistanceUnit fallback = DistanceUnit.meters}) {[m
[32m+[m[32m  static DistanceUnit parse(String? name,[m
[32m+[m[32m      {DistanceUnit fallback = DistanceUnit.meters}) {[m
     if (name == null) return fallback;[m
     return DistanceUnit.values.firstWhere([m
       (unit) => unit.name == name,[m
[1mdiff --git a/scripts/ci/test_wsl.sh b/scripts/ci/test_wsl.sh[m
[1mindex 6ff2ba5..52488fd 100755[m
[1m--- a/scripts/ci/test_wsl.sh[m
[1m+++ b/scripts/ci/test_wsl.sh[m
[36m@@ -1,7 +1,12 @@[m
 #!/usr/bin/env bash[m
[32m+[m
 set -euo pipefail[m
[32m+[m
[32m+[m[32mexport FLUTTER_SUPPRESS_ANALYTICS=true[m
[32m+[m
 mkdir -p buildlogs[m
[31m-flutter pub get[m
[31m-dart format . --fix[m
[31m-flutter analyze | tee buildlogs/last_test.txt[m
[31m-flutter test -x widget_dialog | tee -a buildlogs/last_test.txt[m
[32m+[m
[32m+[m[32m# Keep the workflow deterministic for Codex by formatting, analyzing, and testing in sequence.[m
[32m+[m[32mdart format .[m
[32m+[m[32mdart analyze | tee buildlogs/last_test.txt[m
[32m+[m[32mflutter --no-version-check test -x widget_dialog | tee -a buildlogs/last_test.txt[m
[1mdiff --git a/test/csv_io_test.dart b/test/csv_io_test.dart[m
[1mindex 9e5ec1a..fc6c50a 100644[m
[1m--- a/test/csv_io_test.dart[m
[1m+++ b/test/csv_io_test.dart[m
[36m@@ -10,7 +10,9 @@[m [mimport 'package:resicheck/services/csv_io.dart';[m
 void main() {[m
   test('CSV roundtrip preserves feet, rho, sigma, and direction', () async {[m
     final service = CsvIoService();[m
[31m-    final temp = await File('${Directory.systemTemp.path}/resicheck_roundtrip.csv').create(recursive: true);[m
[32m+[m[32m    final temp =[m
[32m+[m[32m        await File('${Directory.systemTemp.path}/resicheck_roundtrip.csv')[m
[32m+[m[32m            .create(recursive: true);[m
     final point = SpacingPoint([m
       id: '1',[m
       arrayType: ArrayType.wenner,[m
[36m@@ -41,12 +43,14 @@[m [mvoid main() {[m
     expect(loaded.direction, point.direction);[m
   });[m
 [m
[31m-  test('Legacy CSV import derives missing rho and feet from spacing_m and V/I', () async {[m
[32m+[m[32m  test('Legacy CSV import derives missing rho and feet from spacing_m and V/I',[m
[32m+[m[32m      () async {[m
     final csv = [[m
       'spacing_m,voltage_v,current_a,array_type,timestamp_iso',[m
       '5,1.2,0.4,wenner,2024-01-01T00:00:00Z',[m
     ].join('\n');[m
[31m-    final file = await File('${Directory.systemTemp.path}/resicheck_legacy.csv').create(recursive: true);[m
[32m+[m[32m    final file = await File('${Directory.systemTemp.path}/resicheck_legacy.csv')[m
[32m+[m[32m        .create(recursive: true);[m
     await file.writeAsString(csv);[m
     final points = await CsvIoService().readFile(file);[m
     expect(points, hasLength(1));[m
[36m@@ -60,7 +64,9 @@[m [mvoid main() {[m
 [m
   test('Direction enum round-trips through CSV', () async {[m
     final service = CsvIoService();[m
[31m-    final temp = await File('${Directory.systemTemp.path}/resicheck_direction.csv').create(recursive: true);[m
[32m+[m[32m    final temp =[m
[32m+[m[32m        await File('${Directory.systemTemp.path}/resicheck_direction.csv')[m
[32m+[m[32m            .create(recursive: true);[m
     final points = [[m
       SpacingPoint([m
         id: 'ns',[m
[36m@@ -89,6 +95,7 @@[m [mvoid main() {[m
     ];[m
     await service.writeFile(temp, points);[m
     final readBack = await service.readFile(temp);[m
[31m-    expect(readBack.map((p) => p.direction).toList(), points.map((p) => p.direction).toList());[m
[32m+[m[32m    expect(readBack.map((p) => p.direction).toList(),[m
[32m+[m[32m        points.map((p) => p.direction).toList());[m
   });[m
 }[m
[1mdiff --git a/test/depth_cue_table_golden.dart b/test/depth_cue_table_golden.dart[m
[1mindex 6fac925..4610335 100644[m
[1m--- a/test/depth_cue_table_golden.dart[m
[1m+++ b/test/depth_cue_table_golden.dart[m
[36m@@ -30,7 +30,8 @@[m [mvoid main() {[m
 }[m
 [m
 SiteRecord _buildSite() {[m
[31m-  DirectionReadingHistory history(OrientationKind orientation, double resistance) {[m
[32m+[m[32m  DirectionReadingHistory history([m
[32m+[m[32m      OrientationKind orientation, double resistance) {[m
     return DirectionReadingHistory([m
       orientation: orientation,[m
       label: orientation == OrientationKind.a ? 'N–S' : 'W–E',[m
[1mdiff --git a/test/depth_cue_test.dart b/test/depth_cue_test.dart[m
[1mindex 74b7a20..bc83e8a 100644[m
[1m--- a/test/depth_cue_test.dart[m
[1m+++ b/test/depth_cue_test.dart[m
[36m@@ -7,7 +7,8 @@[m [mimport 'package:resicheck/models/site.dart';[m
 import 'package:resicheck/ui/project_workflow/depth_profile_tab.dart';[m
 [m
 void main() {[m
[31m-  testWidgets('depth table uses 0.5·a and averages valid resistivity', (tester) async {[m
[32m+[m[32m  testWidgets('depth table uses 0.5·a and averages valid resistivity',[m
[32m+[m[32m      (tester) async {[m
     final site = _buildSite();[m
     await tester.pumpWidget([m
       MaterialApp([m
[36m@@ -17,7 +18,8 @@[m [mvoid main() {[m
       ),[m
     );[m
 [m
[31m-    final tables = tester.widgetList<DataTable>(find.byType(DataTable)).toList();[m
[32m+[m[32m    final tables =[m
[32m+[m[32m        tester.widgetList<DataTable>(find.byType(DataTable)).toList();[m
     expect(tables, isNotEmpty);[m
     final dataTable = tables.first;[m
     expect(dataTable.rows, hasLength(3));[m
[36m@@ -49,7 +51,8 @@[m [mclass _ExpectedRow {[m
   final List<double> resistances;[m
 [m
   double averageRho() {[m
[31m-    final averageResistance = resistances.reduce((a, b) => a + b) / resistances.length;[m
[32m+[m[32m    final averageResistance =[m
[32m+[m[32m        resistances.reduce((a, b) => a + b) / resistances.length;[m
     return rhoAWenner(spacing, averageResistance);[m
   }[m
 }[m
[36m@@ -81,7 +84,11 @@[m [mSiteRecord _buildSite() {[m
     );[m
   }[m
 [m
[31m-  SpacingRecord record({required double spacing, required List<double> a, List<double> b = const [], List<double> badB = const []}) {[m
[32m+[m[32m  SpacingRecord record([m
[32m+[m[32m      {required double spacing,[m
[32m+[m[32m      required List<double> a,[m
[32m+[m[32m      List<double> b = const [],[m
[32m+[m[32m      List<double> badB = const []}) {[m
     return SpacingRecord([m
       spacingFeet: spacing,[m
       orientationA: history(OrientationKind.a, a),[m
[1mdiff --git a/test/geometry_factors_test.dart b/test/geometry_factors_test.dart[m
[1mindex 96356bf..5ad2000 100644[m
[1m--- a/test/geometry_factors_test.dart[m
[1m+++ b/test/geometry_factors_test.dart[m
[36m@@ -9,7 +9,8 @@[m [mvoid main() {[m
   });[m
 [m
   test('Schlumberger geometry factor', () {[m
[31m-    final k = geometryFactor(array: GeometryArray.schlumberger, spacing: 20, mn: 6);[m
[32m+[m[32m    final k =[m
[32m+[m[32m        geometryFactor(array: GeometryArray.schlumberger, spacing: 20, mn: 6);[m
     expect(k, greaterThan(0));[m
   });[m
 [m
[1mdiff --git a/test/inversion_test.dart b/test/inversion_test.dart[m
[1mindex 462aa00..4e5d475 100644[m
[1m--- a/test/inversion_test.dart[m
[1m+++ b/test/inversion_test.dart[m
[36m@@ -11,7 +11,8 @@[m [mvoid main() {[m
     final spacingsFeet = spacingsMeters.map(metersToFeet).toList();[m
     final resistivities = <double>[30, 120, 400];[m
     final thicknesses = <double?>[2.5, 6.0, null];[m
[31m-    final synthetic = _forwardSynthetic(spacingsMeters, resistivities, thicknesses);[m
[32m+[m[32m    final synthetic =[m
[32m+[m[32m        _forwardSynthetic(spacingsMeters, resistivities, thicknesses);[m
 [m
     final result = await invert1DWenner([m
       aFt: spacingsFeet,[m
[36m@@ -30,7 +31,8 @@[m [mvoid main() {[m
     for (var i = 0; i < 2; i++) {[m
       final expectedThick = thicknesses[i]!;[m
       final actualThick = recoveredThicknesses[i]!;[m
[31m-      final thicknessError = (actualThick - expectedThick).abs() / expectedThick;[m
[32m+[m[32m      final thicknessError =[m
[32m+[m[32m          (actualThick - expectedThick).abs() / expectedThick;[m
       // Layer thickness recovery fluctuates by architecture. Empirically the[m
       // Windows release can stray by ~45%, so we keep the guardrail below 50%[m
       // while still detecting pathological regressions.[m
[36m@@ -70,7 +72,8 @@[m [mList<double> _forwardSynthetic([m
       final top = cumulativeDepth;[m
       final bottom = cumulativeDepth + thickness;[m
       final weight = math.exp([m
[31m-        -(depth - (top + bottom) / 2).abs() / math.max((bottom - top) / 2, 1e-3),[m
[32m+[m[32m        -(depth - (top + bottom) / 2).abs() /[m
[32m+[m[32m            math.max((bottom - top) / 2, 1e-3),[m
       );[m
       numerator += resistivities[i] * weight;[m
       weightSum += weight;[m
[1mdiff --git a/test/plots_palette_golden.dart b/test/plots_palette_golden.dart[m
[1mindex 1c79b9e..45f9db0 100644[m
[1m--- a/test/plots_palette_golden.dart[m
[1m+++ b/test/plots_palette_golden.dart[m
[36m@@ -27,7 +27,7 @@[m [mvoid main() {[m
     );[m
 [m
     final lineChart = tester.widget<LineChart>(find.byType(LineChart));[m
[31m-    final data = lineChart.data as LineChartData;[m
[32m+[m[32m    final LineChartData data = lineChart.data;[m
     expect(data.lineBarsData.length, greaterThanOrEqualTo(3));[m
 [m
     final northSeries = data.lineBarsData[0];[m
[36m@@ -40,19 +40,19 @@[m [mvoid main() {[m
     expect(averageSeries.dashArray, equals(const [6, 6]));[m
     expect(averageSeries.dotData.show, isTrue);[m
 [m
[31m-    final circlePainter = northSeries.dotData.getDotPainter!([m
[32m+[m[32m    final circlePainter = northSeries.dotData.getDotPainter([m
       northSeries.spots.first,[m
       0,[m
       northSeries,[m
       0,[m
     );[m
[31m-    final squarePainter = eastSeries.dotData.getDotPainter!([m
[32m+[m[32m    final squarePainter = eastSeries.dotData.getDotPainter([m
       eastSeries.spots.first,[m
       0,[m
       eastSeries,[m
       0,[m
     );[m
[31m-    final trianglePainter = averageSeries.dotData.getDotPainter!([m
[32m+[m[32m    final trianglePainter = averageSeries.dotData.getDotPainter([m
       averageSeries.spots.first,[m
       0,[m
       averageSeries,[m
[36m@@ -60,7 +60,8 @@[m [mvoid main() {[m
     );[m
     expect(circlePainter, isA<FlDotCirclePainter>());[m
     expect(squarePainter, isA<FlDotSquarePainter>());[m
[31m-    expect(trianglePainter.runtimeType.toString(), equals('_TriangleDotPainter'));[m
[32m+[m[32m    expect([m
[32m+[m[32m        trianglePainter.runtimeType.toString(), equals('_TriangleDotPainter'));[m
 [m
     expect(find.text('N–S'), findsOneWidget);[m
     expect(find.text('W–E'), findsOneWidget);[m
[1mdiff --git a/test/plots_panel_sort_test.dart b/test/plots_panel_sort_test.dart[m
[1mindex 207ef3e..0ba4066 100644[m
[1m--- a/test/plots_panel_sort_test.dart[m
[1m+++ b/test/plots_panel_sort_test.dart[m
[36m@@ -10,7 +10,8 @@[m [mimport 'package:resicheck/services/templates_service.dart';[m
 import 'package:resicheck/ui/project_workflow/plots_panel.dart';[m
 [m
 void main() {[m
[31m-  testWidgets('ghost and template series render in ascending spacing order', (tester) async {[m
[32m+[m[32m  testWidgets('ghost and template series render in ascending spacing order',[m
[32m+[m[32m      (tester) async {[m
     final spacing = SpacingRecord([m
       spacingFeet: 10,[m
       orientationA: DirectionReadingHistory([m
[36m@@ -81,11 +82,15 @@[m [mvoid main() {[m
 [m
     final ghostBar = bars.firstWhere([m
       (bar) =>[m
[31m-          bar.dashArray != null && bar.dashArray!.length == 2 && bar.dashArray!.first == 6,[m
[32m+[m[32m          bar.dashArray != null &&[m
[32m+[m[32m          bar.dashArray!.length == 2 &&[m
[32m+[m[32m          bar.dashArray!.first == 6,[m
     );[m
     final templateBar = bars.firstWhere([m
       (bar) =>[m
[31m-          bar.dashArray != null && bar.dashArray!.length == 2 && bar.dashArray!.first == 4,[m
[32m+[m[32m          bar.dashArray != null &&[m
[32m+[m[32m          bar.dashArray!.length == 2 &&[m
[32m+[m[32m          bar.dashArray!.first == 4,[m
     );[m
 [m
     final ghostXs = ghostBar.spots.map((spot) => spot.x).toList();[m
[1mdiff --git a/test/points_table_layout_test.dart b/test/points_table_layout_test.dart[m
[1mindex 315fa6c..114ab26 100644[m
[1m--- a/test/points_table_layout_test.dart[m
[1m+++ b/test/points_table_layout_test.dart[m
[36m@@ -4,7 +4,8 @@[m [mimport 'package:flutter_test/flutter_test.dart';[m
 import 'package:resicheck/ui/project_workflow/table_panel.dart';[m
 [m
 void main() {[m
[31m-  testWidgets('TablePanel builds in narrow width without overflow', (tester) async {[m
[32m+[m[32m  testWidgets('TablePanel builds in narrow width without overflow',[m
[32m+[m[32m      (tester) async {[m
     await tester.pumpWidget(const MaterialApp([m
       home: Scaffold([m
         body: SizedBox([m
[1mdiff --git a/test/points_table_test.dart b/test/points_table_test.dart[m
[1mindex 01a822d..e1c2a3a 100644[m
[1m--- a/test/points_table_test.dart[m
[1m+++ b/test/points_table_test.dart[m
[36m@@ -7,7 +7,8 @@[m [mimport 'package:resicheck/ui/project_workflow/table_panel.dart';[m
 [m
 void main() {[m
   group('TablePanel focus traversal', () {[m
[31m-    testWidgets('tab order follows N–S long→short then W–E short→long', (tester) async {[m
[32m+[m[32m    testWidgets('tab order follows N–S long→short then W–E short→long',[m
[32m+[m[32m        (tester) async {[m
       final site = _buildSite();[m
       await tester.pumpWidget([m
         MaterialApp([m
[36m@@ -29,7 +30,8 @@[m [mvoid main() {[m
       );[m
 [m
       final dynamic state = tester.state(find.byType(TablePanel));[m
[31m-      final List<FocusNode> order = List<FocusNode>.from(state.tabOrderForTest as List);[m
[32m+[m[32m      final List<FocusNode> order =[m
[32m+[m[32m          List<FocusNode>.from(state.tabOrderForTest as List);[m
       final labels = order.map((node) => node.debugLabel ?? '').toList();[m
 [m
       expect([m
[36m@@ -48,15 +50,17 @@[m [mvoid main() {[m
 [m
   group('SD formatter', () {[m
     test('accepts 0–99.9 pattern', () {[m
[31m-    final regExp = RegExp(TablePanel.sdPromptPattern);[m
[32m+[m[32m      final regExp = RegExp(TablePanel.sdPromptPattern);[m
       final valid = ['0', '5', '12', '99', '7.5', '12.3', ''];[m
       for (final value in valid) {[m
[31m-        expect(regExp.hasMatch(value), isTrue, reason: 'expected "$value" to be allowed');[m
[32m+[m[32m        expect(regExp.hasMatch(value), isTrue,[m
[32m+[m[32m            reason: 'expected "$value" to be allowed');[m
       }[m
 [m
       final invalid = ['100', '12.34', '123', '1.23', 'abc'];[m
       for (final value in invalid) {[m
[31m-        expect(regExp.hasMatch(value), isFalse, reason: 'expected "$value" to be rejected');[m
[32m+[m[32m        expect(regExp.hasMatch(value), isFalse,[m
[32m+[m[32m            reason: 'expected "$value" to be rejected');[m
       }[m
     });[m
   });[m
[1mdiff --git a/test/qc_rules_test.dart b/test/qc_rules_test.dart[m
[1mindex d33bd9d..9ef78a0 100644[m
[1m--- a/test/qc_rules_test.dart[m
[1m+++ b/test/qc_rules_test.dart[m
[36m@@ -53,7 +53,8 @@[m [mvoid main() {[m
 [m
   test('Red classification due to CV', () {[m
     final point = _makePoint(100.0, sigma: 20.0);[m
[31m-    final level = classifyPoint(residual: 0.02, coefficientOfVariation: 0.2, point: point);[m
[32m+[m[32m    final level = classifyPoint([m
[32m+[m[32m        residual: 0.02, coefficientOfVariation: 0.2, point: point);[m
     expect(level, QaLevel.red);[m
   });[m
 [m
[1mdiff --git a/test/state/project_controller_test.dart b/test/state/project_controller_test.dart[m
[1mindex c9da71a..232482e 100644[m
[1m--- a/test/state/project_controller_test.dart[m
[1m+++ b/test/state/project_controller_test.dart[m
[36m@@ -46,8 +46,7 @@[m [mvoid main() {[m
   Project _sampleProject() {[m
     final spacings = [1.0, 2.0, 5.0];[m
     List<SpacingPoint> buildPoints() => [[m
[31m-          for (final spacing in spacings)[m
[31m-            SpacingPoint(spacingMeters: spacing),[m
[32m+[m[32m          for (final spacing in spacings) SpacingPoint(spacingMeters: spacing),[m
         ];[m
     return Project([m
       projectName: 'WayneCo',[m
[36m@@ -110,7 +109,8 @@[m [mvoid main() {[m
 [m
     await controller.saveProject();[m
 [m
[31m-    expect(container.read(projectControllerProvider).hasUnsavedChanges, isFalse);[m
[32m+[m[32m    expect([m
[32m+[m[32m        container.read(projectControllerProvider).hasUnsavedChanges, isFalse);[m
     expect(persistence._store.containsKey('WayneCo'), isTrue);[m
   });[m
 [m
